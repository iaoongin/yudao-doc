(window.webpackJsonp=window.webpackJsonp||[]).push([[170],{499:function(t,a,e){"use strict";e.r(a);var r=e(7),o=Object(r.a)({},(function(){var t=this,a=t._self._c;return a("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[a("p",[t._v("本章节，讲解如果将你的公众号，接入到系统中。步骤如下：")]),t._v(" "),a("ul",[a("li",[t._v("第一步，申请公众号（可选）")]),t._v(" "),a("li",[t._v("第二步，在系统中，添加公众号账号")]),t._v(" "),a("li",[t._v("第三步，在公众号中，配置接入信息")])]),t._v(" "),a("h2",{attrs:{id:"_1-配置步骤"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-配置步骤"}},[t._v("#")]),t._v(" 1. 配置步骤")]),t._v(" "),a("p",[t._v("本小节，手把手教你如何将公众号接入到系统中。")]),t._v(" "),a("h3",{attrs:{id:"第一步-申请公众号-可选"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#第一步-申请公众号-可选"}},[t._v("#")]),t._v(" 第一步，申请公众号（可选）")]),t._v(" "),a("div",{staticClass:"custom-block tip"},[a("p",{staticClass:"custom-block-title"},[t._v("友情提示：如果你已经有公众号，可以忽略这一步。")])]),t._v(" "),a("p",[t._v("① 如果你还没有公众号，可以申请一个测试帐号。")]),t._v(" "),a("p",[a("img",{attrs:{src:"/img/%E5%85%AC%E4%BC%97%E5%8F%B7%E6%89%8B%E5%86%8C/%E5%85%AC%E4%BC%97%E5%8F%B7%E6%8E%A5%E5%85%A5/%E7%AC%AC%E4%B8%80%E6%AD%A5-%E7%94%B3%E8%AF%B7%E6%B5%8B%E8%AF%95%E5%B8%90%E5%8F%B7.png",alt:"申请测试账号"}})]),t._v(" "),a("p",[t._v("申请地址："),a("a",{attrs:{href:"https://mp.weixin.qq.com/debug/cgi-bin/sandbox?t=sandbox/login",target:"_blank",rel:"noopener noreferrer"}},[t._v("微信公众平台接口测试帐号申请"),a("OutboundLink")],1)]),t._v(" "),a("p",[t._v("② 申请完成后，获得一个测试号。如下图所示：")]),t._v(" "),a("p",[a("img",{attrs:{src:"/img/%E5%85%AC%E4%BC%97%E5%8F%B7%E6%89%8B%E5%86%8C/%E5%85%AC%E4%BC%97%E5%8F%B7%E6%8E%A5%E5%85%A5/%E7%AC%AC%E4%B8%80%E6%AD%A5-%E6%B5%8B%E8%AF%95%E8%B4%A6%E5%8F%B7%E4%BF%A1%E6%81%AF.png",alt:"测试账号信息"}})]),t._v(" "),a("h3",{attrs:{id:"第二步-添加公众号账号"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#第二步-添加公众号账号"}},[t._v("#")]),t._v(" 第二步，添加公众号账号")]),t._v(" "),a("p",[t._v("点击 [公众号管理 -> 账号管理] 菜单，添加一个公众号账号。如下图所示：")]),t._v(" "),a("p",[a("img",{attrs:{src:"/img/%E5%85%AC%E4%BC%97%E5%8F%B7%E6%89%8B%E5%86%8C/%E5%85%AC%E4%BC%97%E5%8F%B7%E6%8E%A5%E5%85%A5/%E7%AC%AC%E4%BA%8C%E6%AD%A5-%E6%B7%BB%E5%8A%A0%E5%85%AC%E4%BC%97%E5%8F%B7%E8%B4%A6%E5%8F%B7.png",alt:"添加公众号账号"}})]),t._v(" "),a("h3",{attrs:{id:"第三步-配置接入信息"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#第三步-配置接入信息"}},[t._v("#")]),t._v(" 第三步，配置接入信息")]),t._v(" "),a("p",[t._v("① 由于公众号通知需要外网地址，可参考 "),a("RouterLink",{attrs:{to:"/natapp/"}},[t._v("《内网穿透》")]),t._v(" 文档，将本地的 48080 端口，转发到外网中。这里，我的域名是 "),a("code",[t._v("http://yunai.natapp1.cc")]),t._v("。")],1),t._v(" "),a("p",[t._v("② 打开微信公众号界面，填写 URL 和 Token 信息。如下图所示：")]),t._v(" "),a("p",[a("img",{attrs:{src:"/img/%E5%85%AC%E4%BC%97%E5%8F%B7%E6%89%8B%E5%86%8C/%E5%85%AC%E4%BC%97%E5%8F%B7%E6%8E%A5%E5%85%A5/%E7%AC%AC%E4%B8%89%E6%AD%A5-%E5%A1%AB%E5%86%99URL%E5%92%8CToken.png",alt:"填写 URL 和 Token 信息"}})]),t._v(" "),a("p",[t._v("点击提交后，看到“配置成功”提示，说明配置成功。")]),t._v(" "),a("h2",{attrs:{id:"_2-实现代码"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-实现代码"}},[t._v("#")]),t._v(" 2. 实现代码")]),t._v(" "),a("p",[t._v("本小节，将介绍如何实现公众号接入的代码。")]),t._v(" "),a("h3",{attrs:{id:"_2-1-表结构"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-1-表结构"}},[t._v("#")]),t._v(" 2.1 表结构")]),t._v(" "),a("p",[t._v("公众号账号对应 "),a("code",[t._v("mp_account")]),t._v(" 表，结构如下图所示：")]),t._v(" "),a("p",[a("img",{attrs:{src:"/img/%E5%85%AC%E4%BC%97%E5%8F%B7%E6%89%8B%E5%86%8C/%E5%85%AC%E4%BC%97%E5%8F%B7%E6%8E%A5%E5%85%A5/%E8%A1%A8%E7%BB%93%E6%9E%84.png",alt:"表结构"}})]),t._v(" "),a("h3",{attrs:{id:"_2-2-账号管理界面"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-2-账号管理界面"}},[t._v("#")]),t._v(" 2.2 账号管理界面")]),t._v(" "),a("ul",[a("li",[t._v("前端："),a("a",{attrs:{href:"https://github.com/yudaocode/yudao-ui-admin-vue2/blob/master/src/views/mp/account/index.vue",target:"_blank",rel:"noopener noreferrer"}},[t._v("/@views/mp/account"),a("OutboundLink")],1)]),t._v(" "),a("li",[t._v("后端："),a("a",{attrs:{href:"https://github.com/YunaiV/ruoyi-vue-pro/blob/master/yudao-module-mp/yudao-module-mp-biz/src/main/java/cn/iocoder/yudao/module/mp/controller/admin/account/MpAccountController.java",target:"_blank",rel:"noopener noreferrer"}},[t._v("MpAccountController"),a("OutboundLink")],1)])]),t._v(" "),a("h3",{attrs:{id:"_2-3-配置接入回调"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-3-配置接入回调"}},[t._v("#")]),t._v(" 2.3 配置接入回调")]),t._v(" "),a("p",[t._v("在 "),a("a",{attrs:{href:"#%E7%AC%AC%E4%B8%89%E6%AD%A5-%E9%85%8D%E7%BD%AE%E6%8E%A5%E5%85%A5%E4%BF%A1%E6%81%AF"}},[t._v("第三步，配置接入信息")]),t._v(" 时，微信公众号会回调系统的 "),a("code",[t._v("GET /admin-api/mp/open/{appID}")]),t._v(" 接口，进行接入配置的验证。对应 "),a("a",{attrs:{href:"https://github.com/YunaiV/ruoyi-vue-pro/blob/master/yudao-module-mp/yudao-module-mp-biz/src/main/java/cn/iocoder/yudao/module/mp/controller/admin/open/MpOpenController.java#L39-L57",target:"_blank",rel:"noopener noreferrer"}},[t._v("MpOpenController"),a("OutboundLink")],1),t._v(" 类的 "),a("code",[t._v("checkSignature")]),t._v(" 方法，如下图所示：")]),t._v(" "),a("p",[a("img",{attrs:{src:"/img/%E5%85%AC%E4%BC%97%E5%8F%B7%E6%89%8B%E5%86%8C/%E5%85%AC%E4%BC%97%E5%8F%B7%E6%8E%A5%E5%85%A5/%E9%85%8D%E7%BD%AE%E6%8E%A5%E5%85%A5%E5%9B%9E%E8%B0%83.png",alt:"checkSignature 方法"}})]),t._v(" "),a("p",[t._v("对应 "),a("a",{attrs:{href:"https://developers.weixin.qq.com/doc/offiaccount/Basic_Information/Access_Overview.html#%E7%AC%AC%E4%BA%8C%E6%AD%A5%EF%BC%9A%E9%AA%8C%E8%AF%81%E6%B6%88%E6%81%AF%E7%9A%84%E7%A1%AE%E6%9D%A5%E8%87%AA%E5%BE%AE%E4%BF%A1%E6%9C%8D%E5%8A%A1%E5%99%A8",target:"_blank",rel:"noopener noreferrer"}},[t._v("《微信公众号官方文档 —— 接入指南》"),a("OutboundLink")],1),t._v(" 文档。")]),t._v(" "),a("div",{staticClass:"custom-block tip"},[a("p",{staticClass:"custom-block-title"},[t._v("友情提示：")]),t._v(" "),a("p",[t._v("项目使用的微信工具开发包是 "),a("a",{attrs:{href:"https://github.com/Wechat-Group/WxJava/tree/develop/weixin-java-mp",target:"_blank",rel:"noopener noreferrer"}},[a("code",[t._v("weixin-java-mp")]),a("OutboundLink")],1),t._v("，超级好用！")])]),t._v(" "),a("h3",{attrs:{id:"_2-4-消息处理"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-4-消息处理"}},[t._v("#")]),t._v(" 2.4 消息处理")]),t._v(" "),a("p",[t._v("配置接入完成后，用户发给公众号的消息，公众号都会回调到 "),a("code",[t._v("POST /admin-api/mp/open/{appID}")]),t._v(" 接口，进行消息的处理。对应 "),a("a",{attrs:{href:"https://github.com/YunaiV/ruoyi-vue-pro/blob/master/yudao-module-mp/yudao-module-mp-biz/src/main/java/cn/iocoder/yudao/module/mp/controller/admin/open/MpOpenController.java#L59-L114",target:"_blank",rel:"noopener noreferrer"}},[t._v("MpOpenController"),a("OutboundLink")],1),t._v(" 类的 "),a("code",[t._v("handleMessage")]),t._v(" 方法，如下图所示：")]),t._v(" "),a("p",[a("img",{attrs:{src:"/img/%E5%85%AC%E4%BC%97%E5%8F%B7%E6%89%8B%E5%86%8C/%E5%85%AC%E4%BC%97%E5%8F%B7%E6%8E%A5%E5%85%A5/%E6%B6%88%E6%81%AF%E5%A4%84%E7%90%86.png",alt:"handleMessage 方法"}})]),t._v(" "),a("p",[t._v("核心逻辑是第二步，再解析到消息后，交给 WxMpMessageRouter 进行消息的处理。WxMpMessageRouter 在 "),a("a",{attrs:{href:"https://github.com/YunaiV/ruoyi-vue-pro/blob/master/yudao-module-mp/yudao-module-mp-biz/src/main/java/cn/iocoder/yudao/module/mp/controller/admin/open/MpOpenController.java#L59-L114",target:"_blank",rel:"noopener noreferrer"}},[t._v("DefaultMpServiceFactory"),a("OutboundLink")],1),t._v(" 初始化，设置每种消息对应的 "),a("a",{attrs:{href:"https://github.com/YunaiV/ruoyi-vue-pro/blob/master/yudao-module-mp/yudao-module-mp-biz/src/main/java/cn/iocoder/yudao/module/mp/service/handler/",target:"_blank",rel:"noopener noreferrer"}},[a("code",[t._v("handler")]),a("OutboundLink")],1),t._v(" 处理器。如下图所示：")]),t._v(" "),a("p",[a("img",{attrs:{src:"/img/%E5%85%AC%E4%BC%97%E5%8F%B7%E6%89%8B%E5%86%8C/%E5%85%AC%E4%BC%97%E5%8F%B7%E6%8E%A5%E5%85%A5/%E6%B6%88%E6%81%AF%E5%A4%84%E7%90%86%E5%99%A8.png",alt:"消息处理器"}})]),t._v(" "),a("p",[t._v("具体每个处理器的实现，后续每个章节单独详细讲解。")])])}),[],!1,null,null,null);a.default=o.exports}}]);