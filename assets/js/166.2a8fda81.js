(window.webpackJsonp=window.webpackJsonp||[]).push([[166],{495:function(t,e,a){"use strict";a.r(e);var r=a(7),n=Object(r.a)({},(function(){var t=this,e=t._self._c;return e("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[e("p",[t._v("Midjourney 是一个由位于美国加州旧金山的同名研究实验室开发之人工智能程序，可根据文本生成图像，于 2022 年 7 月 12 日进入公开测试阶段，用户可透过 Discord 的机器人指令进行操作。")]),t._v(" "),e("p",[t._v("由于 Midjourney 没有直接提供 API 接口，所以大家一般通过 "),e("a",{attrs:{href:"https://github.com/novicezk/midjourney-proxy/",target:"_blank",rel:"noopener noreferrer"}},[t._v("https://github.com/novicezk/midjourney-proxy/"),e("OutboundLink")],1),t._v(" 项目，代理 MidJourney 的 Discord 频道，实现 API 形式调用 AI 绘图。")]),t._v(" "),e("p",[t._v("也因此，Spring AI 肯定是不集成 Midjourney 的，所以我们实现的 "),e("code",[t._v("models/midjourney")]),t._v(" 包下的 MidjourneyApi 类，基于上述的 "),e("code",[t._v("midjourney-proxy")]),t._v(" 代理，调用 Midjourney 实现绘图的功能。")]),t._v(" "),e("h2",{attrs:{id:"_1-申请密钥"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_1-申请密钥"}},[t._v("#")]),t._v(" 1. 申请密钥")]),t._v(" "),e("p",[t._v("可参考 "),e("a",{attrs:{href:"https://github.com/novicezk/midjourney-proxy/blob/main/README_CN.md",target:"_blank",rel:"noopener noreferrer"}},[t._v("https://github.com/novicezk/midjourney-proxy/blob/main/README_CN.md"),e("OutboundLink")],1),t._v(" 文档，申请相关账号，并搭建 "),e("code",[t._v("midjourney-proxy")]),t._v(" 代理。")]),t._v(" "),e("p",[t._v("不过这个方式比较麻烦，我自己暂时没跑通。我是在 "),e("a",{attrs:{href:"https://api.holdai.top/register?aff=EcRu",target:"_blank",rel:"noopener noreferrer"}},[t._v("毫秒 API"),e("OutboundLink")],1),t._v(" 注册了一个账号，然后通过他们的 API 代理 Midjourney 的。这个是需要付费的，测试的话，建议只小额充值 1-10 块。")]),t._v(" "),e("hr"),t._v(" "),e("p",[t._v("申请完成后，可以在我们系统的 [AI 大模型 -> 控制台 -> API 密钥] 菜单，进行密钥的配置。需要填写“密钥” + “自定义 API URL”。如下图所示：")]),t._v(" "),e("p",[e("img",{attrs:{src:"/img/AI%E6%89%8B%E5%86%8C/%E6%A8%A1%E5%9E%8B%E6%8E%A5%E5%85%A5/Midjourney-%E7%A7%81%E6%9C%89.png",alt:"私有的密钥配置"}})]),t._v(" "),e("h2",{attrs:{id:"_2-ai-绘图"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_2-ai-绘图"}},[t._v("#")]),t._v(" 2. AI 绘图")]),t._v(" "),e("p",[t._v("后续使用 "),e("RouterLink",{attrs:{to:"/ai/image/"}},[t._v("《AI 绘图》")]),t._v(" 时，需要在 [AI 大模型 -> 控制台 -> 模型配置] 菜单，配置对应的图像模型。")],1),t._v(" "),e("p",[t._v("模型有："),e("code",[t._v("niji")]),t._v("、"),e("code",[t._v("midjourney")]),t._v(" 等等。")]),t._v(" "),e("h2",{attrs:{id:"_3-如何使用"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_3-如何使用"}},[t._v("#")]),t._v(" 3. 如何使用？")]),t._v(" "),e("p",[t._v("① 如果你的项目里需要直接通过 "),e("code",[t._v("@Resource")]),t._v(" 注入 MidjourneyApi 对象，需要把 "),e("code",[t._v("application.yaml")]),t._v(" 配置文件里的 "),e("code",[t._v("yudao.ai.midjourney")]),t._v(" 配置项，替换成你的！")]),t._v(" "),e("div",{staticClass:"language-YAML extra-class"},[e("pre",{pre:!0,attrs:{class:"language-yaml"}},[e("code",[e("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("yudao")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("ai")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("midjourney")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("enable")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token boolean important"}},[t._v("true")]),t._v("\n      "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("base-url")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" https"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("//api.holdai.top/mj\n      "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("api-key")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" sk"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("dZEPiVaNcT3FHhef51996bAa0bC74806BeAb620dA5Da10Bf\n      "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("notify-url")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" http"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("//java.nat300.top/admin"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("api/ai/image/midjourney/notify\n")])])]),e("ul",[e("li",[e("code",[t._v("base-url")]),t._v("：Midjourney 代理的地址，相关的接口文档可见 "),e("a",{attrs:{href:"https://gpt-best.apifox.cn/doc-3530863",target:"_blank",rel:"noopener noreferrer"}},[t._v("https://gpt-best.apifox.cn/doc-3530863"),e("OutboundLink")],1)]),t._v(" "),e("li",[e("code",[t._v("notify-url")]),t._v("：Midjourney 生成图片后的回调地址，因为 Midjourney 生成图片是异步的，所以需要回调通知。这个 URL 可以分成两个小部分：\n"),e("ul",[e("li",[e("code",[t._v("http://java.nat300.top")]),t._v("：你的服务器地址。如果你没外网，可以通过 "),e("a",{attrs:{href:"/natapp"}},[t._v("《内网穿透》")]),t._v(" 解决")]),t._v(" "),e("li",[e("code",[t._v("/admin-api/ai/image/midjourney/notify")]),t._v("：对应 AiImageController 的 "),e("code",[t._v("#midjourneyNotify(...)")]),t._v(" 方法")])])])]),t._v(" "),e("p",[t._v("另外，考虑到 Midjourney 回调失败的情况，可以把项目的 AiMidjourneySyncJob 定时器类，配置每 1 分钟执行一次，检查是否有未回调的图片。怎么使用定时器，可以参考 "),e("a",{attrs:{href:"/job"}},[t._v("《定时任务》")]),t._v(" 文档。")]),t._v(" "),e("p",[t._v("② 如果你希望使用 [AI 大模型 -> 控制台 -> API 密钥] 菜单的密钥配置，则可以通过 AiModelService 的 "),e("code",[t._v("#getMidjourneyApi()")]),t._v(" 方法，获取对应的 MidjourneyApi 对象。")]),t._v(" "),e("p",[t._v("另外，MidjourneyApiTests 里有对应的测试用例，可以参考。")])])}),[],!1,null,null,null);e.default=n.exports}}]);