(window.webpackJsonp=window.webpackJsonp||[]).push([[69],{398:function(t,a,s){"use strict";s.r(a);var e=s(7),r=Object(e.a)({},(function(){var t=this,a=t._self._c;return a("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[a("div",{staticClass:"custom-block tip"},[a("p",{staticClass:"custom-block-title"},[t._v("相关视频：")]),t._v(" "),a("ul",[a("li",[a("a",{attrs:{href:"https://t.zsxq.com/04rFUjIei",target:"_blank",rel:"noopener noreferrer"}},[t._v("23、如何实现 OA 请假的发起？"),a("OutboundLink")],1)]),t._v(" "),a("li",[a("a",{attrs:{href:"https://t.zsxq.com/04fMJiufQ",target:"_blank",rel:"noopener noreferrer"}},[t._v("24、如何实现 OA 请假的审批？"),a("OutboundLink")],1)])])]),t._v(" "),a("p",[t._v("本文接 "),a("RouterLink",{attrs:{to:"/bpm/use-bpm-form/"}},[t._v("《审批接入（流程表单）》")]),t._v("，讲解的是「业务接入（业务表单）」的流程：业务需建立独立的数据库表，并开发对应的表单、详情界面。")],1),t._v(" "),a("p",[t._v("整个过程，还是：")]),t._v(" "),a("ol",[a("li",[t._v("定义流程：【管理员】新建流程、设计流程模型、并设置用户任务的审批人，最终发布流程")]),t._v(" "),a("li",[t._v("发起流程：【员工】选择流程，并发起流程实例")]),t._v(" "),a("li",[t._v("审批流程：【审批人】接收到流程任务，审批结果为通过或不通过")])]),t._v(" "),a("p",[a("img",{attrs:{src:"/img/%E5%B7%A5%E4%BD%9C%E6%B5%81%E6%89%8B%E5%86%8C/%E7%AE%80%E5%8D%95%E4%B8%9A%E5%8A%A1%E6%8E%A5%E5%85%A5/%E7%A4%BA%E4%BE%8B%E6%B5%81%E7%A8%8B.png",alt:"示例流程"}})]),t._v(" "),a("h2",{attrs:{id:"_1-业务接入-业务表单"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-业务接入-业务表单"}},[t._v("#")]),t._v(" 1. 业务接入（业务表单）")]),t._v(" "),a("p",[t._v("根据业务需要，业务通过建立独立的数据库表（业务表）记录申请信息，而流程引擎只负责推动流程的前进或者结束。两者需要进行"),a("strong",[t._v("双向")]),t._v("的关联：")]),t._v(" "),a("ul",[a("li",[t._v("每一条业务表记录，通过它的流程实例的编号( "),a("code",[t._v("process_instance_id")]),t._v(" )指向对应的流程实例")]),t._v(" "),a("li",[t._v("每一个流程实例，通过它的业务键( "),a("code",[t._v("BUSINESS_KEY_")]),t._v(" ) 指向对应的业务表记录")])]),t._v(" "),a("p",[t._v("以项目中提供的 "),a("a",{attrs:{href:"https://github.com/YunaiV/ruoyi-vue-pro/blob/master/yudao-module-bpm/yudao-module-bpm-biz/src/main/java/cn/iocoder/yudao/module/bpm/service/oa/BpmOALeaveServiceImpl.java",target:"_blank",rel:"noopener noreferrer"}},[t._v("OALeave"),a("OutboundLink")],1),t._v(" 请假举例子，它的业务表 "),a("code",[t._v("bpm_oa_leave")]),t._v(" 和流程引擎的流程实例的关系如下图：")]),t._v(" "),a("p",[a("img",{attrs:{src:"/img/%E5%B7%A5%E4%BD%9C%E6%B5%81%E6%89%8B%E5%86%8C/%E5%A4%8D%E6%9D%82%E4%B8%9A%E5%8A%A1%E6%8E%A5%E5%85%A5/%E8%AF%B7%E5%81%87%E5%8D%95%E6%95%B0%E6%8D%AE%E5%BA%93%E8%A1%A8.png",alt:"请假单数据库表"}})]),t._v(" "),a("p",[t._v("也因为业务建立了独立的业务表，所以必须开发业务表对应的列表、表单、详情页面。不过，审核相关的功能是无需重新开发的，原因是业务表已经关联对应的流程实例，流程引擎审批流程实例即可。")]),t._v(" "),a("p",[t._v("下面，我们以项目中的 "),a("a",{attrs:{href:"https://github.com/YunaiV/ruoyi-vue-pro/blob/master/yudao-module-bpm/yudao-module-bpm-biz/src/main/java/cn/iocoder/yudao/module/bpm/service/oa/BpmOALeaveServiceImpl.java",target:"_blank",rel:"noopener noreferrer"}},[t._v("OALeave"),a("OutboundLink")],1),t._v(" 为例子，详细讲解下业务表单的开发与使用的过程。")]),t._v(" "),a("h3",{attrs:{id:"_1-0-第零步-业务开发"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-0-第零步-业务开发"}},[t._v("#")]),t._v(" 1.0 第零步：业务开发")]),t._v(" "),a("h4",{attrs:{id:"_1-0-1-新建业务表"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-0-1-新建业务表"}},[t._v("#")]),t._v(" 1.0.1 新建业务表")]),t._v(" "),a("p",[t._v("新建业务表 "),a("code",[t._v("bpm_oa_leave")]),t._v("，建表语句如下：")]),t._v(" "),a("div",{staticClass:"language-SQL extra-class"},[a("pre",{pre:!0,attrs:{class:"language-sql"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("CREATE")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("TABLE")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token identifier"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("`")]),t._v("bpm_oa_leave"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("`")])]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token identifier"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("`")]),t._v("id"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("`")])]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("bigint")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("NOT")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("NULL")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("AUTO_INCREMENT")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("COMMENT")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'请假表单主键'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token identifier"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("`")]),t._v("user_id"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("`")])]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("bigint")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("NOT")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("NULL")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("COMMENT")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'申请人的用户编号'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token identifier"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("`")]),t._v("type"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("`")])]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("tinyint")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("NOT")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("NULL")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("COMMENT")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'请假类型'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token identifier"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("`")]),t._v("reason"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("`")])]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("varchar")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("200")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("CHARACTER")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("SET")]),t._v(" utf8mb4 "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("COLLATE")]),t._v(" utf8mb4_unicode_ci "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("NOT")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("NULL")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("COMMENT")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'请假原因'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token identifier"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("`")]),t._v("start_time"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("`")])]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("datetime")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("NOT")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("NULL")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("COMMENT")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'开始时间'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token identifier"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("`")]),t._v("end_time"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("`")])]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("datetime")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("NOT")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("NULL")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("COMMENT")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'结束时间'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token identifier"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("`")]),t._v("day"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("`")])]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("tinyint")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("NOT")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("NULL")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("COMMENT")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'请假天数'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token identifier"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("`")]),t._v("status"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("`")])]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("tinyint")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("NOT")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("NULL")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("COMMENT")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'请假结果'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token identifier"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("`")]),t._v("process_instance_id"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("`")])]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("varchar")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("64")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("CHARACTER")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("SET")]),t._v(" utf8mb4 "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("COLLATE")]),t._v(" utf8mb4_unicode_ci "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("DEFAULT")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("NULL")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("COMMENT")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'流程实例的编号'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token identifier"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("`")]),t._v("creator"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("`")])]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("varchar")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("64")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("CHARACTER")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("SET")]),t._v(" utf8mb4 "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("COLLATE")]),t._v(" utf8mb4_unicode_ci "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("DEFAULT")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("''")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("COMMENT")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'创建者'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token identifier"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("`")]),t._v("create_time"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("`")])]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("datetime")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("NOT")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("NULL")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("DEFAULT")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("CURRENT_TIMESTAMP")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("COMMENT")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'创建时间'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token identifier"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("`")]),t._v("updater"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("`")])]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("varchar")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("64")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("CHARACTER")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("SET")]),t._v(" utf8mb4 "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("COLLATE")]),t._v(" utf8mb4_unicode_ci "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("DEFAULT")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("''")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("COMMENT")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'更新者'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token identifier"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("`")]),t._v("update_time"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("`")])]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("datetime")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("NOT")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("NULL")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("DEFAULT")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("CURRENT_TIMESTAMP")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("ON")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("UPDATE")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("CURRENT_TIMESTAMP")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("COMMENT")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'更新时间'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token identifier"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("`")]),t._v("deleted"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("`")])]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("bit")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("NOT")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("NULL")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("DEFAULT")]),t._v(" b"),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'0'")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("COMMENT")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'是否删除'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token identifier"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("`")]),t._v("tenant_id"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("`")])]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("bigint")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("NOT")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("NULL")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("DEFAULT")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'0'")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("COMMENT")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'租户编号'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("PRIMARY")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("KEY")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token identifier"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("`")]),t._v("id"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("`")])]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("USING")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("BTREE")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("ENGINE")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("InnoDB")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("AUTO_INCREMENT")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("26")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("DEFAULT")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("CHARSET")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("utf8mb4 "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("COLLATE")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("utf8mb4_unicode_ci "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("COMMENT")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'OA 请假申请表'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),a("p",[t._v("重点是两个字段：")]),t._v(" "),a("ul",[a("li",[a("code",[t._v("process_instance_id")]),t._v(" 字段，关联流程引擎的流程实例对应的 "),a("code",[t._v("ACT_HI_PROCINST")]),t._v(" 表的 "),a("code",[t._v("PROC_INST_ID_")]),t._v(" 字段")]),t._v(" "),a("li",[a("code",[t._v("status")]),t._v(" 字段，请假结果，需要通过 Listener 监听回调结果，稍后来看看")])]),t._v(" "),a("h4",{attrs:{id:"_1-0-2-【后端】实现业务逻辑"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-0-2-【后端】实现业务逻辑"}},[t._v("#")]),t._v(" 1.0.2 【后端】实现业务逻辑")]),t._v(" "),a("p",[t._v("实现业务表的【后端】业务逻辑，具体代码可以看看如下两个类：")]),t._v(" "),a("ul",[a("li",[a("a",{attrs:{href:"https://github.com/YunaiV/ruoyi-vue-pro/blob/master/yudao-module-bpm/yudao-module-bpm-biz/src/main/java/cn/iocoder/yudao/module/bpm/controller/admin/oa/BpmOALeaveController.java",target:"_blank",rel:"noopener noreferrer"}},[t._v("BpmOALeaveController"),a("OutboundLink")],1)]),t._v(" "),a("li",[a("a",{attrs:{href:"https://github.com/YunaiV/ruoyi-vue-pro/blob/master/yudao-module-bpm/yudao-module-bpm-biz/src/main/java/cn/iocoder/yudao/module/bpm/service/oa/BpmOALeaveServiceImpl.java",target:"_blank",rel:"noopener noreferrer"}},[t._v("BpmOALeaveServiceImpl"),a("OutboundLink")],1)])]),t._v(" "),a("p",[t._v("重点是看流程发起的逻辑，它定义了 "),a("code",[t._v("/bpm/oa/leave/create")]),t._v(" 给业务的表单界面调用，UML 时序图如下：")]),t._v(" "),a("p",[a("img",{attrs:{src:"/img/%E5%B7%A5%E4%BD%9C%E6%B5%81%E6%89%8B%E5%86%8C/%E5%A4%8D%E6%9D%82%E4%B8%9A%E5%8A%A1%E6%8E%A5%E5%85%A5/%E5%90%8E%E7%BB%AD%E6%97%B6%E5%BA%8F%E5%9B%BE.png",alt:"后续时序图"}})]),t._v(" "),a("p",[t._v("具体的实现代码比较简单，如下图所示：")]),t._v(" "),a("p",[a("img",{attrs:{src:"/img/%E5%B7%A5%E4%BD%9C%E6%B5%81%E6%89%8B%E5%86%8C/%E5%A4%8D%E6%9D%82%E4%B8%9A%E5%8A%A1%E6%8E%A5%E5%85%A5/%E5%88%9B%E5%BB%BA%E6%B5%81%E7%A8%8B%E7%9A%84%E9%80%BB%E8%BE%91.png",alt:"BpmOALeaveServiceImpl 创建流程的逻辑"}})]),t._v(" "),a("ul",[a("li",[a("code",[t._v("PROCESS_KEY")]),t._v(" 静态变量：是业务对应的流程模型的编号，稍后会进行创建编号为 oa_leave 的流程模型。")]),t._v(" "),a("li",[a("a",{attrs:{href:"https://github.com/YunaiV/ruoyi-vue-pro/blob/master/yudao-module-bpm/yudao-module-bpm-api/src/main/java/cn/iocoder/yudao/module/bpm/api/task/BpmProcessInstanceApi.java",target:"_blank",rel:"noopener noreferrer"}},[t._v("BpmProcessInstanceApi"),a("OutboundLink")],1),t._v(" 定义了 "),a("code",[t._v("#createProcessInstance(...)")]),t._v(" 方法，用于创建流程实例，业务无需关心底层是 Flowable 引擎，还是 Activiti、Camunda 引擎。")])]),t._v(" "),a("h4",{attrs:{id:"_1-0-3-【前端】实现业务逻辑"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-0-3-【前端】实现业务逻辑"}},[t._v("#")]),t._v(" 1.0.3 【前端】实现业务逻辑")]),t._v(" "),a("p",[t._v("实现业务表的【前端】业务逻辑，具体代码可以看看如下三个页面：")]),t._v(" "),a("ul",[a("li",[t._v("请假发起界面："),a("a",{attrs:{href:"https://github.com/yudaocode/yudao-ui-admin-vue3/blob/master/src/views/bpm/oa/leave/create.vue",target:"_blank",rel:"noopener noreferrer"}},[a("code",[t._v("leave/create.vue")]),a("OutboundLink")],1)]),t._v(" "),a("li",[t._v("请假详情界面："),a("a",{attrs:{href:"https://github.com/yudaocode/yudao-ui-admin-vue3/blob/master/src/views/bpm/oa/leave/detail.vue",target:"_blank",rel:"noopener noreferrer"}},[a("code",[t._v("leave/detail.vue")]),a("OutboundLink")],1)]),t._v(" "),a("li",[t._v("请假列表界面："),a("a",{attrs:{href:"https://github.com/yudaocode/yudao-ui-admin-vue3/blob/master/src/views/bpm/oa/leave/index.vue",target:"_blank",rel:"noopener noreferrer"}},[a("code",[t._v("leave/index.vue")]),a("OutboundLink")],1)])]),t._v(" "),a("p",[t._v("另外，在 "),a("a",{attrs:{href:"https://github.com/yudaocode/yudao-ui-admin-vue3/blob/master/src/router/modules/remaining.ts#L305-L328",target:"_blank",rel:"noopener noreferrer"}},[a("code",[t._v("router/modules/remaining.ts")]),a("OutboundLink")],1),t._v(" 中定义 "),a("code",[t._v("create.vue")]),t._v(" 和 "),a("code",[t._v("detail.vue")]),t._v(" 的路由，配置如下：")]),t._v(" "),a("div",{staticClass:"language-javascript extra-class"},[a("pre",{pre:!0,attrs:{class:"language-javascript"}},[a("code",[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("path")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'/bpm'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("component")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" Layout"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("name")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'bpm'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("meta")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("hidden")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("true")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("children")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("path")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'oa/leave/create'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token function-variable function"}},[t._v("component")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'@/views/bpm/oa/leave/create.vue'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("name")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'OALeaveCreate'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("meta")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n          "),a("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("noCache")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("true")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n          "),a("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("hidden")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("true")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n          "),a("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("canTo")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("true")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n          "),a("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("title")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'发起 OA 请假'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n          "),a("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("activeMenu")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'/bpm/oa/leave'")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("path")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'oa/leave/detail'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token function-variable function"}},[t._v("component")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'@/views/bpm/oa/leave/detail.vue'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("name")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'OALeaveDetail'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("meta")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n          "),a("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("noCache")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("true")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n          "),a("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("hidden")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("true")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n          "),a("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("canTo")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("true")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n          "),a("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("title")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'查看 OA 请假'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n          "),a("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("activeMenu")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'/bpm/oa/leave'")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),a("div",{staticClass:"custom-block tip"},[a("p",{staticClass:"custom-block-title"},[t._v("为什么要做独立的 `create.vue` 和 `index.vue` 页面？")]),t._v(" "),a("ul",[a("li",[t._v("创建流程时，需要跳转到 "),a("code",[t._v("create.vue")]),t._v(" 页面，填写业务表的信息，才能提交流程。")]),t._v(" "),a("li",[t._v("审批流程时，需要跳转到 "),a("code",[t._v("detail.vue")]),t._v(" 页面，查看业务表的信息。")])])]),t._v(" "),a("h4",{attrs:{id:"_1-0-4-【实现】实现审批结果的监听"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-0-4-【实现】实现审批结果的监听"}},[t._v("#")]),t._v(" 1.0.4 【实现】实现审批结果的监听")]),t._v(" "),a("p",[t._v("审批结束时（例如说流程实例最终被审批通过、不通过、取消），后端需要监听审批结果，然后更新业务表的状态。")]),t._v(" "),a("p",[t._v("具体可见 "),a("a",{attrs:{href:"https://github.com/YunaiV/ruoyi-vue-pro/blob/master/yudao-module-bpm/yudao-module-bpm-biz/src/main/java/cn/iocoder/yudao/module/bpm/service/oa/listener/BpmOALeaveStatusListener.java",target:"_blank",rel:"noopener noreferrer"}},[t._v("BpmOALeaveStatusListener"),a("OutboundLink")],1),t._v(" 监听器，它实现流程引擎定义的 "),a("a",{attrs:{href:"https://github.com/YunaiV/ruoyi-vue-pro/blob/master/yudao-module-bpm/yudao-module-bpm-api/src/main/java/cn/iocoder/yudao/module/bpm/event/BpmProcessInstanceStatusEventListener.java",target:"_blank",rel:"noopener noreferrer"}},[t._v("BpmProcessInstanceStatusEventListener"),a("OutboundLink")],1),t._v(" 抽象类，在流程实例结束时，回调通知它"),a("strong",[t._v("最终的")]),t._v("结果是通过还是不通过。代码如下图：")]),t._v(" "),a("p",[a("img",{attrs:{src:"/img/%E5%B7%A5%E4%BD%9C%E6%B5%81%E6%89%8B%E5%86%8C/%E5%A4%8D%E6%9D%82%E4%B8%9A%E5%8A%A1%E6%8E%A5%E5%85%A5/%E7%9B%91%E5%90%AC%E7%BB%93%E6%9E%9C.png",alt:"BpmOALeaveStatusListener 监听结果"}})]),t._v(" "),a("div",{staticClass:"custom-block tip"},[a("p",{staticClass:"custom-block-title"},[t._v("友情提示：BpmProcessInstanceStatusEventListener 是什么呢？")]),t._v(" "),a("p",[t._v("BpmProcessInstanceStatusEventListener 是我们框架自己封装的一个监听器，用于监听流程实例的最终结果。在流程实例结束时，会回调通知它。")]),t._v(" "),a("p",[t._v("如果你自己的业务接入工作流，并且需要监听审批结果，必须继承它，实现自己的监听器！！！")])]),t._v(" "),a("hr"),t._v(" "),a("p",[t._v("至此，我们了解了 OALeave 使用业务表单所涉及到的开发，下面我们来定义对应的流程、发起该流程、并审批该流程。")]),t._v(" "),a("div",{staticClass:"custom-block tip"},[a("p",{staticClass:"custom-block-title"},[t._v("友情提示：从这一步开始，和「1. 请假流程【流程表单】」的流程基本是一致的，所以重点还是上面。")])]),t._v(" "),a("h3",{attrs:{id:"_2-1-第一步-定义流程"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-1-第一步-定义流程"}},[t._v("#")]),t._v(" 2.1 第一步：定义流程")]),t._v(" "),a("p",[t._v("登录账号 admin、密码 admin123 的用户，扮演【管理员】的角色，进行流程的定义。")]),t._v(" "),a("h4",{attrs:{id:"_1-1-1-新建流程"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-1-1-新建流程"}},[t._v("#")]),t._v(" 1.1.1 新建流程")]),t._v(" "),a("p",[t._v("访问 [工作流程 -> 流程管理 -> 流程模型] 菜单，点击「新建流程」按钮，填写流程标识、流程名称。如下图所示：")]),t._v(" "),a("p",[a("img",{attrs:{src:"/img/%E5%B7%A5%E4%BD%9C%E6%B5%81%E6%89%8B%E5%86%8C/%E5%A4%8D%E6%9D%82%E4%B8%9A%E5%8A%A1%E6%8E%A5%E5%85%A5/%E6%96%B0%E5%BB%BA%E6%B5%81%E7%A8%8B.png",alt:"新建流程"}})]),t._v(" "),a("p",[t._v("注意，流程标识需要填 "),a("code",[t._v("oa_leave")]),t._v("。因为在 BpmOALeaveServiceImpl 类中，发起流程的标识是 "),a("code",[t._v("oa_leave")]),t._v("。")]),t._v(" "),a("h4",{attrs:{id:"_1-1-2-修改流程"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-1-2-修改流程"}},[t._v("#")]),t._v(" 1.1.2 修改流程")]),t._v(" "),a("p",[t._v("点击「修改流程」按钮，配置表单类型为业务表单，填写表单提交路由为 "),a("code",[t._v("/bpm/oa/leave/create")]),t._v("（用于发起流程时，跳转的业务表单的路由）、表单查看路由为 "),a("code",[t._v("/bpm/oa/leave/detail")]),t._v("（用于在流程详情中，点击查看表单的路由）。如下图所示：")]),t._v(" "),a("p",[a("img",{attrs:{src:"/img/%E5%B7%A5%E4%BD%9C%E6%B5%81%E6%89%8B%E5%86%8C/%E5%A4%8D%E6%9D%82%E4%B8%9A%E5%8A%A1%E6%8E%A5%E5%85%A5/%E4%BF%AE%E6%94%B9%E6%B5%81%E7%A8%8B.png",alt:"修改流程"}})]),t._v(" "),a("div",{staticClass:"custom-block tip"},[a("p",{staticClass:"custom-block-title"},[t._v("友情提示：注意！！！`/bpm/oa/leave/create` 和 `/bpm/oa/leave/detail`，都是相对 `/views` 开始的 Vue 文件的路径！！！")])]),t._v(" "),a("h4",{attrs:{id:"_1-1-3-设计流程"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-1-3-设计流程"}},[t._v("#")]),t._v(" 1.1.3 设计流程")]),t._v(" "),a("p",[t._v("① 点击「设计流程」按钮，在线设计请假流程模型，包含两个用户任务：领导审批、HR 审批。如下图所示：")]),t._v(" "),a("p",[a("img",{attrs:{src:"/img/%E5%B7%A5%E4%BD%9C%E6%B5%81%E6%89%8B%E5%86%8C/%E5%A4%8D%E6%9D%82%E4%B8%9A%E5%8A%A1%E6%8E%A5%E5%85%A5/%E8%AE%BE%E8%AE%A1%E6%B5%81%E7%A8%8B.png",alt:"设计流程"}})]),t._v(" "),a("p",[t._v("可以点击 "),a("a",{attrs:{href:"/img/%E5%B7%A5%E4%BD%9C%E6%B5%81/oa_leave_bpmn.XML"}},[a("code",[t._v("oa_leave_bpmn.XML")])]),t._v(" 进行下载，然后点击「打开文件」按钮，进行导入。")]),t._v(" "),a("p",[t._v("② 点击图中的“领导审批”，规则类型为“流程表达式”，流程表达式为 "),a("code",[t._v("${bpmTaskAssignLeaderExpression.calculateUsers(execution, 1)}")]),t._v("。如下图所示：")]),t._v(" "),a("p",[a("img",{attrs:{src:"/img/%E5%B7%A5%E4%BD%9C%E6%B5%81%E6%89%8B%E5%86%8C/%E5%A4%8D%E6%9D%82%E4%B8%9A%E5%8A%A1%E6%8E%A5%E5%85%A5/%E8%AE%BE%E7%BD%AE%E5%AE%A1%E6%89%B9%E4%BA%BA-%E9%A2%86%E5%AF%BC%E5%AE%A1%E6%89%B9.png",alt:"设置审批人 - 领导审批"}})]),t._v(" "),a("div",{staticClass:"custom-block tip"},[a("p",{staticClass:"custom-block-title"},[t._v("友情提示：该流程表达式的作用是，流程发起人的一级领导。")]),t._v(" "),a("p",[t._v("为什么呢？这块我们在 "),a("RouterLink",{attrs:{to:"/bpm/expression/"}},[t._v("《流程表达式》")]),t._v(" 详细讲解。")],1)]),t._v(" "),a("p",[t._v("点击图中的“HR 审批”，规则类型为“岗位”，指定岗位为“人力资源”。如下图所示：")]),t._v(" "),a("p",[a("img",{attrs:{src:"/img/%E5%B7%A5%E4%BD%9C%E6%B5%81%E6%89%8B%E5%86%8C/%E5%A4%8D%E6%9D%82%E4%B8%9A%E5%8A%A1%E6%8E%A5%E5%85%A5/%E8%AE%BE%E7%BD%AE%E5%AE%A1%E6%89%B9%E4%BA%BA-HR%E5%AE%A1%E6%89%B9.png",alt:"设置审批人 - HR 审批"}})]),t._v(" "),a("p",[t._v("之后，点击右上角的「保存模型」按钮，完成流程模型的设计。")]),t._v(" "),a("p",[t._v("③ 点击「发布流程」按钮，把定义的流程模型部署出去。部署成功后，就可以发起该流程了。")]),t._v(" "),a("h3",{attrs:{id:"_2-2-第二步-发起流程"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-2-第二步-发起流程"}},[t._v("#")]),t._v(" 2.2 第二步：发起流程")]),t._v(" "),a("p",[t._v("登录账号 admin、密码 admin123 的用户，扮演【员工】的角色，进行流程的发起。")]),t._v(" "),a("p",[t._v("① 发起业务表单请假流程，两种路径：")]),t._v(" "),a("ol",[a("li",[a("p",[t._v("访问 [工作流程 -> 审批中心 -> 发起流程] 菜单，选择“OA 请求”流程，会跳转到流程模型 "),a("code",[t._v("oa_leave")]),t._v(" 配置的表单提交路由。\n"),a("img",{attrs:{src:"/img/%E5%B7%A5%E4%BD%9C%E6%B5%81%E6%89%8B%E5%86%8C/%E5%A4%8D%E6%9D%82%E4%B8%9A%E5%8A%A1%E6%8E%A5%E5%85%A5/%E5%8F%91%E8%B5%B7%E6%B5%81%E7%A8%8B01.png",alt:"路径一：我的流程 -> 发起流程"}})])]),t._v(" "),a("li",[a("p",[t._v("访问 [工作流程 -> OA 示例 -> 请假查询] 菜单，点击「发起请假」按钮。\n"),a("img",{attrs:{src:"/img/%E5%B7%A5%E4%BD%9C%E6%B5%81%E6%89%8B%E5%86%8C/%E5%A4%8D%E6%9D%82%E4%B8%9A%E5%8A%A1%E6%8E%A5%E5%85%A5/%E5%8F%91%E8%B5%B7%E6%B5%81%E7%A8%8B02.png",alt:"路径二：请假查询 -> 发起请假"}})])])]),t._v(" "),a("p",[t._v("② 填写一个小于等于 3 天的请假，只会走【领导审批】任务；填写一个大于 3 天的请假，在走完【领导审批】任务后，会额外走【HR 审批】任务。")]),t._v(" "),a("p",[t._v("后续的流程，和 "),a("RouterLink",{attrs:{to:"/bpm/use-bpm-form/"}},[t._v("审批接入（流程表单）")]),t._v(" 是基本一致的，这里就不重复赘述，当然你还是要试着跑一跑，了解整个的过程。")],1),t._v(" "),a("h3",{attrs:{id:"_2-3-第三步-审批流程"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-3-第三步-审批流程"}},[t._v("#")]),t._v(" 2.3 第三步：审批流程")]),t._v(" "),a("p",[t._v("略~自己跑")]),t._v(" "),a("ul",[a("li",[t._v("登录账号 test、密码 test123 的用户，扮演【审批人】的角色，进行请假流程的【领导审批】任务")]),t._v(" "),a("li",[t._v("登录账号 hrmgr、密码 hr123 的用户，扮演【审批人】的角色，进行请假流程的【HR 审批】任务")])]),t._v(" "),a("h2",{attrs:{id:"_2-选择业务表单、流程表单"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-选择业务表单、流程表单"}},[t._v("#")]),t._v(" 2. 选择业务表单、流程表单？")]),t._v(" "),a("p",[t._v("流程表单，适合简单业务，无需开发的那种。大多数场景下，我们还是选择业务表单，例如说：")]),t._v(" "),a("ul",[a("li",[a("a",{attrs:{href:"/crm/contract"}},[t._v("《CRM 手册 —— 【合同】合同管理、合同提醒》")]),t._v(" 的合同审批")]),t._v(" "),a("li",[a("a",{attrs:{href:"/crm/receivable"}},[t._v("《CRM 手册 —— 【回款】回款管理、回款计划》")]),t._v(" 的回款审批")])]),t._v(" "),a("p",[t._v("也就是说，审批只是业务的一个环节，而不是整个业务的所有。所以，我们选择业务表单，是为了更好的支持业务的复杂度。")]),t._v(" "),a("h2",{attrs:{id:"_3-业务表单是如何集成的"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_3-业务表单是如何集成的"}},[t._v("#")]),t._v(" 3. 业务表单是如何集成的？")]),t._v(" "),a("p",[t._v("① 流程发起时，会跳转流程模型配置的“表单提交路由”，代码如下图所示：")]),t._v(" "),a("p",[a("img",{attrs:{src:"/img/%E5%B7%A5%E4%BD%9C%E6%B5%81%E6%89%8B%E5%86%8C/%E5%A4%8D%E6%9D%82%E4%B8%9A%E5%8A%A1%E6%8E%A5%E5%85%A5/%E4%B8%9A%E5%8A%A1%E8%A1%A8%E5%8D%95-%E5%8F%91%E8%B5%B7.png",alt:"业务表单 - 发起"}})]),t._v(" "),a("p",[t._v("② 流程详情时，需要展示业务表单详情时，通过 "),a("a",{attrs:{href:"https://cn.vuejs.org/guide/components/async",target:"_blank",rel:"noopener noreferrer"}},[t._v("Vue3 异步组件"),a("OutboundLink")],1),t._v(" 特性，将展示流程模型配置的“表单查看路由”，代码如下图所示：")]),t._v(" "),a("p",[a("img",{attrs:{src:"/img/%E5%B7%A5%E4%BD%9C%E6%B5%81%E6%89%8B%E5%86%8C/%E5%A4%8D%E6%9D%82%E4%B8%9A%E5%8A%A1%E6%8E%A5%E5%85%A5/%E4%B8%9A%E5%8A%A1%E8%A1%A8%E5%8D%95-%E8%AF%A6%E6%83%85.png",alt:"业务表单 - 详情"}})])])}),[],!1,null,null,null);a.default=r.exports}}]);