(window.webpackJsonp=window.webpackJsonp||[]).push([[171],{502:function(e,r,a){"use strict";a.r(r);var t=a(7),s=Object(t.a)({},(function(){var e=this,r=e._self._c;return r("ContentSlotsDistributor",{attrs:{"slot-key":e.$parent.slotKey}},[r("p",[e._v("本章节，讲解公众号粉丝的相关内容，包括关注、取消关注等等，对应 "),r("a",{attrs:{href:"https://developers.weixin.qq.com/doc/offiaccount/User_Management/Getting_a_User_List.html",target:"_blank",rel:"noopener noreferrer"}},[e._v("《微信公众号官方文档 —— 获取用户列表》"),r("OutboundLink")],1),e._v(" 文档。")]),e._v(" "),r("p",[r("img",{attrs:{src:"/img/%E5%85%AC%E4%BC%97%E5%8F%B7%E6%89%8B%E5%86%8C/%E5%85%AC%E4%BC%97%E5%8F%B7%E7%B2%89%E4%B8%9D/%E7%95%8C%E9%9D%A2.png",alt:"粉丝管理"}})]),e._v(" "),r("h2",{attrs:{id:"_1-表结构"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#_1-表结构"}},[e._v("#")]),e._v(" 1. 表结构")]),e._v(" "),r("p",[e._v("公众号粉丝对应 "),r("code",[e._v("mp_user")]),e._v(" 表，结构如下图所示：")]),e._v(" "),r("p",[r("img",{attrs:{src:"/img/%E5%85%AC%E4%BC%97%E5%8F%B7%E6%89%8B%E5%86%8C/%E5%85%AC%E4%BC%97%E5%8F%B7%E7%B2%89%E4%B8%9D/%E8%A1%A8%E7%BB%93%E6%9E%84.png",alt:"表结构"}})]),e._v(" "),r("p",[e._v("注意，自 2021-12-27 开始，公众号接口不再返回头像和昵称，只能通过微信公众号的网页登录获取。因此，表中的 "),r("code",[e._v("avatar")]),e._v(" 和 "),r("code",[e._v("nickname")]),e._v(" 字段，往往是空的。")]),e._v(" "),r("h2",{attrs:{id:"_2-粉丝管理界面"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#_2-粉丝管理界面"}},[e._v("#")]),e._v(" 2. 粉丝管理界面")]),e._v(" "),r("ul",[r("li",[e._v("前端："),r("a",{attrs:{href:"https://github.com/yudaocode/yudao-ui-admin-vue2/blob/master/src/views/mp/user/index.vue",target:"_blank",rel:"noopener noreferrer"}},[e._v("/@views/mp/user"),r("OutboundLink")],1)]),e._v(" "),r("li",[e._v("后端："),r("a",{attrs:{href:"https://github.com/YunaiV/ruoyi-vue-pro/blob/master/yudao-module-mp/yudao-module-mp-biz/src/main/java/cn/iocoder/yudao/module/mp/controller/admin/user/MpUserController.java",target:"_blank",rel:"noopener noreferrer"}},[e._v("MpUserController"),r("OutboundLink")],1)])]),e._v(" "),r("h2",{attrs:{id:"_3-同步粉丝"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#_3-同步粉丝"}},[e._v("#")]),e._v(" 3. 同步粉丝")]),e._v(" "),r("p",[e._v("点击粉丝管理界面的【同步】按钮，可以 "),r("strong",[e._v("异步")]),e._v(" 从公众号同步所有的粉丝信息，存储到 "),r("code",[e._v("mp_user")]),e._v(" 表中。如果你的粉丝较多，可能需要等待一段时间。")]),e._v(" "),r("p",[e._v("对应后端的 "),r("a",{attrs:{href:"https://github.com/YunaiV/ruoyi-vue-pro/blob/master/yudao-module-mp/yudao-module-mp-biz/src/main/java/cn/iocoder/yudao/module/mp/service/user/MpUserServiceImpl.java#L95-L161",target:"_blank",rel:"noopener noreferrer"}},[e._v("MpUserServiceImpl"),r("OutboundLink")],1),e._v(" 的 "),r("code",[e._v("syncUser")]),e._v(" 方法。")]),e._v(" "),r("h2",{attrs:{id:"_4-关注-subscribehandler"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#_4-关注-subscribehandler"}},[e._v("#")]),e._v(" 4. 关注 SubscribeHandler")]),e._v(" "),r("p",[e._v("用户关注公众号时，会触发 "),r("a",{attrs:{href:"https://github.com/YunaiV/ruoyi-vue-pro/blob/master/yudao-module-mp/yudao-module-mp-biz/src/main/java/cn/iocoder/yudao/module/mp/service/handler/user/SubscribeHandler.java",target:"_blank",rel:"noopener noreferrer"}},[e._v("SubscribeHandler"),r("OutboundLink")],1),e._v(" 处理器，新增或修改 "),r("code",[e._v("mp_user")]),e._v(" 粉丝信息。")]),e._v(" "),r("p",[r("img",{attrs:{src:"/img/%E5%85%AC%E4%BC%97%E5%8F%B7%E6%89%8B%E5%86%8C/%E5%85%AC%E4%BC%97%E5%8F%B7%E7%B2%89%E4%B8%9D/SubscribeHandler.png",alt:"SubscribeHandler"}})]),e._v(" "),r("h2",{attrs:{id:"_5-取关-unsubscribehandler"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#_5-取关-unsubscribehandler"}},[e._v("#")]),e._v(" 5. 取关 UnsubscribeHandler")]),e._v(" "),r("p",[e._v("用户取消关注公众号时，会触发 "),r("a",{attrs:{href:"https://github.com/YunaiV/ruoyi-vue-pro/blob/master/yudao-module-mp/yudao-module-mp-biz/src/main/java/cn/iocoder/yudao/module/mp/service/handler/user/UnsubscribeHandler.java",target:"_blank",rel:"noopener noreferrer"}},[e._v("UnsubscribeHandler"),r("OutboundLink")],1),e._v(" 处理器，标记 "),r("code",[e._v("mp_user")]),e._v(" 粉丝信息为取消关注，设置 "),r("code",[e._v("subscribe_status")]),e._v(" 字段为 0。")]),e._v(" "),r("p",[r("img",{attrs:{src:"/img/%E5%85%AC%E4%BC%97%E5%8F%B7%E6%89%8B%E5%86%8C/%E5%85%AC%E4%BC%97%E5%8F%B7%E7%B2%89%E4%B8%9D/UnsubscribeHandler.png",alt:"UnsubscribeHandler"}})])])}),[],!1,null,null,null);r.default=s.exports}}]);