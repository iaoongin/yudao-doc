(window.webpackJsonp=window.webpackJsonp||[]).push([[31],{360:function(t,s,a){"use strict";a.r(s);var e=a(7),r=Object(e.a)({},(function(){var t=this,s=t._self._c;return s("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[s("p",[t._v("系统对接国内多个第三方平台，实现三方登录的功能。例如说：")]),t._v(" "),s("ul",[s("li",[t._v("管理后台：企业微信、阿里钉钉")]),t._v(" "),s("li",[t._v("用户 App：微信公众号、微信小程序")])]),t._v(" "),s("p",[s("img",{attrs:{src:"/img/%E4%B8%89%E6%96%B9%E7%99%BB%E5%BD%95/01.png",alt:"管理后台"}})]),t._v(" "),s("div",{staticClass:"custom-block tip"},[s("p",{staticClass:"custom-block-title"},[t._v("友情提示：为了表述方便，本文主要使用管理后台的三方登录作为示例。")]),t._v(" "),s("p",[t._v("用户 App 也是支持该功能，你可以自己去体验一下。")])]),t._v(" "),s("h2",{attrs:{id:"_1-表结构"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_1-表结构"}},[t._v("#")]),t._v(" 1. 表结构")]),t._v(" "),s("p",[s("img",{attrs:{src:"/img/%E4%B8%89%E6%96%B9%E7%99%BB%E5%BD%95/02.png",alt:""}})]),t._v(" "),s("p",[t._v("① 三方登录完成时，系统会将三方用户存储到 "),s("a",{attrs:{href:"https://github.com/YunaiV/ruoyi-vue-pro/blob/master/yudao-module-system/yudao-module-system-biz/src/main/java/cn/iocoder/yudao/module/system/dal/dataobject/social/SocialUserDO.java",target:"_blank",rel:"noopener noreferrer"}},[s("code",[t._v("system_social_user")]),s("OutboundLink")],1),t._v(" 表中，通过 "),s("a",{attrs:{href:"https://github.com/YunaiV/ruoyi-vue-pro/blob/master/yudao-module-system/yudao-module-system-api/src/main/java/cn/iocoder/yudao/module/system/enums/social/SocialTypeEnum.java",target:"_blank",rel:"noopener noreferrer"}},[s("code",[t._v("type")]),s("OutboundLink")],1),t._v(" 标记对应的第三方平台。")]),t._v(" "),s("p",[t._v("② 【未】关联本系统 User 的三方用户，需要在三方登录完成后，使用账号密码进行「"),s("strong",[t._v("绑定登录")]),t._v("」，成功后记录到 "),s("a",{attrs:{href:"https://github.com/YunaiV/ruoyi-vue-pro/blob/master/yudao-module-system/yudao-module-system-biz/src/main/java/cn/iocoder/yudao/module/system/dal/dataobject/social/SocialUserBindDO.java",target:"_blank",rel:"noopener noreferrer"}},[s("code",[t._v("system_social_user_bind")]),s("OutboundLink")],1),t._v(" 表中。")]),t._v(" "),s("p",[t._v("【已】关联本系统 User 的三方用户，在三方登录完成后，直接进入系统，即「"),s("strong",[t._v("快捷登录")]),t._v("」。")]),t._v(" "),s("h2",{attrs:{id:"_2-绑定登录"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_2-绑定登录"}},[t._v("#")]),t._v(" 2. 绑定登录")]),t._v(" "),s("p",[t._v("① 使用浏览器访问 "),s("a",{attrs:{href:"http://127.0.0.1:1024/login",target:"_blank",rel:"noopener noreferrer"}},[t._v("http://127.0.0.1:1024/login"),s("OutboundLink")],1),t._v(" 地址，点击 [钉钉] 或者 [企业微信] 进行三方登录。此时，会调用 "),s("a",{attrs:{href:"https://github.com/YunaiV/ruoyi-vue-pro/blob/master/yudao-module-system/yudao-module-system-biz/src/main/java/cn/iocoder/yudao/module/system/controller/admin/auth/AuthController.java#L97-L106",target:"_blank",rel:"noopener noreferrer"}},[s("code",[t._v("/admin-api/system/auth/social-auth-redirect")]),s("OutboundLink")],1),t._v(" 接口，获得第三方平台的登录地址，并进行跳转。")]),t._v(" "),s("p",[s("img",{attrs:{src:"/img/%E4%B8%89%E6%96%B9%E7%99%BB%E5%BD%95/12.png",alt:"三方登录"}})]),t._v(" "),s("p",[t._v("然后，使用 [钉钉] 或者 [企业微信] 进行扫码，完成三方登录。")]),t._v(" "),s("p",[t._v("② 三方登录成功后，跳转回 "),s("a",{attrs:{href:"http://127.0.0.1:1024/social-login",target:"_blank",rel:"noopener noreferrer"}},[t._v("http://127.0.0.1:1024/social-login"),s("OutboundLink")],1),t._v(" 地址。此时，会调用 "),s("a",{attrs:{href:"https://github.com/YunaiV/ruoyi-vue-pro/blob/master/yudao-module-system/yudao-module-system-biz/src/main/java/cn/iocoder/yudao/module/system/controller/admin/auth/AuthController.java#L149-L154",target:"_blank",rel:"noopener noreferrer"}},[s("code",[t._v("/admin-api/system/auth/social-login")]),s("OutboundLink")],1),t._v(" 接口，尝试「快捷登录」。由于该三方用户【未】关联管理后台的 AdminUser 用户，所以会看到 “未绑定账号，需要进行绑定” 报错。")]),t._v(" "),s("p",[s("img",{attrs:{src:"/img/%E4%B8%89%E6%96%B9%E7%99%BB%E5%BD%95/11.png",alt:"三方登录页"}})]),t._v(" "),s("p",[t._v("③ 输入账号密码，点击 [提交] 按钮，进行「绑定登录」。此时，会调用 "),s("a",{attrs:{href:"https://github.com/YunaiV/ruoyi-vue-pro/blob/master/yudao-module-system/yudao-module-system-biz/src/main/java/cn/iocoder/yudao/module/system/controller/admin/auth/AuthController.java#L61-L66",target:"_blank",rel:"noopener noreferrer"}},[s("code",[t._v("/admin-api/system/auth/login")]),s("OutboundLink")],1),t._v(" 接口（在账号密码登录的基础上，额外带上 "),s("code",[t._v("socialType")]),t._v(" + "),s("code",[t._v("socialCode")]),t._v(" + "),s("code",[t._v("socialState")]),t._v(" 参数）。成功后，即可进入系统的首页。")]),t._v(" "),s("p",[s("img",{attrs:{src:"/img/%E4%B8%89%E6%96%B9%E7%99%BB%E5%BD%95/13.png",alt:"三方登录页"}})]),t._v(" "),s("h2",{attrs:{id:"_3-快捷登录"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_3-快捷登录"}},[t._v("#")]),t._v(" 3. 快捷登录")]),t._v(" "),s("div",{staticClass:"custom-block tip"},[s("p",{staticClass:"custom-block-title"},[t._v("退出系统，再进行一次三方登录的流程。")])]),t._v(" "),s("p",[t._v("【相同】① 使用浏览器访问 "),s("a",{attrs:{href:"http://127.0.0.1:1024/login",target:"_blank",rel:"noopener noreferrer"}},[t._v("http://127.0.0.1:1024/login"),s("OutboundLink")],1),t._v(" 地址，点击 [钉钉] 或者 [企业微信] 进行三方登录。此时，会调用 "),s("a",{attrs:{href:"https://github.com/YunaiV/ruoyi-vue-pro/blob/master/yudao-module-system/yudao-module-system-biz/src/main/java/cn/iocoder/yudao/module/system/controller/admin/auth/AuthController.java#L97-L106",target:"_blank",rel:"noopener noreferrer"}},[s("code",[t._v("/admin-api/system/auth/social-auth-redirect")]),s("OutboundLink")],1),t._v(" 接口，获得第三方平台的登录地址，并进行跳转。")]),t._v(" "),s("p",[s("img",{attrs:{src:"/img/%E4%B8%89%E6%96%B9%E7%99%BB%E5%BD%95/12.png",alt:"三方登录"}})]),t._v(" "),s("p",[t._v("【不同】② 三方登录成功后，跳转回 "),s("a",{attrs:{href:"http://127.0.0.1:1024/social-login",target:"_blank",rel:"noopener noreferrer"}},[t._v("http://127.0.0.1:1024/social-login"),s("OutboundLink")],1),t._v(" 地址。此时，会调用 "),s("a",{attrs:{href:"https://github.com/YunaiV/ruoyi-vue-pro/blob/master/yudao-module-system/yudao-module-system-biz/src/main/java/cn/iocoder/yudao/module/system/controller/admin/auth/AuthController.java#L149-L154",target:"_blank",rel:"noopener noreferrer"}},[s("code",[t._v("/admin-api/system/auth/social-login")]),s("OutboundLink")],1),t._v(" 接口，尝试「快捷登录」。由于该三方用户【已】关联管理后台的 AdminUser 用户，所以直接进入系统的首页。")]),t._v(" "),s("p",[s("img",{attrs:{src:"/img/%E4%B8%89%E6%96%B9%E7%99%BB%E5%BD%95/13.png",alt:"三方登录页"}})]),t._v(" "),s("h2",{attrs:{id:"_4-绑定与解绑"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_4-绑定与解绑"}},[t._v("#")]),t._v(" 4. 绑定与解绑")]),t._v(" "),s("p",[t._v("访问 "),s("a",{attrs:{href:"http://127.0.0.1:1024/user/profile",target:"_blank",rel:"noopener noreferrer"}},[t._v("http://127.0.0.1:1024/user/profile"),s("OutboundLink")],1),t._v(" 地址，选择 [社交信息] 选项，可以三方用户的绑定与解绑。")]),t._v(" "),s("p",[s("img",{attrs:{src:"/img/%E4%B8%89%E6%96%B9%E7%99%BB%E5%BD%95/21.png",alt:"绑定与解绑"}})]),t._v(" "),s("h2",{attrs:{id:"_5-配置管理"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_5-配置管理"}},[t._v("#")]),t._v(" 5. 配置管理")]),t._v(" "),s("h3",{attrs:{id:"_5-1-配置文件"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_5-1-配置文件"}},[t._v("#")]),t._v(" 5.1 配置文件")]),t._v(" "),s("p",[t._v("在 "),s("a",{attrs:{href:"https://github.com/YunaiV/ruoyi-vue-pro/blob/master/yudao-server/src/main/resources/application-local.yaml#L196-L211",target:"_blank",rel:"noopener noreferrer"}},[s("code",[t._v("application-{env}.yaml")]),s("OutboundLink")],1),t._v(" 配置文件中，对应 "),s("code",[t._v("justauth")]),t._v(" 配置项，填写你的第三方平台的配置信息。")]),t._v(" "),s("p",[s("img",{attrs:{src:"/img/%E4%B8%89%E6%96%B9%E7%99%BB%E5%BD%95/31.png",alt:"配置文件"}})]),t._v(" "),s("p",[t._v("系统使用 "),s("a",{attrs:{href:"https://gitee.com/yudaocode/justauth",target:"_blank",rel:"noopener noreferrer"}},[t._v("JustAuth"),s("OutboundLink")],1),t._v(" 组件，想要对接其它第三方平台，只需要新增对应的配置信息即可。")]),t._v(" "),s("h3",{attrs:{id:"_5-2-数据库配置"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_5-2-数据库配置"}},[t._v("#")]),t._v(" 5.2 数据库配置")]),t._v(" "),s("p",[t._v("① "),s("code",[t._v("system_social_client")]),t._v(" 表，它本质上是 JustAuth 配置的 DB 存储。")]),t._v(" "),s("p",[t._v("主要实现两个目的：")]),t._v(" "),s("div",{staticClass:"language-SQL extra-class"},[s("pre",{pre:!0,attrs:{class:"language-sql"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("CREATE")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("TABLE")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token identifier"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("`")]),t._v("system_social_client"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("`")])]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token identifier"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("`")]),t._v("id"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("`")])]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("bigint")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("NOT")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("NULL")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("AUTO_INCREMENT")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("COMMENT")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'编号'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token identifier"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("`")]),t._v("name"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("`")])]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("varchar")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("255")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("CHARACTER")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("SET")]),t._v(" utf8mb4 "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("COLLATE")]),t._v(" utf8mb4_unicode_ci "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("NOT")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("NULL")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("COMMENT")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'应用名'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token identifier"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("`")]),t._v("status"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("`")])]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("tinyint")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("NOT")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("NULL")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("COMMENT")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'状态'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// JustAuth 配置项")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token identifier"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("`")]),t._v("social_type"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("`")])]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("tinyint")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("NOT")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("NULL")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("COMMENT")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'社交平台的类型'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token identifier"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("`")]),t._v("client_id"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("`")])]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("varchar")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("255")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("CHARACTER")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("SET")]),t._v(" utf8mb4 "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("COLLATE")]),t._v(" utf8mb4_unicode_ci "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("NOT")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("NULL")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("COMMENT")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'客户端编号'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token identifier"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("`")]),t._v("client_secret"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("`")])]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("varchar")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("255")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("CHARACTER")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("SET")]),t._v(" utf8mb4 "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("COLLATE")]),t._v(" utf8mb4_unicode_ci "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("NOT")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("NULL")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("COMMENT")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'客户端密钥'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token identifier"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("`")]),t._v("agent_id"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("`")])]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("varchar")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("255")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("COLLATE")]),t._v(" utf8mb4_unicode_ci "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("DEFAULT")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("NULL")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("COMMENT")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'代理编号'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 目的 1")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token identifier"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("`")]),t._v("tenant_id"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("`")])]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("bigint")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("NOT")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("NULL")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("DEFAULT")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'0'")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("COMMENT")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'租户编号'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 目的 2")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token identifier"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("`")]),t._v("user_type"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("`")])]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("tinyint")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("NOT")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("NULL")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("COMMENT")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'用户类型'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// ... 省略其它非关键字段")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("PRIMARY")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("KEY")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token identifier"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("`")]),t._v("id"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("`")])]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("USING")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("BTREE")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("ENGINE")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("InnoDB")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("AUTO_INCREMENT")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("44")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("DEFAULT")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("CHARSET")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("utf8mb4 "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("COLLATE")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("utf8mb4_unicode_ci "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("COMMENT")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'社交客户端表'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),s("ol",[s("li",[t._v("在需要 SaaS 多租户的项目中，通过 "),s("code",[t._v("tenant_id")]),t._v(" 字段隔离，实现不同租户对应不同第三方平台的配置")]),t._v(" "),s("li",[t._v("在多用户类型的项目中，通过 "),s("code",[t._v("user_type")]),t._v(" 字段区分，实现不同用户类型对应不同第三方平台的配置")])]),t._v(" "),s("p",[t._v("注意，"),s("code",[t._v("system_social_client")]),t._v(" 表的优先级，比 "),s("code",[t._v("application-{env}.yaml")]),t._v(" 配置文件高！具体逻辑，可见 SocialClientServiceImpl 类的 "),s("code",[t._v("#buildAuthRequest(...)")]),t._v(" 方法。")]),t._v(" "),s("div",{staticClass:"custom-block tip"},[s("p",{staticClass:"custom-block-title"},[t._v("疑问：系统目前支持指定租户 + 用户类型 + 社交平台，对应多套配置吗？")]),t._v(" "),s("p",[t._v("不支持，需要自己改造。总体思路是：")]),t._v(" "),s("ol",[s("li",[s("code",[t._v("system_social_client")]),t._v(" 额外再增加一个 "),s("code",[t._v("application")]),t._v(" 应用字段，存储应用名，进行一步隔离")]),t._v(" "),s("li",[t._v("前端调用三方登录时，额外传递 "),s("code",[t._v("application")]),t._v(" 应用字段，用于查询对应应用的配置")])])]),t._v(" "),s("p",[t._v("② 在 [系统管理 -> 三方登录 -> 三方应用] 菜单下，可以进行"),s("strong",[t._v("当前租户")]),t._v("的 "),s("code",[t._v("system_social_client")]),t._v(" 表的配置管理。如下图所示：")]),t._v(" "),s("p",[s("img",{attrs:{src:"/img/%E4%B8%89%E6%96%B9%E7%99%BB%E5%BD%95/%E8%8F%9C%E5%8D%95-%E4%B8%89%E6%96%B9%E5%BA%94%E7%94%A8.png",alt:"三方应用"}})]),t._v(" "),s("p",[t._v("另外，在 [系统管理 -> 三方登录 -> 三方用户] 菜单下，可以进行"),s("strong",[t._v("当前租户")]),t._v("的 "),s("code",[t._v("system_social_user")]),t._v(" 三方用户表的查询。如下图所示：")]),t._v(" "),s("p",[s("img",{attrs:{src:"/img/%E4%B8%89%E6%96%B9%E7%99%BB%E5%BD%95/%E8%8F%9C%E5%8D%95-%E4%B8%89%E6%96%B9%E7%94%A8%E6%88%B7.png",alt:"三方应用"}})]),t._v(" "),s("h2",{attrs:{id:"_6-第三方平台的申请"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_6-第三方平台的申请"}},[t._v("#")]),t._v(" 6. 第三方平台的申请")]),t._v(" "),s("ul",[s("li",[s("a",{attrs:{href:"https://justauth.cn/guide/oauth/dingtalk/",target:"_blank",rel:"noopener noreferrer"}},[t._v("阿里钉钉"),s("OutboundLink")],1)]),t._v(" "),s("li",[s("a",{attrs:{href:"https://justauth.cn/guide/oauth/wechat_enterprise_qrcode/",target:"_blank",rel:"noopener noreferrer"}},[t._v("企业微信扫码登录"),s("OutboundLink")],1)]),t._v(" "),s("li",[s("a",{attrs:{href:"https://justauth.cn/guide/oauth/wechat_open/",target:"_blank",rel:"noopener noreferrer"}},[t._v("微信开放平台"),s("OutboundLink")],1)])]),t._v(" "),s("p",[t._v("注意，如果第三方平台如果需要配置具体的授信地址，需要添加 "),s("code",[t._v("/social-login")]),t._v(" 用于三方登录回调页、"),s("code",[t._v("/user/profile")]),t._v(" 用于三方用户的绑定与解绑。")])])}),[],!1,null,null,null);s.default=r.exports}}]);