(window.webpackJsonp=window.webpackJsonp||[]).push([[135],{464:function(t,s,a){"use strict";a.r(s);var e=a(7),n=Object(e.a)({},(function(){var t=this,s=t._self._c;return s("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[s("p",[t._v("CRM 回款，主要指的是在销售过程中，企业与客户签订销售【合同】后，从客户那里实际收到的款项的记录。")]),t._v(" "),s("p",[t._v("回款模块，由 "),s("code",[t._v("yudao-module-crm-biz")]),t._v(" 后端模块的 "),s("code",[t._v("receivable")]),t._v(" 包实现，已经和 "),s("RouterLink",{attrs:{to:"/bpm/"}},[t._v("BPM 工作流")]),t._v(" 打通审批。")],1),t._v(" "),s("p",[t._v("目前有两种回款链路，因此表关系如下图所示：")]),t._v(" "),s("ul",[s("li",[t._v("【合同】=>【回款】")]),t._v(" "),s("li",[t._v("【合同】=>【回款计划】=>【回款】")])]),t._v(" "),s("p",[s("img",{attrs:{src:"/img/CRM%E6%89%8B%E5%86%8C/%E5%9B%9E%E6%AC%BE/%E8%A1%A8%E5%85%B3%E7%B3%BB.png",alt:"表关系"}})]),t._v(" "),s("h2",{attrs:{id:"_1-回款"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_1-回款"}},[t._v("#")]),t._v(" 1. 回款")]),t._v(" "),s("p",[t._v("回款，由 "),s("code",[t._v("yudao-module-crm-biz")]),t._v(" 后端模块的 "),s("code",[t._v("receivable")]),t._v(" 包的 CrmReceivableController 实现。")]),t._v(" "),s("h3",{attrs:{id:"_1-表结构"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_1-表结构"}},[t._v("#")]),t._v(" 1. 表结构")]),t._v(" "),s("blockquote",[s("p",[t._v("【回款表】省略 creator/create_time/updater/update_time/deleted/tenant_id 等通用字段")])]),t._v(" "),s("div",{staticClass:"language-SQL extra-class"},[s("pre",{pre:!0,attrs:{class:"language-sql"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("CREATE")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("TABLE")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token identifier"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("`")]),t._v("crm_receivable"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("`")])]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token identifier"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("`")]),t._v("id"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("`")])]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("bigint")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("NOT")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("NULL")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("AUTO_INCREMENT")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("COMMENT")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'ID'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token identifier"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("`")]),t._v("no"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("`")])]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("varchar")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("100")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("CHARACTER")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("SET")]),t._v(" utf8mb4 "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("COLLATE")]),t._v(" utf8mb4_unicode_ci "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("NOT")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("NULL")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("COMMENT")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'回款编号'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  \n  "),s("span",{pre:!0,attrs:{class:"token identifier"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("`")]),t._v("customer_id"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("`")])]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("bigint")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("NOT")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("NULL")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("COMMENT")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'客户ID'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token identifier"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("`")]),t._v("contract_id"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("`")])]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("bigint")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("NOT")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("NULL")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("COMMENT")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'合同ID'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  \n  "),s("span",{pre:!0,attrs:{class:"token identifier"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("`")]),t._v("plan_id"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("`")])]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("bigint")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("DEFAULT")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("NULL")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("COMMENT")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'回款计划ID'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  \n  "),s("span",{pre:!0,attrs:{class:"token identifier"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("`")]),t._v("owner_user_id"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("`")])]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("bigint")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("DEFAULT")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("NULL")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("COMMENT")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'负责人的用户编号'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  \n  "),s("span",{pre:!0,attrs:{class:"token identifier"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("`")]),t._v("audit_status"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("`")])]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("tinyint")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("NOT")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("NULL")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("COMMENT")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'审批状态'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token identifier"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("`")]),t._v("process_instance_id"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("`")])]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("varchar")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("64")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("COLLATE")]),t._v(" utf8mb4_unicode_ci "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("DEFAULT")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("NULL")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("COMMENT")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'工作流编号'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n\n  "),s("span",{pre:!0,attrs:{class:"token identifier"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("`")]),t._v("price"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("`")])]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("decimal")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("24")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("6")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("NOT")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("NULL")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("COMMENT")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'回款金额'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  \n  "),s("span",{pre:!0,attrs:{class:"token identifier"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("`")]),t._v("return_time"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("`")])]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("datetime")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("DEFAULT")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("NULL")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("COMMENT")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'回款日期'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token identifier"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("`")]),t._v("return_type"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("`")])]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("int")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("DEFAULT")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("NULL")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("COMMENT")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'回款方式'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token identifier"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("`")]),t._v("remark"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("`")])]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("varchar")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("500")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("CHARACTER")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("SET")]),t._v(" utf8mb4 "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("COLLATE")]),t._v(" utf8mb4_unicode_ci "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("DEFAULT")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("NULL")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("COMMENT")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'备注'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("PRIMARY")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("KEY")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token identifier"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("`")]),t._v("id"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("`")])]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("USING")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("BTREE")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("ENGINE")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("InnoDB")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("AUTO_INCREMENT")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("29")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("DEFAULT")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("CHARSET")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("utf8mb4 "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("COLLATE")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("utf8mb4_unicode_ci "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("COMMENT")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'CRM 回款管理'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),s("p",[t._v("① "),s("code",[t._v("no")]),t._v(" 字段：回款编号，系统自动生成的，目前格式是 "),s("code",[t._v("{prefix}{yyyyMMdd}{6 位自增}")]),t._v("。具体可见 ErpNoRedisDAO 类。")]),t._v(" "),s("p",[t._v("② "),s("code",[t._v("customer_id")]),t._v(" 和 "),s("code",[t._v("contract_id")]),t._v(" 字段：客户编号和合同编号，对应 "),s("code",[t._v("crm_customer")]),t._v(" 表和 "),s("code",[t._v("crm_contract")]),t._v(" 表的 "),s("code",[t._v("id")]),t._v(" 字段，必填。")]),t._v(" "),s("p",[t._v("③ "),s("code",[t._v("plan_id")]),t._v(" 字段：回款计划编号，对应 "),s("code",[t._v("crm_receivable_plan")]),t._v(" 表的 "),s("code",[t._v("id")]),t._v(" 字段，选填。只有在【合同】=>【回款计划】=>【回款】的情况下，才会有值。")]),t._v(" "),s("p",[t._v("④ "),s("code",[t._v("owner_user_id")]),t._v(" 字段：回款的负责人编号，和线索类似。不重复赘述，详细可见 "),s("RouterLink",{attrs:{to:"/crm/permission/"}},[t._v("《【通用】数据权限》")]),t._v(" 文档。")],1),t._v(" "),s("p",[t._v("⑤ "),s("code",[t._v("process_instance_id")]),t._v(" 字段：工作流编号，用于和 "),s("RouterLink",{attrs:{to:"/bpm/"}},[t._v("BPM 工作流")]),t._v(" 打通审批。提交审批后，会自动创建一个工作流实例，并记录到该字段。")],1),t._v(" "),s("p",[s("code",[t._v("audit_status")]),t._v(" 字段：审批结果，目前由 CrmAuditStatusEnum 枚举，目前有 5 个状态：未提交、审批中、审批通过、审批不通过、已取消。")]),t._v(" "),s("p",[t._v("⑥ "),s("code",[t._v("price")]),t._v(" 字段：回款金额。一个合同可能有多次回款，它总的回款金额不能超过合同金额。")]),t._v(" "),s("p",[t._v("⑦ "),s("code",[t._v("return_time")]),t._v("、"),s("code",[t._v("return_type")]),t._v("、"),s("code",[t._v("remark")]),t._v(" 字段：回款日期、回款方式、备注。就是信息字段，没什么特殊逻辑。")]),t._v(" "),s("h3",{attrs:{id:"_2-2-管理后台"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_2-2-管理后台"}},[t._v("#")]),t._v(" 2.2 管理后台")]),t._v(" "),s("p",[t._v("对应 [CRM 系统 -> 回款管理] 菜单，对应 "),s("code",[t._v("yudao-ui-admin-vue3")]),t._v(" 项目的 "),s("code",[t._v("@/views/crm/receivable")]),t._v(" 目录。")]),t._v(" "),s("p",[s("img",{attrs:{src:"/img/CRM%E6%89%8B%E5%86%8C/%E5%9B%9E%E6%AC%BE/%E5%9B%9E%E6%AC%BE%E7%AE%A1%E7%90%86.png",alt:"回款管理"}})]),t._v(" "),s("p",[t._v("① 参考 "),s("a",{attrs:{href:"/crm/contract"}},[t._v("《【合同】合同管理、合同提醒》")]),t._v(" 文档，创建一个合同。注意，必须审核通过，才能进行回款。")]),t._v(" "),s("p",[t._v("② 点击【新增】按钮，随便填写一些信息，点击「确认」按钮，即可新增一条回款。如下图所示：")]),t._v(" "),s("p",[s("img",{attrs:{src:"/img/CRM%E6%89%8B%E5%86%8C/%E5%9B%9E%E6%AC%BE/%E5%9B%9E%E6%AC%BE%E6%96%B0%E5%A2%9E.png",alt:"新增回款"}})]),t._v(" "),s("p",[t._v("这样，我们就完成了【合同】=>【回款】的整个回款链路。")]),t._v(" "),s("p",[t._v("② 点击【提交审批】按钮，可以提交审批。如下图所示：")]),t._v(" "),s("p",[s("img",{attrs:{src:"/img/CRM%E6%89%8B%E5%86%8C/%E5%9B%9E%E6%AC%BE/%E5%9B%9E%E6%AC%BE%E6%8F%90%E4%BA%A4%E5%AE%A1%E6%89%B9.png",alt:"提交审批"}})]),t._v(" "),s("div",{staticClass:"custom-block tip"},[s("p",{staticClass:"custom-block-title"},[t._v("友情提示：")]),t._v(" "),s("p",[t._v("回款对应的审批流程，需要自己在 [工作流程 -> 流程管理 -> 流程模型] 菜单，配置一个流程标识为 "),s("code",[t._v("crm-receivable-audit")]),t._v(" 的流程模型。如下图所示：")]),t._v(" "),s("p",[s("img",{attrs:{src:"/img/CRM%E6%89%8B%E5%86%8C/%E5%9B%9E%E6%AC%BE/%E6%B5%81%E7%A8%8B%E6%A8%A1%E5%9E%8B.png",alt:"流程模型"}})]),t._v(" "),s("p",[t._v("如果不了解怎么配置的同学，可以学习下 "),s("RouterLink",{attrs:{to:"/bpm/"}},[t._v("《BPM 工作流》")]),t._v(" 的文档。")],1)]),t._v(" "),s("p",[t._v("提交完成后，会自动创建一个工作流实例，并记录到 "),s("code",[t._v("process_instance_id")]),t._v(" 字段。之后可点击【查看审批】按钮，查看审批详情。如下图所示：")]),t._v(" "),s("p",[s("img",{attrs:{src:"/img/CRM%E6%89%8B%E5%86%8C/%E5%9B%9E%E6%AC%BE/%E5%9B%9E%E6%AC%BE%E5%AE%A1%E6%89%B9%E8%AF%A6%E6%83%85.png",alt:"查看审批"}})]),t._v(" "),s("p",[t._v("点击审批【通过】按钮，将回款审批通过，此时它会回调 CrmReceivableResultListener 监听器，更新回款的 "),s("code",[t._v("audit_status")]),t._v(" 字段为审批通过。如下图所示：")]),t._v(" "),s("p",[s("img",{attrs:{src:"/img/CRM%E6%89%8B%E5%86%8C/%E5%9B%9E%E6%AC%BE/%E5%9B%9E%E6%AC%BE%E5%AE%A1%E6%89%B9%E9%80%9A%E8%BF%87.png",alt:"审批通过"}})]),t._v(" "),s("p",[t._v("③ 点击“回款编号”，进入回款详情页，可以查看回款的详细信息，如下图所示：")]),t._v(" "),s("p",[s("img",{attrs:{src:"/img/CRM%E6%89%8B%E5%86%8C/%E5%9B%9E%E6%AC%BE/%E5%9B%9E%E6%AC%BE%E8%AF%A6%E6%83%85.png",alt:"回款详情"}})]),t._v(" "),s("hr"),t._v(" "),s("p",[t._v("另外，也可以在【合同】的详情页，进行【回款】的创建。如下图所示：")]),t._v(" "),s("p",[s("img",{attrs:{src:"/img/CRM%E6%89%8B%E5%86%8C/%E5%9B%9E%E6%AC%BE/%E5%9B%9E%E6%AC%BE%E6%96%B0%E5%A2%9E-%E5%90%88%E5%90%8C.png",alt:"新增回款（合同）"}})]),t._v(" "),s("h2",{attrs:{id:"_2-回款计划"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_2-回款计划"}},[t._v("#")]),t._v(" 2. 回款计划")]),t._v(" "),s("p",[t._v("回款计划，由 "),s("code",[t._v("yudao-module-crm-biz")]),t._v(" 后端模块的 "),s("code",[t._v("receivable")]),t._v(" 包的 CrmReceivablePlanController 实现。")]),t._v(" "),s("h3",{attrs:{id:"_2-1-表结构"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_2-1-表结构"}},[t._v("#")]),t._v(" 2.1 表结构")]),t._v(" "),s("blockquote",[s("p",[t._v("【回款计划表】省略 creator/create_time/updater/update_time/deleted/tenant_id 等通用字段")])]),t._v(" "),s("div",{staticClass:"language-SQL extra-class"},[s("pre",{pre:!0,attrs:{class:"language-sql"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("CREATE")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("TABLE")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token identifier"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("`")]),t._v("crm_receivable_plan"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("`")])]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token identifier"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("`")]),t._v("id"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("`")])]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("bigint")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("NOT")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("NULL")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("AUTO_INCREMENT")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("COMMENT")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'ID'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  \n  "),s("span",{pre:!0,attrs:{class:"token identifier"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("`")]),t._v("period"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("`")])]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("bigint")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("NOT")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("NULL")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("COMMENT")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'期数'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  \n  "),s("span",{pre:!0,attrs:{class:"token identifier"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("`")]),t._v("customer_id"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("`")])]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("bigint")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("NOT")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("NULL")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("COMMENT")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'客户编号'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token identifier"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("`")]),t._v("contract_id"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("`")])]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("bigint")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("NOT")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("NULL")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("COMMENT")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'合同编号'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  \n  "),s("span",{pre:!0,attrs:{class:"token identifier"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("`")]),t._v("owner_user_id"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("`")])]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("bigint")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("DEFAULT")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("NULL")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("COMMENT")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'负责人编号'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  \n  "),s("span",{pre:!0,attrs:{class:"token identifier"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("`")]),t._v("receivable_id"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("`")])]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("bigint")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("DEFAULT")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("NULL")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("COMMENT")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'回款编号'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  \n  "),s("span",{pre:!0,attrs:{class:"token identifier"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("`")]),t._v("return_time"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("`")])]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("datetime")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("DEFAULT")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("NULL")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("COMMENT")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'计划回款日期'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token identifier"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("`")]),t._v("return_type"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("`")])]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("tinyint")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("DEFAULT")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("NULL")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("COMMENT")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'计划还款方式'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token identifier"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("`")]),t._v("price"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("`")])]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("decimal")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("24")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("6")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("NOT")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("NULL")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("COMMENT")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'计划回款金额'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token identifier"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("`")]),t._v("remind_days"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("`")])]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("bigint")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("DEFAULT")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("NULL")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("COMMENT")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'提前几天提醒'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token identifier"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("`")]),t._v("remind_time"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("`")])]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("datetime")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("DEFAULT")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("NULL")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("COMMENT")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'提醒日期'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token identifier"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("`")]),t._v("remark"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("`")])]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("varchar")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("500")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("CHARACTER")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("SET")]),t._v(" utf8mb4 "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("COLLATE")]),t._v(" utf8mb4_unicode_ci "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("DEFAULT")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("NULL")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("COMMENT")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'备注'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("PRIMARY")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("KEY")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token identifier"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("`")]),t._v("id"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("`")])]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("USING")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("BTREE")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("ENGINE")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("InnoDB")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("AUTO_INCREMENT")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("7")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("DEFAULT")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("CHARSET")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("utf8mb4 "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("COLLATE")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("utf8mb4_unicode_ci "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("COMMENT")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'CRM 回款计划'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),s("p",[t._v("由于 "),s("code",[t._v("crm_receivable_plan")]),t._v(" 是 "),s("code",[t._v("crm_receivable")]),t._v(" 的计划（草稿），所以结构上非常相似。")]),t._v(" "),s("p",[t._v("① "),s("code",[t._v("period")]),t._v(" 字段：期数，比如第一期、第二期、第三期等。目前是基于 "),s("code",[t._v("contract_id")]),t._v(" 在 "),s("code",[t._v("crm_receivable_plan")]),t._v(" 表中的最大期数加 1。")]),t._v(" "),s("p",[t._v("② "),s("code",[t._v("customer_id")]),t._v(" 和 "),s("code",[t._v("contract_id")]),t._v(" 字段：客户编号和合同编号，对应 "),s("code",[t._v("crm_customer")]),t._v(" 表和 "),s("code",[t._v("crm_contract")]),t._v(" 表的 "),s("code",[t._v("id")]),t._v(" 字段，必填。")]),t._v(" "),s("p",[t._v("③ "),s("code",[t._v("owner_user_id")]),t._v(" 字段：回款计划的负责人编号，和线索类似。不重复赘述，详细可见 "),s("RouterLink",{attrs:{to:"/crm/permission/"}},[t._v("《【通用】数据权限》")]),t._v(" 文档。")],1),t._v(" "),s("p",[t._v("④ "),s("code",[t._v("receivable_id")]),t._v(" 字段：回款编号，对应 "),s("code",[t._v("crm_receivable")]),t._v(" 表的 "),s("code",[t._v("id")]),t._v(" 字段，选填。")]),t._v(" "),s("p",[t._v("只有在【合同】=>【回款计划】=>【回款】的情况下，才会有值。即基于【回款计划】创建【回款】时，会将【回款】的 "),s("code",[t._v("id")]),t._v(" 字段记录到这里。")]),t._v(" "),s("p",[t._v("⑤ "),s("code",[t._v("return_time")]),t._v("、"),s("code",[t._v("return_type")]),t._v("、"),s("code",[t._v("price")]),t._v("、"),s("code",[t._v("remind_days")]),t._v("、"),s("code",[t._v("remind_time")]),t._v("、"),s("code",[t._v("remark")]),t._v(" 字段：回款日期、回款方式、回款金额、提醒天数、提醒日期、备注。就是信息字段，没什么特殊逻辑。")]),t._v(" "),s("p",[t._v("不过 "),s("code",[t._v("remind_time")]),t._v(" 字段，有点特殊，它是 "),s("code",[t._v("return_time")]),t._v(" 字段减去 "),s("code",[t._v("remind_days")]),t._v(" 字段的日期，后续用于提醒，如下图所示：")]),t._v(" "),s("p",[s("img",{attrs:{src:"/img/CRM%E6%89%8B%E5%86%8C/%E5%9B%9E%E6%AC%BE/%E5%BE%85%E5%9B%9E%E6%AC%BE%E6%8F%90%E9%86%92.png",alt:"待回款提醒"}})]),t._v(" "),s("h3",{attrs:{id:"_2-2-管理后台-2"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_2-2-管理后台-2"}},[t._v("#")]),t._v(" 2.2 管理后台")]),t._v(" "),s("p",[t._v("对应 [CRM 系统 -> 回款计划] 菜单，对应 "),s("code",[t._v("yudao-ui-admin-vue3")]),t._v(" 项目的 "),s("code",[t._v("@/views/crm/receivable/plan")]),t._v(" 目录。")]),t._v(" "),s("p",[s("img",{attrs:{src:"/img/CRM%E6%89%8B%E5%86%8C/%E5%9B%9E%E6%AC%BE/%E5%9B%9E%E6%AC%BE%E8%AE%A1%E5%88%92.png",alt:"回款计划"}})]),t._v(" "),s("p",[t._v("① 点击【新增】按钮，随便填写一些信息，点击「确认」按钮，即可新增一条回款计划。如下图所示：")]),t._v(" "),s("p",[s("img",{attrs:{src:"/img/CRM%E6%89%8B%E5%86%8C/%E5%9B%9E%E6%AC%BE/%E5%9B%9E%E6%AC%BE%E8%AE%A1%E5%88%92%E6%96%B0%E5%A2%9E.png",alt:"新增回款计划"}})]),t._v(" "),s("p",[t._v("② 点击【创建回款】按钮，可以创建回款。如下图所示：")]),t._v(" "),s("p",[s("img",{attrs:{src:"/img/CRM%E6%89%8B%E5%86%8C/%E5%9B%9E%E6%AC%BE/%E5%9B%9E%E6%AC%BE%E6%96%B0%E5%A2%9E-%E5%9B%9E%E6%AC%BE%E8%AE%A1%E5%88%92.png",alt:"创建回款（回款计划）"}})]),t._v(" "),s("p",[t._v("这样，我们就完成了【合同】=>【回款计划】=>【回款】的整个回款链路。")]),t._v(" "),s("p",[t._v("③ 点击“期数”，进入回款计划详情页，可以查看回款计划的详细信息，如下图所示：")]),t._v(" "),s("p",[s("img",{attrs:{src:"/img/CRM%E6%89%8B%E5%86%8C/%E5%9B%9E%E6%AC%BE/%E5%9B%9E%E6%AC%BE%E8%AE%A1%E5%88%92%E8%AF%A6%E6%83%85.png",alt:"回款计划详情"}})]),t._v(" "),s("hr"),t._v(" "),s("p",[t._v("另外，也可以在【合同】的详情页，进行【回款计划】的创建。如下图所示：")]),t._v(" "),s("p",[s("img",{attrs:{src:"/img/CRM%E6%89%8B%E5%86%8C/%E5%9B%9E%E6%AC%BE/%E5%9B%9E%E6%AC%BE%E8%AE%A1%E5%88%92%E6%96%B0%E5%A2%9E-%E5%90%88%E5%90%8C.png",alt:"新增回款计划（合同）"}})])])}),[],!1,null,null,null);s.default=n.exports}}]);