(window.webpackJsonp=window.webpackJsonp||[]).push([[79],{408:function(s,t,a){"use strict";a.r(t);var e=a(7),r=Object(e.a)({},(function(){var s=this,t=s._self._c;return t("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[t("h2",{attrs:{id:"_1-流程表达式"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_1-流程表达式"}},[s._v("#")]),s._v(" 1. 流程表达式")]),s._v(" "),t("p",[s._v("Flowable 使用 UEL 进行表达式解析。UEL 代表 "),t("a",{attrs:{href:"https://docs.oracle.com/javaee/6/tutorial/doc/gjddd.html",target:"_blank",rel:"noopener noreferrer"}},[s._v("Unified Expression Language"),t("OutboundLink")],1),s._v("，是 EE6 规范的一部分。例如说：")]),s._v(" "),t("ul",[t("li",[s._v("在 "),t("RouterLink",{attrs:{to:"/bpm/multi-instance/"}},[s._v("《会签、或签、依次审批》")]),s._v(" 看到的 "),t("code",[s._v("${ nrOfCompletedInstances >= nrOfInstances }")]),s._v("、"),t("code",[s._v("${ nrOfCompletedInstances == 1 }")]),s._v(" 等，就是 UEL 表达式")],1),s._v(" "),t("li",[s._v("在 "),t("RouterLink",{attrs:{to:"/bpm/use-business-form/"}},[s._v("《审批接入（流程表单）》")]),s._v(" 看到的流转条件 "),t("code",[s._v("${day > 3}")]),s._v("，也是 UEL 表达式")],1)]),s._v(" "),t("div",{staticClass:"custom-block tip"},[t("p",{staticClass:"custom-block-title"},[s._v("学习文档：")]),s._v(" "),t("ul",[t("li",[t("a",{attrs:{href:"https://tkjohn.github.io/flowable-userguide/#apiExpressions",target:"_blank",rel:"noopener noreferrer"}},[s._v("《Flowable BPMN 用户手册 (v 6.3.0) —— 表达式》"),t("OutboundLink")],1)])])]),s._v(" "),t("p",[s._v("那么，具体怎么定义 UEL 表达式呢？我们逐个来看看。")]),s._v(" "),t("h3",{attrs:{id:"_1-1-bpmtaskassignstartuserexpression"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_1-1-bpmtaskassignstartuserexpression"}},[s._v("#")]),s._v(" 1.1 BpmTaskAssignStartUserExpression")]),s._v(" "),t("p",[t("a",{attrs:{href:"https://github.com/YunaiV/ruoyi-vue-pro/blob/master/yudao-module-bpm/yudao-module-bpm-biz/src/main/java/cn/iocoder/yudao/module/bpm/framework/flowable/core/candidate/expression/BpmTaskAssignStartUserExpression.java",target:"_blank",rel:"noopener noreferrer"}},[s._v("BpmTaskAssignStartUserExpression"),t("OutboundLink")],1),s._v("，分配给发起人审批的 Expression 流程表达式，需要声明成 Spring Bean，代码如下：")]),s._v(" "),t("p",[t("img",{attrs:{src:"/img/%E5%B7%A5%E4%BD%9C%E6%B5%81%E6%89%8B%E5%86%8C/%E6%B5%81%E7%A8%8B%E8%A1%A8%E8%BE%BE%E5%BC%8F/BpmTaskAssignStartUserExpression.png",alt:"BpmTaskAssignStartUserExpression"}})]),s._v(" "),t("p",[s._v("使用时，可以在 BPMN 流程图中，配置表达式 "),t("code",[s._v("${bpmTaskAssignStartUserExpression.calculateUsers(execution)}")]),s._v(" ，如下图所示：")]),s._v(" "),t("p",[t("img",{attrs:{src:"/img/%E5%B7%A5%E4%BD%9C%E6%B5%81%E6%89%8B%E5%86%8C/%E6%B5%81%E7%A8%8B%E8%A1%A8%E8%BE%BE%E5%BC%8F/BpmTaskAssignStartUserExpressionConfig.png",alt:"BpmTaskAssignStartUserExpressionConfig"}})]),s._v(" "),t("p",[s._v("这样，该任务节点的审批人，就会被分配给发起人。")]),s._v(" "),t("h3",{attrs:{id:"_1-2-bpmtaskassignleaderexpression"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_1-2-bpmtaskassignleaderexpression"}},[s._v("#")]),s._v(" 1.2 BpmTaskAssignLeaderExpression")]),s._v(" "),t("p",[t("a",{attrs:{href:"https://github.com/YunaiV/ruoyi-vue-pro/blob/master/yudao-module-bpm/yudao-module-bpm-biz/src/main/java/cn/iocoder/yudao/module/bpm/framework/flowable/core/candidate/expression/BpmTaskAssignLeaderExpression.java",target:"_blank",rel:"noopener noreferrer"}},[s._v("BpmTaskAssignLeaderExpression"),t("OutboundLink")],1),s._v("，分配给发起人的指定 "),t("code",[s._v("level")]),s._v(" 级别 Leader 审批的 Expression 流程表达式，需要声明成 Spring Bean，代码如下：")]),s._v(" "),t("p",[t("img",{attrs:{src:"/img/%E5%B7%A5%E4%BD%9C%E6%B5%81%E6%89%8B%E5%86%8C/%E6%B5%81%E7%A8%8B%E8%A1%A8%E8%BE%BE%E5%BC%8F/BpmTaskAssignLeaderExpression.png",alt:"BpmTaskAssignLeaderExpression"}})]),s._v(" "),t("p",[s._v("使用时，可以在 BPMN 流程图中，配置表达式 "),t("code",[s._v("${bpmTaskAssignLeaderExpression.calculateUsers(execution, 1)}")]),s._v(" 表示一级领导，如下图所示：")]),s._v(" "),t("p",[t("img",{attrs:{src:"/img/%E5%B7%A5%E4%BD%9C%E6%B5%81%E6%89%8B%E5%86%8C/%E6%B5%81%E7%A8%8B%E8%A1%A8%E8%BE%BE%E5%BC%8F/BpmTaskAssignLeaderExpressionConfig.png",alt:"BpmTaskAssignLeaderExpressionConfig"}})]),s._v(" "),t("p",[s._v("这样，该任务节点的审批人，就会被分配给发起人的一级领导。")]),s._v(" "),t("p",[s._v("如果想要分配给二级领导，可以使用 "),t("code",[s._v("${bpmTaskAssignLeaderExpression.calculateUsers(execution, 2)}")]),s._v("。也就是说，"),t("code",[s._v("level")]),s._v(" 参数，表示领导的级别。")]),s._v(" "),t("h2",{attrs:{id:"_2-流程表达式的模版"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_2-流程表达式的模版"}},[s._v("#")]),s._v(" 2. 流程表达式的模版")]),s._v(" "),t("p",[s._v("在 [工作流程 -> 流程管理 -> 流程表达式] 菜单，可以配置执行表达式的模版。如下图所示：")]),s._v(" "),t("p",[t("img",{attrs:{src:"/img/%E5%B7%A5%E4%BD%9C%E6%B5%81%E6%89%8B%E5%86%8C/%E6%B5%81%E7%A8%8B%E8%A1%A8%E8%BE%BE%E5%BC%8F/%E6%B5%81%E7%A8%8B%E8%A1%A8%E8%BE%BE%E5%BC%8F.png",alt:"流程表达式"}})]),s._v(" "),t("ul",[t("li",[s._v("前端，对应 "),t("code",[s._v("views/bpm/processExpression/index.vue")]),s._v(" 提供界面")]),s._v(" "),t("li",[s._v("后端，对应 "),t("code",[s._v("BpmProcessExpressionController")]),s._v(" 提供接口")])]),s._v(" "),t("h3",{attrs:{id:"_2-1-使用场景"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_2-1-使用场景"}},[s._v("#")]),s._v(" 2.1 使用场景")]),s._v(" "),t("p",[s._v("当我们在 BPMN 流程图中，配置表达式时，可以选择模版，而不需要每次都填写表达式信息。如下图所示：")]),s._v(" "),t("p",[t("img",{attrs:{src:"/img/%E5%B7%A5%E4%BD%9C%E6%B5%81%E6%89%8B%E5%86%8C/%E6%B5%81%E7%A8%8B%E8%A1%A8%E8%BE%BE%E5%BC%8F/%E9%80%89%E6%8B%A9%E8%A1%A8%E8%BE%BE%E5%BC%8F.png",alt:"选择表达式"}})]),s._v(" "),t("h3",{attrs:{id:"_2-2-表结构"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_2-2-表结构"}},[s._v("#")]),s._v(" 2.2 表结构")]),s._v(" "),t("p",[s._v("流程表达式表，是我们自己定义的 "),t("code",[s._v("bpm_process_expression")]),s._v(" 表，结构如下：")]),s._v(" "),t("blockquote",[t("p",[s._v("省略 creator/create_time/updater/update_time/deleted/tenant_id 等通用字段")])]),s._v(" "),t("div",{staticClass:"language-SQL extra-class"},[t("pre",{pre:!0,attrs:{class:"language-sql"}},[t("code",[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("CREATE")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("TABLE")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token identifier"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("`")]),s._v("bpm_process_expression"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("`")])]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token identifier"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("`")]),s._v("id"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("`")])]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("bigint")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("NOT")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("NULL")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("AUTO_INCREMENT")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("COMMENT")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'编号'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token identifier"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("`")]),s._v("name"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("`")])]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("varchar")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("64")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("CHARACTER")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("SET")]),s._v(" utf8mb4 "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("COLLATE")]),s._v(" utf8mb4_unicode_ci "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("NOT")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("NULL")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("DEFAULT")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("''")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("COMMENT")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'表达式名字'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token identifier"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("`")]),s._v("status"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("`")])]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("tinyint")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("NOT")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("NULL")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("COMMENT")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'表达式状态'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n  \n  "),t("span",{pre:!0,attrs:{class:"token identifier"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("`")]),s._v("expression"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("`")])]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("varchar")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1024")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("CHARACTER")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("SET")]),s._v(" utf8mb4 "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("COLLATE")]),s._v(" utf8mb4_unicode_ci "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("NOT")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("NULL")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("COMMENT")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'表达式'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("PRIMARY")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("KEY")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token identifier"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("`")]),s._v("id"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("`")])]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("USING")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("BTREE")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("ENGINE")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("InnoDB")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("AUTO_INCREMENT")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("120")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("DEFAULT")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("CHARSET")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("utf8mb4 "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("COLLATE")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("utf8mb4_unicode_ci "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("COMMENT")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'BPM 流程表达式表'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])])]),t("p",[s._v("关键是 "),t("code",[s._v("expression")]),s._v(" 字段，表示表达式的内容。")])])}),[],!1,null,null,null);t.default=r.exports}}]);