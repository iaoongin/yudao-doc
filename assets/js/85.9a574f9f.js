(window.webpackJsonp=window.webpackJsonp||[]).push([[85],{414:function(t,a,e){"use strict";e.r(a);var r=e(7),_=Object(r.a)({},(function(){var t=this,a=t._self._c;return a("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[a("div",{staticClass:"custom-block tip"},[a("p",{staticClass:"custom-block-title"},[t._v("前置阅读：")]),t._v(" "),a("p",[t._v("① 阅读 "),a("RouterLink",{attrs:{to:"/pay/build/"}},[t._v("《支付功能开启》")]),t._v(" 和 "),a("RouterLink",{attrs:{to:"/pay/alipay-pay-demo/"}},[t._v("《支付宝支付接入》")]),t._v(" 文档，一定要先跑通支付宝支付流程！！！不跑通支付宝，微信公众号支付更跑不通。")],1),t._v(" "),a("p",[t._v("② 阅读 "),a("RouterLink",{attrs:{to:"/member/weixin-mp-login/"}},[t._v("《微信公众号登录》")]),t._v(" 文档，因为微信公众号支付需要先微信公众号登录，超级麻烦的说！")],1),t._v(" "),a("p",[t._v("注意，微信公众号支付不能使用“测试公众号”，必须使用认证过的公众号。并且，在阅读《公众号登录》文档时，前端项目需要使用 "),a("RouterLink",{attrs:{to:"/natapp/"}},[t._v("《内网穿透》")]),t._v("，因为微信公众号支付只能在手机微信上测试！！！")],1)]),t._v(" "),a("p",[t._v("微信公众号支付，使用 WxPubPayClient 客户端进行对接。")]),t._v(" "),a("p",[t._v("下面，我们以 "),a("code",[t._v("yudao-mall-uniapp")]),t._v(" 商城项目，演示微信公众号支付的接入流程。")]),t._v(" "),a("div",{staticClass:"custom-block tip"},[a("p",{staticClass:"custom-block-title"},[t._v("友情提示：")]),t._v(" "),a("ul",[a("li",[a("a",{attrs:{href:"http://niubi.natapp1.cc",target:"_blank",rel:"noopener noreferrer"}},[t._v("http://niubi.natapp1.cc"),a("OutboundLink")],1),t._v(" 域名，是我前端项目的访问域名")]),t._v(" "),a("li",[a("a",{attrs:{href:"http://yunai.natapp1.cc",target:"_blank",rel:"noopener noreferrer"}},[t._v("http://yunai.natapp1.cc"),a("OutboundLink")],1),t._v(" 域名，是我后端项目的访问域名")])]),t._v(" "),a("p",[t._v("所以，你的前后端项目也要分别使用 "),a("RouterLink",{attrs:{to:"/natapp/"}},[t._v("《内网穿透》")]),t._v(" 实现独立域名！！！")],1)]),t._v(" "),a("h2",{attrs:{id:"_1-第一步-配置支付渠道"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-第一步-配置支付渠道"}},[t._v("#")]),t._v(" 1. 第一步，配置支付渠道")]),t._v(" "),a("p",[t._v("① 访问 [支付管理 -> 应用信息] 菜单，点击“商城应用”对应的【微信 JSAPI 支付】，进入支付渠道的配置。如下图所示：")]),t._v(" "),a("p",[a("img",{attrs:{src:"/img/%E6%94%AF%E4%BB%98%E6%89%8B%E5%86%8C/%E5%BE%AE%E4%BF%A1%E5%85%AC%E4%BC%97%E5%8F%B7%E6%94%AF%E4%BB%98%E6%8E%A5%E5%85%A5/%E6%94%AF%E4%BB%98%E6%B8%A0%E9%81%93%E9%85%8D%E7%BD%AE.png",alt:"支付渠道配置"}})]),t._v(" "),a("ul",[a("li",[t._v("在 "),a("a",{attrs:{href:"https://pay.weixin.qq.com/index.php/core/account/info",target:"_blank",rel:"noopener noreferrer"}},[t._v("https://pay.weixin.qq.com/index.php/core/account/info"),a("OutboundLink")],1),t._v(" 地址，可获取微信支付商户号")]),t._v(" "),a("li",[t._v("在 "),a("a",{attrs:{href:"https://pay.weixin.qq.com/index.php/core/cert/api_cert#/",target:"_blank",rel:"noopener noreferrer"}},[t._v("https://pay.weixin.qq.com/index.php/core/cert/api_cert#/"),a("OutboundLink")],1),t._v(" 地址，可获取 API 证书、密钥")])]),t._v(" "),a("div",{staticClass:"custom-block tip"},[a("p",{staticClass:"custom-block-title"},[t._v("友情提示：")]),t._v(" "),a("p",[t._v("可以简单阅读下 "),a("a",{attrs:{href:"https://pay.weixin.qq.com/wiki/doc/apiv3_partner/open/pay/chapter2_1.shtml",target:"_blank",rel:"noopener noreferrer"}},[t._v("《微信官方文档 —— JSAPI 支付的接入前准备》"),a("OutboundLink")],1),t._v(" 文章。")])]),t._v(" "),a("p",[t._v("② 访问微信支付的 "),a("a",{attrs:{href:"https://pay.weixin.qq.com/index.php/extend/pay_setting",target:"_blank",rel:"noopener noreferrer"}},[t._v("开发配置"),a("OutboundLink")],1),t._v(" 地址，设置 JSAPI 支付目录，设置为前端项目的访问域名。如下图所示：")]),t._v(" "),a("p",[a("img",{attrs:{src:"/img/%E6%94%AF%E4%BB%98%E6%89%8B%E5%86%8C/%E5%BE%AE%E4%BF%A1%E5%85%AC%E4%BC%97%E5%8F%B7%E6%94%AF%E4%BB%98%E6%8E%A5%E5%85%A5/JSAPI%E6%94%AF%E4%BB%98%E7%9B%AE%E5%BD%95.png",alt:"JSAPI 支付目录"}})]),t._v(" "),a("h2",{attrs:{id:"_2-支付功能测试"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-支付功能测试"}},[t._v("#")]),t._v(" 2. 支付功能测试")]),t._v(" "),a("p",[t._v("① IDEA 打开前端项目，搜索 "),a("code",[t._v("http://127.0.0.1:48080")]),t._v(" 关键字，都替换成后端项目的访问域名。例如说下图：")]),t._v(" "),a("p",[a("img",{attrs:{src:"/img/%E6%94%AF%E4%BB%98%E6%89%8B%E5%86%8C/%E5%BE%AE%E4%BF%A1%E5%85%AC%E4%BC%97%E5%8F%B7%E6%94%AF%E4%BB%98%E6%8E%A5%E5%85%A5/%E6%9B%BF%E6%8D%A2%E5%90%8E%E7%AB%AF%E5%9F%9F%E5%90%8D.png",alt:"替换后端域名"}})]),t._v(" "),a("p",[t._v("② 使用手机微信，访问前端项目的域名。随便找个商品下单，一路往下走，可以进入“收银台”界面（对应前端项目的 "),a("code",[t._v("pages/pay/index.vue")]),t._v(" 文件）。如下图所示：")]),t._v(" "),a("p",[a("img",{attrs:{src:"/img/%E6%94%AF%E4%BB%98%E6%89%8B%E5%86%8C/%E5%BE%AE%E4%BF%A1%E5%85%AC%E4%BC%97%E5%8F%B7%E6%94%AF%E4%BB%98%E6%8E%A5%E5%85%A5/%E6%94%B6%E9%93%B6%E5%8F%B0.png",alt:"收银台"}})]),t._v(" "),a("p",[t._v("③ 选择“微信支付”，点击“立即支付”按钮，即可进行微信支付。如下图所示：")]),t._v(" "),a("p",[a("img",{attrs:{src:"/img/%E6%94%AF%E4%BB%98%E6%89%8B%E5%86%8C/%E5%BE%AE%E4%BF%A1%E5%85%AC%E4%BC%97%E5%8F%B7%E6%94%AF%E4%BB%98%E6%8E%A5%E5%85%A5/%E7%AB%8B%E5%8D%B3%E6%94%AF%E4%BB%98.png",alt:"立即支付"}})]),t._v(" "),a("ul",[a("li",[t._v("前端代码的实现，可见 "),a("code",[t._v("sheep/platform/pay.js")]),t._v(" 文件的 "),a("code",[t._v("#wechatOfficialAccountPay(...)")]),t._v(" 方法")]),t._v(" "),a("li",[t._v("后端代码的实现，可见 AppPayOrderController 提供的 "),a("code",[t._v("#submitPayOrder(...)")]),t._v(" 接口")])]),t._v(" "),a("p",[t._v("④ 支付成功后，跳转到“支付结果”界面（对应前端项目的 "),a("code",[t._v("pages/pay/result.vue")]),t._v(" 文件）。")]),t._v(" "),a("div",{staticClass:"custom-block tip"},[a("p",{staticClass:"custom-block-title"},[t._v("友情提示：")]),t._v(" "),a("p",[t._v("如果这个过程中碰到问题，可以先使用「微信开发者工具」访问前端项目的域名，看看这个过程中有没什么报错。")]),t._v(" "),a("p",[t._v("自查 30-60 分钟，如果还是无法解决，可以在星球发帖求助！但是注意，一定要先自查，因为这玩意没环境现场，很难搞啊！！！")])])])}),[],!1,null,null,null);a.default=_.exports}}]);