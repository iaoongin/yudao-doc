(window.webpackJsonp=window.webpackJsonp||[]).push([[181],{510:function(t,s,a){"use strict";a.r(s);var n=a(7),e=Object(n.a)({},(function(){var t=this,s=t._self._c;return s("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[s("p",[t._v("本章节，介绍项目的站内信功能。它在管理后台有三个菜单，分别是：")]),t._v(" "),s("p",[s("strong",[t._v("① 站内信模版：管理站内信的内容模版")])]),t._v(" "),s("p",[s("img",{attrs:{src:"/img/%E7%AB%99%E5%86%85%E4%BF%A1%E9%85%8D%E7%BD%AE/%E6%BC%94%E7%A4%BA-%E7%AB%99%E5%86%85%E4%BF%A1%E6%A8%A1%E7%89%88.png",alt:"站内信模版"}})]),t._v(" "),s("p",[s("strong",[t._v("② 站内信管理：查看站内信的发送记录")])]),t._v(" "),s("p",[s("img",{attrs:{src:"/img/%E7%AB%99%E5%86%85%E4%BF%A1%E9%85%8D%E7%BD%AE/%E6%BC%94%E7%A4%BA-%E7%AB%99%E5%86%85%E4%BF%A1%E7%AE%A1%E7%90%86.png",alt:"站内信管理"}})]),t._v(" "),s("p",[s("strong",[t._v("③ 我的站内信：查看发送给我的站内信")])]),t._v(" "),s("p",[s("img",{attrs:{src:"/img/%E7%AB%99%E5%86%85%E4%BF%A1%E9%85%8D%E7%BD%AE/%E6%BC%94%E7%A4%BA-%E6%88%91%E7%9A%84%E7%AB%99%E5%86%85%E4%BF%A1.png",alt:"我的站内信"}})]),t._v(" "),s("h2",{attrs:{id:"_1-表结构"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_1-表结构"}},[t._v("#")]),t._v(" 1. 表结构")]),t._v(" "),s("p",[s("img",{attrs:{src:"/img/%E7%AB%99%E5%86%85%E4%BF%A1%E9%85%8D%E7%BD%AE/%E8%A1%A8%E7%BB%93%E6%9E%84.png",alt:"表结构"}})]),t._v(" "),s("h2",{attrs:{id:"_2-实现代码"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_2-实现代码"}},[t._v("#")]),t._v(" 2. 实现代码")]),t._v(" "),s("ul",[s("li",[t._v("前端代码："),s("a",{attrs:{href:"https://github.com/yudaocode/yudao-ui-admin-vue2/blob/master/src/views/system/notify/",target:"_blank",rel:"noopener noreferrer"}},[t._v("views/system/notify"),s("OutboundLink")],1)]),t._v(" "),s("li",[t._v("后端代码："),s("a",{attrs:{href:"https://github.com/YunaiV/ruoyi-vue-pro/blob/master/yudao-module-system/yudao-module-system-biz/src/main/java/cn/iocoder/yudao/module/system/controller/admin/notify/",target:"_blank",rel:"noopener noreferrer"}},[t._v("controller/admin/notify"),s("OutboundLink")],1)])]),t._v(" "),s("h2",{attrs:{id:"_3-站内信配置"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_3-站内信配置"}},[t._v("#")]),t._v(" 3. 站内信配置")]),t._v(" "),s("p",[t._v("本小节，讲解如何配置站内信功能，整个过程如下：")]),t._v(" "),s("ol",[s("li",[t._v("新建一个站内信【模版】，配置站内信的内容模版")]),t._v(" "),s("li",[t._v("测试该站内信模板，查看对应的站内信【记录】，确认是否发送成功")])]),t._v(" "),s("h3",{attrs:{id:"_3-1-新建站内信模版"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_3-1-新建站内信模版"}},[t._v("#")]),t._v(" 3.1 新建站内信模版")]),t._v(" "),s("p",[t._v("① 点击 [系统管理 -> 消息中心 -> 站内信管理 -> 模板管理] 菜单，查看站内信模板的列表。如下图所示：")]),t._v(" "),s("p",[s("img",{attrs:{src:"/img/%E7%AB%99%E5%86%85%E4%BF%A1%E9%85%8D%E7%BD%AE/%E6%BC%94%E7%A4%BA-%E7%AB%99%E5%86%85%E4%BF%A1%E6%A8%A1%E7%89%88.png",alt:"站内信模版"}})]),t._v(" "),s("p",[t._v("② 点击 [新增] 按钮，填写信息如下图：")]),t._v(" "),s("p",[s("img",{attrs:{src:"/img/%E7%AB%99%E5%86%85%E4%BF%A1%E9%85%8D%E7%BD%AE/%E7%AB%99%E5%86%85%E4%BF%A1%E9%85%8D%E7%BD%AE-%E6%96%B0%E5%A2%9E%E7%AB%99%E5%86%85%E4%BF%A1%E6%A8%A1%E7%89%88.png",alt:"站内信模板的新增"}})]),t._v(" "),s("ul",[s("li",[t._v("模版编号：站内信模板的唯一标识，使用站内信 API 时，通过它标识使用的站内信模板")]),t._v(" "),s("li",[t._v("发件人名称：发送站内信显示的发件人名字")]),t._v(" "),s("li",[t._v("模板内容：站内信模板的内容，使用 "),s("code",[t._v("{var}")]),t._v(" 作为占位符，例如说 "),s("code",[t._v("{name}")]),t._v("、"),s("code",[t._v("{code}")]),t._v(" 等")]),t._v(" "),s("li",[t._v("模版类型：站内信的分类，可使用 "),s("code",[t._v("system_notify_template_type")]),t._v(" 字典进行自定义")]),t._v(" "),s("li",[t._v("开启状态：站内信模板被禁用时，该站内信模板将不发送站内信，只打印 logger 日志")])]),t._v(" "),s("div",{staticClass:"custom-block tip"},[s("p",{staticClass:"custom-block-title"},[t._v("疑问：为什么设计站内信模板的功能？")]),t._v(" "),s("p",[t._v("在一些场景下，产品会希望修改发送站内信的内容、发送人昵称，此时只需要修改站内信模版的对应属性，无需重启应用。")])]),t._v(" "),s("h3",{attrs:{id:"_3-2-测试站内信模版"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_3-2-测试站内信模版"}},[t._v("#")]),t._v(" 3.2 测试站内信模版")]),t._v(" "),s("p",[t._v("① 点击 [测试] 按钮，选择接收人为「芋道源码」，进行该站内信模板的模拟发送。如下图所示：")]),t._v(" "),s("p",[s("img",{attrs:{src:"/img/%E7%AB%99%E5%86%85%E4%BF%A1%E9%85%8D%E7%BD%AE/%E7%AB%99%E5%86%85%E4%BF%A1%E9%85%8D%E7%BD%AE-%E6%B5%8B%E8%AF%95%E7%AB%99%E5%86%85%E4%BF%A1.png",alt:"测试站内信"}})]),t._v(" "),s("p",[t._v("② 点击 [系统管理 -> 消息中心 -> 站内信管理 -> 消息记录] 菜单，可以查看到刚发送的站内信。如下图所示：")]),t._v(" "),s("p",[s("img",{attrs:{src:"/img/%E7%AB%99%E5%86%85%E4%BF%A1%E9%85%8D%E7%BD%AE/%E7%AB%99%E5%86%85%E4%BF%A1%E9%85%8D%E7%BD%AE-%E7%AB%99%E5%86%85%E4%BF%A1%E5%8F%91%E9%80%81%E6%97%A5%E5%BF%97.png",alt:"站内信发送日志"}})]),t._v(" "),s("p",[t._v("③ 点击右上角的 [消息] 图标，也可以查看到刚发送的站内信。如下图所示：")]),t._v(" "),s("p",[s("img",{attrs:{src:"/img/%E7%AB%99%E5%86%85%E4%BF%A1%E9%85%8D%E7%BD%AE/%E7%AB%99%E5%86%85%E4%BF%A1%E9%85%8D%E7%BD%AE-%E7%AB%99%E5%86%85%E4%BF%A1%E6%8E%A5%E6%94%B6%E6%97%A5%E5%BF%97.png",alt:"站内信接收日志"}})]),t._v(" "),s("h2",{attrs:{id:"_4-站内信发送"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_4-站内信发送"}},[t._v("#")]),t._v(" 4. 站内信发送")]),t._v(" "),s("h3",{attrs:{id:"_4-1-notifymessagesendapi"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_4-1-notifymessagesendapi"}},[t._v("#")]),t._v(" 4.1 NotifyMessageSendApi")]),t._v(" "),s("p",[s("RouterLink",{attrs:{to:"/#_3-站内信配置"}},[t._v("站内信配置")]),t._v("完成后，可使用 "),s("a",{attrs:{href:"https://github.com/YunaiV/ruoyi-vue-pro/blob/master/yudao-module-system/yudao-module-system-api/src/main/java/cn/iocoder/yudao/module/system/api/notify/NotifyMessageSendApi.java",target:"_blank",rel:"noopener noreferrer"}},[t._v("NotifyMessageSendApi"),s("OutboundLink")],1),t._v(" 进行站内信的发送，支持多种用户类型。它的方法如下：")],1),t._v(" "),s("p",[s("img",{attrs:{src:"/img/%E7%AB%99%E5%86%85%E4%BF%A1%E9%85%8D%E7%BD%AE/%E7%AB%99%E5%86%85%E4%BF%A1%E5%8F%91%E9%80%81-NotifyMessageSendApi.png",alt:"NotifyMessageSendApi"}})]),t._v(" "),s("h3",{attrs:{id:"_4-2-接入示例"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_4-2-接入示例"}},[t._v("#")]),t._v(" 4.2 接入示例")]),t._v(" "),s("p",[t._v("以 "),s("code",[t._v("yudao-module-infra")]),t._v(" 模块，需要发站内信为例子，讲解 SmsCodeApi 的使用。")]),t._v(" "),s("p",[t._v("① 在 "),s("code",[t._v("yudao-module-infra-biz")]),t._v(" 模块的 "),s("a",{attrs:{href:"https://github.com/YunaiV/ruoyi-vue-pro/blob/master/yudao-module-infra/yudao-module-infra-biz/pom.xml",target:"_blank",rel:"noopener noreferrer"}},[s("code",[t._v("pom.xml")]),s("OutboundLink")],1),t._v(" 引入 "),s("code",[t._v("yudao-module-system-api")]),t._v(" 依赖，如所示：")]),t._v(" "),s("div",{staticClass:"language-XML extra-class"},[s("pre",{pre:!0,attrs:{class:"language-xml"}},[s("code",[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("dependency")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("groupId")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("cn.iocoder.boot"),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("groupId")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("artifactId")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("yudao-module-system-api"),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("artifactId")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("version")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("${revision}"),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("version")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("dependency")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n")])])]),s("p",[t._v("② 在代码中注入 NotifyMessageSendApi Bean，并调用发送站内信的方法。代码如下：")]),t._v(" "),s("div",{staticClass:"language-Java extra-class"},[s("pre",{pre:!0,attrs:{class:"language-java"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("public")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("class")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("TestDemoServiceImpl")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("implements")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("TestDemoService")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n\n    "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 0. 注入 NotifyMessageSendApi Bean")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[t._v("@Resource")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("private")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("NotifyMessageSendApi")]),t._v(" notifySendApi"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("public")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("void")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("sendDemo")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 1. 准备参数")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Long")]),t._v(" userId "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1L")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 示例中写死，你可以改成你业务中的 userId 噢")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("String")]),t._v(" templateCode "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"test_01"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 站内信模版，记得在【站内信管理】中配置噢")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Map")]),s("span",{pre:!0,attrs:{class:"token generics"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("String")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Object")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v(" templateParams "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("HashMap")]),s("span",{pre:!0,attrs:{class:"token generics"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        templateParams"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("put")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"key1"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"奥特曼"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        templateParams"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("put")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"key2"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"变身"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n        "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 2. 发送站内信")]),t._v("\n        notifySendApi"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("sendSingleNotifylToAdmin")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("NotifySendSingleToUserReqDTO")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n                "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("setUserId")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("userId"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("setTemplateCode")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("templateCode"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("setTemplateParams")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("templateParams"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n    \n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])])])}),[],!1,null,null,null);s.default=e.exports}}]);