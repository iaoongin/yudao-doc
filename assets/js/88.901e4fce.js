(window.webpackJsonp=window.webpackJsonp||[]).push([[88],{417:function(t,s,a){"use strict";a.r(s);var e=a(7),n=Object(e.a)({},(function(){var t=this,s=t._self._c;return s("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[s("div",{staticClass:"custom-block tip"},[s("p",{staticClass:"custom-block-title"},[t._v("前置阅读：")]),t._v(" "),s("p",[t._v("需要先阅读如下文档，对支付、退款功能有一定了解：")]),t._v(" "),s("ul",[s("li",[s("RouterLink",{attrs:{to:"/pay/build/"}},[t._v("《支付功能开启》")])],1),t._v(" "),s("li",[s("RouterLink",{attrs:{to:"/pay/alipay-pay-demo/"}},[t._v("《支付宝支付接入》")])],1),t._v(" "),s("li",[s("a",{attrs:{href:"/pay/refund-demo"}},[t._v("《支付宝、微信退款接入》")])])])]),t._v(" "),s("p",[t._v("在 "),s("code",[t._v("yudao-module-pay-biz")]),t._v(" 模块的 "),s("a",{attrs:{href:"https://github.com/YunaiV/ruoyi-vue-pro/tree/master/yudao-module-pay/yudao-module-pay-biz/src/main/java/cn/iocoder/yudao/module/pay/service/wallet",target:"_blank",rel:"noopener noreferrer"}},[s("code",[t._v("wallet")]),s("OutboundLink")],1),t._v(" 模块，实现了钱包，包括了如下功能：")]),t._v(" "),s("ul",[s("li",[t._v("充值：可见 PayWalletRechargeService 类")]),t._v(" "),s("li",[t._v("支付：可见 WalletPayClient 类的 "),s("code",[t._v("#doUnifiedOrder(...)")]),t._v(" 方法")]),t._v(" "),s("li",[t._v("退款：可见 WalletRefundClient 类的 "),s("code",[t._v("#doUnifiedRefund(...)")]),t._v(" 方法")]),t._v(" "),s("li",[t._v("流水：可见 PayWalletTransactionService 类")])]),t._v(" "),s("div",{staticClass:"custom-block tip"},[s("p",{staticClass:"custom-block-title"},[t._v("疑问：为什么没有钱包的提现功能呢？")]),t._v(" "),s("p",[t._v("功能正在建设中，未来会支持提现到支付宝、微信、银行卡等渠道。")])]),t._v(" "),s("p",[t._v("下面，我们逐个功能进行介绍。")]),t._v(" "),s("h2",{attrs:{id:"_1-钱包信息"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_1-钱包信息"}},[t._v("#")]),t._v(" 1. 钱包信息")]),t._v(" "),s("p",[t._v("本小节，我们先来看看钱包的信息部分，包括钱包表、钱包流水表。")]),t._v(" "),s("h3",{attrs:{id:"_1-1-钱包表"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_1-1-钱包表"}},[t._v("#")]),t._v(" 1.1 钱包表")]),t._v(" "),s("p",[s("code",[t._v("pay_wallet")]),t._v(" 表，会员钱包表，由 PayWalletService 实现。表结构如下：")]),t._v(" "),s("div",{staticClass:"language-SQL extra-class"},[s("pre",{pre:!0,attrs:{class:"language-sql"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("CREATE")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("TABLE")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token identifier"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("`")]),t._v("pay_wallet"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("`")])]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token identifier"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("`")]),t._v("id"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("`")])]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("bigint")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("NOT")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("NULL")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("AUTO_INCREMENT")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("COMMENT")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'编号'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  \n  "),s("span",{pre:!0,attrs:{class:"token identifier"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("`")]),t._v("user_id"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("`")])]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("bigint")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("NOT")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("NULL")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("COMMENT")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'用户编号'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token identifier"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("`")]),t._v("user_type"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("`")])]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("tinyint")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("NOT")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("NULL")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("DEFAULT")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'0'")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("COMMENT")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'用户类型'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  \n  "),s("span",{pre:!0,attrs:{class:"token identifier"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("`")]),t._v("balance"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("`")])]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("int")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("NOT")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("NULL")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("DEFAULT")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'0'")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("COMMENT")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'余额，单位分'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  \n  "),s("span",{pre:!0,attrs:{class:"token identifier"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("`")]),t._v("total_expense"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("`")])]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("int")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("NOT")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("NULL")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("DEFAULT")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'0'")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("COMMENT")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'累计支出，单位分'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token identifier"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("`")]),t._v("total_recharge"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("`")])]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("int")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("NOT")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("NULL")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("DEFAULT")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'0'")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("COMMENT")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'累计充值，单位分'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token identifier"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("`")]),t._v("freeze_price"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("`")])]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("int")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("NOT")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("NULL")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("DEFAULT")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'0'")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("COMMENT")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'冻结金额，单位分'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  \n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("ENGINE")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("InnoDB")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("AUTO_INCREMENT")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("20")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("DEFAULT")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("CHARSET")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("utf8mb4 "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("COLLATE")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("utf8mb4_unicode_ci "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("COMMENT")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'会员钱包表'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),s("blockquote",[s("p",[t._v("省略 creator/create_time/updater/update_time/deleted/tenant_id 等通用字段")])]),t._v(" "),s("p",[t._v("① "),s("code",[t._v("user_id")]),t._v("、"),s("code",[t._v("user_type")]),t._v(" 字段：关联的用户编号、用户类型，例如说“商城”的会员用户。")]),t._v(" "),s("p",[t._v("② "),s("code",[t._v("balance")]),t._v(" 字段：余额，单位分。支付时，会从这里扣除。")]),t._v(" "),s("ul",[s("li",[s("code",[t._v("total_expense")]),t._v(" 字段，累计支出，单位分。每次支付时，会增加该字段。")]),t._v(" "),s("li",[s("code",[t._v("total_recharge")]),t._v(" 字段：累计充值，单位分。每次充值时，会增加该字段。")])]),t._v(" "),s("p",[t._v("③ "),s("code",[t._v("freeze_price")]),t._v(" 字段：冻结金额，单位分。目前用于钱包充值时的退款，可暂时不用了解。")]),t._v(" "),s("h4",{attrs:{id:"_1-1-1-钱包创建"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_1-1-1-钱包创建"}},[t._v("#")]),t._v(" 1.1.1 钱包创建")]),t._v(" "),s("p",[t._v("一般情况下，用户创建后，自动进行关联的钱包创建。但是考虑到 "),s("code",[t._v("pay")]),t._v(" 模块是可选模块，需要进行结构。")]),t._v(" "),s("p",[t._v("所以，目前是通过 PayWalletService 的 "),s("code",[t._v("#getOrCreateWallet(userId, userType)")]),t._v(" 方法来进行“创建”：不存在则进行创建，存在则直接查询返回。")]),t._v(" "),s("h4",{attrs:{id:"_1-1-2-管理后台"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_1-1-2-管理后台"}},[t._v("#")]),t._v(" 1.1.2 管理后台")]),t._v(" "),s("p",[t._v("在 [支付管理 -> 钱包管理 -> 钱包余额] 菜单，对应 "),s("code",[t._v("yudao-ui-admin-vue3/src/views/pay/wallet/balance/index.vue")]),t._v(" 界面，可以查看钱包列表。如下图所示：")]),t._v(" "),s("p",[s("img",{attrs:{src:"/img/%E6%94%AF%E4%BB%98%E6%89%8B%E5%86%8C/%E9%92%B1%E5%8C%85/%E9%92%B1%E5%8C%85%E4%BD%99%E9%A2%9D.png",alt:"钱包余额"}})]),t._v(" "),s("h4",{attrs:{id:"_1-1-3-修改余额"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_1-1-3-修改余额"}},[t._v("#")]),t._v(" 1.1.3 修改余额")]),t._v(" "),s("p",[t._v("在 [会员中心 -> 会员管理] 菜单，点击 [>> 更多 -> 修改余额]，对应 "),s("code",[t._v("yudao-ui-admin-vue3/src/views/member/user/components/UserBalanceUpdateForm.vue")]),t._v(" 界面，可以修改钱包余额。如下图所示：")]),t._v(" "),s("p",[s("img",{attrs:{src:"/img/%E6%94%AF%E4%BB%98%E6%89%8B%E5%86%8C/%E9%92%B1%E5%8C%85/%E4%BF%AE%E6%94%B9%E4%BD%99%E9%A2%9D.png",alt:"修改余额"}})]),t._v(" "),s("h3",{attrs:{id:"_1-2-钱包流水表"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_1-2-钱包流水表"}},[t._v("#")]),t._v(" 1.2 钱包流水表")]),t._v(" "),s("p",[s("code",[t._v("pay_wallet")]),t._v(" 表，会员钱包表，由 PayWalletService 实现。表结构如下：")]),t._v(" "),s("div",{staticClass:"language-SQL extra-class"},[s("pre",{pre:!0,attrs:{class:"language-sql"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("CREATE")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("TABLE")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token identifier"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("`")]),t._v("pay_wallet_transaction"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("`")])]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token identifier"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("`")]),t._v("id"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("`")])]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("bigint")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("NOT")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("NULL")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("AUTO_INCREMENT")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("COMMENT")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'编号'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n\n  "),s("span",{pre:!0,attrs:{class:"token identifier"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("`")]),t._v("wallet_id"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("`")])]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("bigint")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("NOT")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("NULL")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("COMMENT")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'会员钱包 id'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  \n  "),s("span",{pre:!0,attrs:{class:"token identifier"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("`")]),t._v("biz_type"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("`")])]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("tinyint")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("NOT")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("NULL")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("COMMENT")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'关联类型'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token identifier"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("`")]),t._v("biz_id"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("`")])]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("varchar")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("64")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("CHARACTER")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("SET")]),t._v(" utf8mb4 "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("COLLATE")]),t._v(" utf8mb4_unicode_ci "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("NOT")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("NULL")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("COMMENT")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'关联业务编号'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token identifier"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("`")]),t._v("title"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("`")])]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("varchar")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("128")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("CHARACTER")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("SET")]),t._v(" utf8mb4 "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("COLLATE")]),t._v(" utf8mb4_unicode_ci "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("NOT")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("NULL")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("COMMENT")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'流水标题'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  \n  "),s("span",{pre:!0,attrs:{class:"token identifier"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("`")]),t._v("no"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("`")])]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("varchar")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("64")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("CHARACTER")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("SET")]),t._v(" utf8mb4 "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("COLLATE")]),t._v(" utf8mb4_unicode_ci "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("NOT")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("NULL")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("COMMENT")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'流水号'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    \n  "),s("span",{pre:!0,attrs:{class:"token identifier"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("`")]),t._v("price"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("`")])]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("int")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("NOT")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("NULL")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("COMMENT")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'交易金额, 单位分'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token identifier"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("`")]),t._v("balance"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("`")])]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("int")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("NOT")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("NULL")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("COMMENT")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'余额, 单位分'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("ENGINE")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("InnoDB")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("AUTO_INCREMENT")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("29")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("DEFAULT")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("CHARSET")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("utf8mb4 "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("COLLATE")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("utf8mb4_unicode_ci "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("COMMENT")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'会员钱包流水表'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),s("blockquote",[s("p",[t._v("省略 creator/create_time/updater/update_time/deleted/tenant_id 等通用字段")])]),t._v(" "),s("p",[t._v("① "),s("code",[t._v("wallet_id")]),t._v(" 字段：关联的钱包编号，即 "),s("code",[t._v("pay_wallet")]),t._v(" 表的 "),s("code",[t._v("id")]),t._v(" 字段。")]),t._v(" "),s("p",[t._v("② "),s("code",[t._v("biz_type")]),t._v("、"),s("code",[t._v("biz_id")]),t._v(" 字段：关联的业务类型、业务编号。目前 "),s("code",[t._v("biz_type")]),t._v(" 由 PayWalletBizTypeEnum 枚举，目前有充值、充值退款、支付、支付退款、更新余额等。")]),t._v(" "),s("p",[s("code",[t._v("title")]),t._v(" 字段：流水标题，例如说：充值、支付、退款等。主要用于展示，没有什么特殊逻辑。")]),t._v(" "),s("p",[t._v("③ "),s("code",[t._v("no")]),t._v(" 字段：流水号，全局唯一，例如说：W202408011306351。它通过 PayNoRedisDAO 生成，前缀是 "),s("code",[t._v("W")]),t._v("。")]),t._v(" "),s("p",[t._v("④ "),s("code",[t._v("price")]),t._v(" 字段：本次交易的金额，单位分：")]),t._v(" "),s("ul",[s("li",[t._v("正数表示收入：例如说充值、支付退款")]),t._v(" "),s("li",[t._v("负数表示支出：例如说支付、充值退款")])]),t._v(" "),s("p",[s("code",[t._v("balance")]),t._v(" 字段：交易后的钱包余额，单位分。")]),t._v(" "),s("h4",{attrs:{id:"_1-2-1-管理后台"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_1-2-1-管理后台"}},[t._v("#")]),t._v(" 1.2.1 管理后台")]),t._v(" "),s("p",[t._v("在 [支付管理 -> 钱包管理 -> 钱包余额] 菜单，点击钱包后的 [详情] 按钮，对应 "),s("code",[t._v("yudao-ui-admin-vue3/src/views/pay/wallet/transaction/WalletTransactionList.vue")]),t._v(" 界面，可以查看钱包流水。如下图所示：")]),t._v(" "),s("p",[s("img",{attrs:{src:"/img/%E6%94%AF%E4%BB%98%E6%89%8B%E5%86%8C/%E9%92%B1%E5%8C%85/%E9%92%B1%E5%8C%85%E6%B5%81%E6%B0%B4.png",alt:"钱包流水"}})]),t._v(" "),s("h2",{attrs:{id:"_2-钱包充值"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_2-钱包充值"}},[t._v("#")]),t._v(" 2. 钱包充值")]),t._v(" "),s("p",[t._v("本小节，我们先来看看钱包的充值部分，包括钱包充值表、钱包充值套餐表。")]),t._v(" "),s("p",[t._v("一般情况下，钱包的余额是通过充值来进行的，稍后会进行演示。")]),t._v(" "),s("h3",{attrs:{id:"_2-1-钱包套餐表"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_2-1-钱包套餐表"}},[t._v("#")]),t._v(" 2.1 钱包套餐表")]),t._v(" "),s("p",[s("code",[t._v("pay_wallet_recharge_package")]),t._v(" 表，充值套餐表，由 PayWalletRechargePackageService 实现。表结构如下：")]),t._v(" "),s("div",{staticClass:"language-SQL extra-class"},[s("pre",{pre:!0,attrs:{class:"language-sql"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("CREATE")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("TABLE")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token identifier"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("`")]),t._v("pay_wallet_recharge_package"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("`")])]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token identifier"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("`")]),t._v("id"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("`")])]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("bigint")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("NOT")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("NULL")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("AUTO_INCREMENT")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("COMMENT")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'编号'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token identifier"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("`")]),t._v("name"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("`")])]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("varchar")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("64")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("COLLATE")]),t._v(" utf8mb4_unicode_ci "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("NOT")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("NULL")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("COMMENT")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'套餐名'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token identifier"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("`")]),t._v("status"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("`")])]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("tinyint")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("NOT")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("NULL")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("COMMENT")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'状态'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n\n  "),s("span",{pre:!0,attrs:{class:"token identifier"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("`")]),t._v("pay_price"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("`")])]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("int")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("NOT")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("NULL")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("COMMENT")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'支付金额'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token identifier"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("`")]),t._v("bonus_price"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("`")])]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("int")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("NOT")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("NULL")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("COMMENT")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'赠送金额'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  \n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("ENGINE")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("InnoDB")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("AUTO_INCREMENT")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("3")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("DEFAULT")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("CHARSET")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("utf8mb4 "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("COLLATE")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("utf8mb4_unicode_ci "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("COMMENT")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'充值套餐表'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),s("blockquote",[s("p",[t._v("省略 creator/create_time/updater/update_time/deleted/tenant_id 等通用字段")])]),t._v(" "),s("p",[t._v("比较关键的就 "),s("code",[t._v("pay_price")]),t._v("、"),s("code",[t._v("bonus_price")]),t._v(" 字段：")]),t._v(" "),s("p",[t._v("① "),s("code",[t._v("pay_price")]),t._v(" 字段：支付金额，单位分。购买该套餐需要支付的金额。")]),t._v(" "),s("p",[t._v("② "),s("code",[t._v("bonus_price")]),t._v(" 字段：赠送金额，单位分。购买该套餐，额外赠送的金额。")]),t._v(" "),s("p",[t._v("最终充值到钱包的余额，是 "),s("code",[t._v("pay_price")]),t._v(" + "),s("code",[t._v("bonus_price")]),t._v("。")]),t._v(" "),s("h4",{attrs:{id:"_2-1-1-管理后台"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_2-1-1-管理后台"}},[t._v("#")]),t._v(" 2.1.1 管理后台")]),t._v(" "),s("p",[t._v("在 [支付管理 -> 钱包管理 -> 充值套餐] 菜单，对应 "),s("code",[t._v("yudao-ui-admin-vue3/src/views/pay/wallet/rechargePackage/index.vue")]),t._v(" 界面，可以查看钱包充值套餐。如下图所示：")]),t._v(" "),s("p",[s("img",{attrs:{src:"/img/%E6%94%AF%E4%BB%98%E6%89%8B%E5%86%8C/%E9%92%B1%E5%8C%85/%E5%85%85%E5%80%BC%E5%A5%97%E9%A4%90.png",alt:"充值套餐"}})]),t._v(" "),s("h3",{attrs:{id:"_2-2-钱包充值表"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_2-2-钱包充值表"}},[t._v("#")]),t._v(" 2.2 钱包充值表")]),t._v(" "),s("p",[s("code",[t._v("pay_wallet_recharge")]),t._v(" 表，会员钱包充值表，由 PayWalletRechargeService 实现。表结构如下：")]),t._v(" "),s("div",{staticClass:"language-SQL extra-class"},[s("pre",{pre:!0,attrs:{class:"language-sql"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("CREATE")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("TABLE")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token identifier"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("`")]),t._v("pay_wallet_recharge"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("`")])]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token identifier"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("`")]),t._v("id"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("`")])]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("bigint")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("NOT")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("NULL")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("AUTO_INCREMENT")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("COMMENT")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'编号'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n\n  "),s("span",{pre:!0,attrs:{class:"token identifier"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("`")]),t._v("wallet_id"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("`")])]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("bigint")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("NOT")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("NULL")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("COMMENT")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'会员钱包 id'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  \n  "),s("span",{pre:!0,attrs:{class:"token identifier"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("`")]),t._v("total_price"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("`")])]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("int")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("NOT")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("NULL")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("COMMENT")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'用户实际到账余额，例如充 100 送 20，则该值是 120'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token identifier"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("`")]),t._v("pay_price"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("`")])]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("int")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("NOT")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("NULL")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("COMMENT")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'实际支付金额'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token identifier"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("`")]),t._v("bonus_price"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("`")])]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("int")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("NOT")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("NULL")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("COMMENT")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'钱包赠送金额'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  \n  "),s("span",{pre:!0,attrs:{class:"token identifier"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("`")]),t._v("package_id"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("`")])]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("bigint")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("DEFAULT")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("NULL")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("COMMENT")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'充值套餐编号'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  \n  "),s("span",{pre:!0,attrs:{class:"token identifier"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("`")]),t._v("pay_status"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("`")])]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("bit")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("NOT")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("NULL")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("DEFAULT")]),t._v(" b"),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'0'")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("COMMENT")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'是否已支付：[0:未支付 1:已经支付过]'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token identifier"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("`")]),t._v("pay_order_id"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("`")])]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("bigint")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("DEFAULT")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("NULL")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("COMMENT")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'支付订单编号'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token identifier"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("`")]),t._v("pay_channel_code"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("`")])]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("varchar")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("16")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("CHARACTER")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("SET")]),t._v(" utf8mb4 "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("COLLATE")]),t._v(" utf8mb4_unicode_ci "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("DEFAULT")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("NULL")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("COMMENT")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'支付成功的支付渠道'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token identifier"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("`")]),t._v("pay_time"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("`")])]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("datetime")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("DEFAULT")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("NULL")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("COMMENT")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'订单支付时间'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  \n  "),s("span",{pre:!0,attrs:{class:"token identifier"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("`")]),t._v("pay_refund_id"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("`")])]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("bigint")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("DEFAULT")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("NULL")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("COMMENT")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'支付退款单编号'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token identifier"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("`")]),t._v("refund_total_price"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("`")])]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("int")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("NOT")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("NULL")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("DEFAULT")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'0'")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("COMMENT")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'退款金额，包含赠送金额'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token identifier"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("`")]),t._v("refund_pay_price"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("`")])]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("int")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("NOT")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("NULL")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("DEFAULT")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'0'")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("COMMENT")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'退款支付金额'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token identifier"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("`")]),t._v("refund_bonus_price"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("`")])]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("int")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("NOT")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("NULL")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("DEFAULT")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'0'")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("COMMENT")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'退款钱包赠送金额'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token identifier"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("`")]),t._v("refund_time"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("`")])]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("datetime")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("DEFAULT")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("NULL")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("COMMENT")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'退款时间'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token identifier"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("`")]),t._v("refund_status"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("`")])]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("int")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("NOT")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("NULL")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("DEFAULT")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'0'")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("COMMENT")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'退款状态'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n\n  "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("PRIMARY")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("KEY")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token identifier"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("`")]),t._v("id"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("`")])]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("USING")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("BTREE")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("ENGINE")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("InnoDB")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("AUTO_INCREMENT")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("31")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("DEFAULT")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("CHARSET")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("utf8mb4 "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("COLLATE")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("utf8mb4_unicode_ci ROW_FORMAT"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("DYNAMIC "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("COMMENT")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'会员钱包充值'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),s("blockquote",[s("p",[t._v("省略 creator/create_time/updater/update_time/deleted/tenant_id 等通用字段")])]),t._v(" "),s("p",[t._v("本质上，钱包的充值，和商城的订单是类似的，只是没有商品信息而已。因此它也有 "),s("code",[t._v("pay_")]),t._v(" 开头的支付相关的字段，和 "),s("code",[t._v("refund_")]),t._v(" 开头的退款相关的字段。")]),t._v(" "),s("p",[t._v("① "),s("code",[t._v("wallet_id")]),t._v(" 字段：关联的钱包编号，即 "),s("code",[t._v("pay_wallet")]),t._v(" 表的 "),s("code",[t._v("id")]),t._v(" 字段。")]),t._v(" "),s("p",[t._v("② "),s("code",[t._v("total_price")]),t._v(" 字段：用户实际到账余额，例如充 100 送 20，则该值是 120。")]),t._v(" "),s("ul",[s("li",[s("code",[t._v("pay_price")]),t._v(" 字段：实际支付金额。")]),t._v(" "),s("li",[s("code",[t._v("bonus_price")]),t._v(" 字段：钱包赠送金额。一般情况下，只有选择了 "),s("code",[t._v("package_id")]),t._v(" 的套餐，才会有赠送金额。当然，也可以不选择套餐，直接充值。")])]),t._v(" "),s("p",[t._v("③ "),s("code",[t._v("pay_")]),t._v(" 开头的支付相关字段：钱包充值，可选择支付宝、微信等支付渠道，进行支付。")]),t._v(" "),s("ul",[s("li",[s("code",[t._v("pay_status")]),t._v(" 字段：是否已支付。")]),t._v(" "),s("li",[s("code",[t._v("pay_order_id")]),t._v(" 字段：支付订单编号，关联 "),s("code",[t._v("pay_order")]),t._v(" 表的 "),s("code",[t._v("id")]),t._v(" 字段。")]),t._v(" "),s("li",[s("code",[t._v("pay_channel_code")]),t._v(" 字段：支付成功的支付渠道，例如说支付宝、微信。")]),t._v(" "),s("li",[s("code",[t._v("pay_time")]),t._v(" 字段：订单支付时间。")])]),t._v(" "),s("p",[t._v("④ "),s("code",[t._v("refund_")]),t._v(" 开头的退款相关字段：钱包充值，可选择退款。")]),t._v(" "),s("ul",[s("li",[s("code",[t._v("refund_status")]),t._v(" 字段：退款状态，通过 PayRefundStatusEnum 枚举，目前有未退款、退款成功、退款失败。")]),t._v(" "),s("li",[s("code",[t._v("pay_refund_id")]),t._v(" 字段：支付退款单编号，关联 "),s("code",[t._v("pay_refund")]),t._v(" 表的 "),s("code",[t._v("id")]),t._v(" 字段。")]),t._v(" "),s("li",[s("code",[t._v("refund_total_price")]),t._v("、"),s("code",[t._v("refund_pay_price")]),t._v("、"),s("code",[t._v("refund_bonus_price")]),t._v(" 字段：退款金额，包含赠送金额、退款支付金额、退款钱包赠送金额。")]),t._v(" "),s("li",[s("code",[t._v("refund_time")]),t._v(" 字段：退款时间。")])]),t._v(" "),s("h3",{attrs:{id:"_2-3-充值流程"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_2-3-充值流程"}},[t._v("#")]),t._v(" 2.3 充值流程")]),t._v(" "),s("p",[t._v("下面，我们来演示下钱包的充值流程。目前，只有 "),s("a",{attrs:{href:"/mall/build"}},[t._v("商城")]),t._v(" 的 uni-app 端，可以进行充值。步骤如下：")]),t._v(" "),s("p",[t._v("① 在管理后台的 [支付管理 -> 应用信息] 菜单，将钱包对应的支付应用 "),s("code",[t._v("wallet")]),t._v(" 进行开启（开启状态为打开）。如下图所示：")]),t._v(" "),s("p",[s("img",{attrs:{src:"/img/%E6%94%AF%E4%BB%98%E6%89%8B%E5%86%8C/%E9%92%B1%E5%8C%85/%E9%92%B1%E5%8C%85%E5%85%85%E5%80%BC%E5%BC%80%E5%90%AF.png",alt:"钱包充值开启"}})]),t._v(" "),s("p",[t._v("一般情况下，需要将钱包的支付宝、微信等支付渠道也进行配置。这里，我们为了演示方便，直接使用上图的“模拟支付”。")]),t._v(" "),s("p",[t._v("另外，钱包也有对应的的支付、退款回调地址，如下图所示：")]),t._v(" "),s("p",[s("img",{attrs:{src:"/img/%E6%94%AF%E4%BB%98%E6%89%8B%E5%86%8C/%E9%92%B1%E5%8C%85/%E9%92%B1%E5%8C%85%E5%85%85%E5%80%BC%E5%9B%9E%E8%B0%83.png",alt:"钱包充值回调"}})]),t._v(" "),s("ul",[s("li",[t._v("支付回调地址：由 PayWalletRechargeController 的 "),s("a",{attrs:{href:"https://github.com/YunaiV/ruoyi-vue-pro/blob/master/yudao-module-pay/yudao-module-pay-biz/src/main/java/cn/iocoder/yudao/module/pay/controller/admin/wallet/PayWalletRechargeController.java#L31-L38",target:"_blank",rel:"noopener noreferrer"}},[s("code",[t._v("#updateWalletRechargerPaid(...)")]),s("OutboundLink")],1),t._v(" 方法实现")]),t._v(" "),s("li",[t._v("退款回调地址：由 PayWalletRefundController 的 "),s("a",{attrs:{href:"https://github.com/YunaiV/ruoyi-vue-pro/blob/master/yudao-module-pay/yudao-module-pay-biz/src/main/java/cn/iocoder/yudao/module/pay/controller/admin/wallet/PayWalletRechargeController.java#L49-L56",target:"_blank",rel:"noopener noreferrer"}},[s("code",[t._v("#updateWalletRechargeRefunded(...)")]),s("OutboundLink")],1),t._v(" 方法实现")])]),t._v(" "),s("div",{staticClass:"custom-block tip"},[s("p",{staticClass:"custom-block-title"},[t._v("友情提示：上述两个回调地址的逻辑，可以等后续再看，不影响充值流程的理解。")])]),t._v(" "),s("p",[t._v("② 在商城 uni-app 端，访问 "),s("a",{attrs:{href:"http://127.0.0.1:3000/pages/pay/recharge",target:"_blank",rel:"noopener noreferrer"}},[t._v("http://127.0.0.1:3000/pages/pay/recharge"),s("OutboundLink")],1),t._v(" 地址，进入 [充值] 界面，对应 <yudao-mall-uniapp/pages/pay/recharge.vue> 界面。如下图所示：")]),t._v(" "),s("p",[s("img",{attrs:{src:"/img/%E6%94%AF%E4%BB%98%E6%89%8B%E5%86%8C/%E9%92%B1%E5%8C%85/%E9%92%B1%E5%8C%85%E5%85%85%E5%80%BC%E5%8F%91%E8%B5%B7.png",alt:"钱包充值发起"}})]),t._v(" "),s("p",[t._v("随便选择一个充值套餐，或者你想充值的金额，然后点击 [确认充值] 按钮，进入支付界面。")]),t._v(" "),s("p",[t._v("选择“模拟支付”，完成支付后，可点击“查看订单”按钮，跳转到 [充值记录] 界面，对应 <yudao-mall-uniapp/pages/pay/recharge-log.vue> 界面。如下图所示：")]),t._v(" "),s("p",[s("img",{attrs:{src:"/img/%E6%94%AF%E4%BB%98%E6%89%8B%E5%86%8C/%E9%92%B1%E5%8C%85/%E5%85%85%E5%80%BC%E8%AE%B0%E5%BD%95.png",alt:"充值记录"}})]),t._v(" "),s("h2",{attrs:{id:"_3-钱包支付与退款"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_3-钱包支付与退款"}},[t._v("#")]),t._v(" 3. 钱包支付与退款")]),t._v(" "),s("p",[t._v("从本质上来说，钱包支付和支付宝、微信支付一样，可以认为是一个支付渠道。因此，我们定义了 "),s("a",{attrs:{href:"https://github.com/YunaiV/ruoyi-vue-pro/blob/master/yudao-module-pay/yudao-module-pay-biz/src/main/java/cn/iocoder/yudao/module/pay/framework/pay/core/WalletPayClient.java",target:"_blank",rel:"noopener noreferrer"}},[t._v("WalletPayClient"),s("OutboundLink")],1),t._v(" 客户端，实现了钱包的支付与退款。")]),t._v(" "),s("p",[t._v("这样，在每个业务想要使用钱包支付时，就可以在它的支付应用上，开启钱包支付即可。例如说，我们只需要把“商城”的支付应用开启，就可以使用钱包支付了。如下图所示：")]),t._v(" "),s("p",[s("img",{attrs:{src:"/img/%E6%94%AF%E4%BB%98%E6%89%8B%E5%86%8C/%E9%92%B1%E5%8C%85/%E9%92%B1%E5%8C%85%E6%94%AF%E4%BB%98.png",alt:"钱包支付"}})]),t._v(" "),s("h3",{attrs:{id:"_3-1-钱包支付"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_3-1-钱包支付"}},[t._v("#")]),t._v(" 3.1 钱包支付")]),t._v(" "),s("p",[t._v("在商城 uni-app 收银台，选择“余额支付”时，内部会调用 WalletPayClient 的 "),s("code",[t._v("#doUnifiedOrder(...)")]),t._v(" 方法，发起支付。")]),t._v(" "),s("p",[s("img",{attrs:{src:"/img/%E6%94%AF%E4%BB%98%E6%89%8B%E5%86%8C/%E9%92%B1%E5%8C%85/%E9%92%B1%E5%8C%85%E6%94%AF%E4%BB%982.png",alt:"钱包支付2"}})]),t._v(" "),s("p",[t._v("它的整体流程和 "),s("a",{attrs:{href:"/pay/alipay-pay-demo"}},[t._v("《支付宝支付接入》")]),t._v(" 是一致的。")]),t._v(" "),s("h3",{attrs:{id:"_3-2-钱包退款"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_3-2-钱包退款"}},[t._v("#")]),t._v(" 3.2 钱包退款")]),t._v(" "),s("p",[t._v("钱包支付后，如果发起退款，则会退回到钱包中，内部会调用 WalletRefundClient 的 "),s("code",[t._v("#doUnifiedRefund(...)")]),t._v(" 方法，发起退款。")]),t._v(" "),s("p",[t._v("它的整体流程和 "),s("a",{attrs:{href:"/pay/refund-demo"}},[t._v("《支付宝、微信退款接入》")]),t._v(" 是一致的。")])])}),[],!1,null,null,null);s.default=n.exports}}]);