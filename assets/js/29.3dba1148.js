(window.webpackJsonp=window.webpackJsonp||[]).push([[29],{358:function(t,s,a){"use strict";a.r(s);var n=a(7),e=Object(n.a)({},(function(){var t=this,s=t._self._c;return s("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[s("p",[t._v("数据权限，实现指定用户可以操作"),s("strong",[t._v("指定范围")]),t._v("的数据。例如说，针对员工信息的数据权限：")]),t._v(" "),s("table",[s("thead",[s("tr",[s("th",[t._v("用户")]),t._v(" "),s("th",[t._v("数据范围")])])]),t._v(" "),s("tbody",[s("tr",[s("td",[t._v("普通员工")]),t._v(" "),s("td",[t._v("自己")])]),t._v(" "),s("tr",[s("td",[t._v("部门领导")]),t._v(" "),s("td",[t._v("所属部门的所有员工")])]),t._v(" "),s("tr",[s("td",[t._v("HR 小姐姐")]),t._v(" "),s("td",[t._v("整个公司的所有员工")])])])]),t._v(" "),s("p",[t._v("上述的这个示例，使用硬编码是可以实现的，并且也非常简单。但是，在业务快速迭代的过程中，类似这种数据需求会越来越多，如果全部采用硬编码的方式，无疑会给我们带来非常大的开发与维护成本。")]),t._v(" "),s("p",[t._v("因此，项目提供 "),s("a",{attrs:{href:"https://github.com/YunaiV/ruoyi-vue-pro/blob/master/yudao-framework/yudao-spring-boot-starter-biz-data-permission/",target:"_blank",rel:"noopener noreferrer"}},[s("code",[t._v("yudao-spring-boot-starter-biz-data-permission")]),s("OutboundLink")],1),t._v(" 技术组件，只需要少量的编码，无需入侵到业务代码，即可实现数据权限。")]),t._v(" "),s("div",{staticClass:"custom-block tip"},[s("p",{staticClass:"custom-block-title"},[t._v("友情提示：数据权限是否支持指定用户只能查看数据的某些字段？")]),t._v(" "),s("p",[t._v("不支持。权限可以分成三类：功能权限、数据权限、字段权限。")]),t._v(" "),s("p",[t._v("字段权限的控制，不属于数据权限，而是属于字段权限，会在未来提供，敬请期待。")]),t._v(" "),s("p",[t._v("目前可以通过 "),s("a",{attrs:{href:"/desensitize"}},[t._v("《数据脱敏》")]),t._v(" 实现一定的字段权限。")])]),t._v(" "),s("h2",{attrs:{id:"_1-实现原理"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_1-实现原理"}},[t._v("#")]),t._v(" 1. 实现原理")]),t._v(" "),s("p",[s("code",[t._v("yudao-spring-boot-starter-biz-data-permission")]),t._v(" 技术组件的实现原理非常简单，每次对数据库操作时，他会"),s("strong",[t._v("自动")]),t._v("拼接 "),s("code",[t._v("WHERE data_column = ?")]),t._v(" 条件来进行数据的过滤。")]),t._v(" "),s("p",[t._v("例如说，查看员工信息的功能，对应 SQL 是 "),s("code",[t._v("SELECT * FROM system_users")]),t._v("，那么拼接后的 SQL 结果会是：")]),t._v(" "),s("table",[s("thead",[s("tr",[s("th",[t._v("用户")]),t._v(" "),s("th",[t._v("数据范围")]),t._v(" "),s("th",[t._v("SQL")])])]),t._v(" "),s("tbody",[s("tr",[s("td",[t._v("普通员工")]),t._v(" "),s("td",[t._v("自己")]),t._v(" "),s("td",[s("code",[t._v("SELECT * FROM system_users WHERE id = 自己")])])]),t._v(" "),s("tr",[s("td",[t._v("部门领导")]),t._v(" "),s("td",[t._v("所属部门的所有员工")]),t._v(" "),s("td",[s("code",[t._v("SELECT * FROM system_users WHERE dept_id = 自己的部门")])])]),t._v(" "),s("tr",[s("td",[t._v("HR 小姐姐")]),t._v(" "),s("td",[t._v("整个公司的所有员工")]),t._v(" "),s("td",[s("code",[t._v("SELECT * FROM system_users")]),t._v(" "),s("strong",[t._v("无需拼接")])])])])]),t._v(" "),s("p",[t._v("明白了实现原理之后，想要进一步加入理解，后续可以找时间 Debug 调试下 MyBatis Plus 的 DataPermissionInterceptor 类的这三个方法：")]),t._v(" "),s("ul",[s("li",[s("code",[t._v("#processSelect(...)")]),t._v(" 方法：处理 SELECT 语句的 WHERE 条件。")]),t._v(" "),s("li",[s("code",[t._v("#processUpdate(...)")]),t._v(" 方法：处理 UPDATE 语句的 WHERE 条件。")]),t._v(" "),s("li",[s("code",[t._v("#processDelete(...)")]),t._v(" 方法：处理 DELETE 语句的 WHERE 条件。")])]),t._v(" "),s("p",[t._v("主要还是基于 MyBatis Plus 的 "),s("a",{attrs:{href:"https://baomidou.com/plugins/data-permission/",target:"_blank",rel:"noopener noreferrer"}},[t._v("数据权限插件"),s("OutboundLink")],1),t._v("。")]),t._v(" "),s("p",[t._v("具体的条件生成，可见项目的 DataPermissionRuleHandler 类。")]),t._v(" "),s("div",{staticClass:"custom-block tip"},[s("p",{staticClass:"custom-block-title"},[t._v("友情提示：MyBatis Plus 的数据权限方案，在我们在 MyBatis XML 手写 SQL 时，是不生效的，即不会拼接 `WHERE` 数据权限条件！！！")])]),t._v(" "),s("h2",{attrs:{id:"_2-基于部门的数据权限"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_2-基于部门的数据权限"}},[t._v("#")]),t._v(" 2. 基于部门的数据权限")]),t._v(" "),s("p",[t._v("项目"),s("strong",[t._v("内置")]),t._v("了基于部门的数据权限，支持 5 种数据范围：")]),t._v(" "),s("ol",[s("li",[t._v("全部数据权限：无数据权限的限制。")]),t._v(" "),s("li",[t._v("指定部门数据权限：根据实际需要，设置可操作的部门。")]),t._v(" "),s("li",[t._v("本部门数据权限：只能操作用户所在的部门。")]),t._v(" "),s("li",[t._v("本部门及以下数据权限：在【本部门数据权限】的基础上，额外可操作子部门。")]),t._v(" "),s("li",[t._v("仅本人数据权限："),s("strong",[t._v("相对特殊")]),t._v("，只能操作自己的数据。")])]),t._v(" "),s("h3",{attrs:{id:"_2-1-后台配置"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_2-1-后台配置"}},[t._v("#")]),t._v(" 2.1 后台配置")]),t._v(" "),s("p",[t._v("可通过管理后台的 [系统管理 -> 角色管理] 菜单，设置用户角色的数据权限。")]),t._v(" "),s("p",[s("img",{attrs:{src:"/img/%E6%95%B0%E6%8D%AE%E6%9D%83%E9%99%90/01.png",alt:"角色管理"}})]),t._v(" "),s("div",{staticClass:"custom-block tip"},[s("p",{staticClass:"custom-block-title"},[t._v("实现代码？")]),t._v(" "),s("p",[t._v("可见 "),s("a",{attrs:{href:"https://github.com/YunaiV/ruoyi-vue-pro/blob/master/yudao-framework/yudao-spring-boot-starter-biz-data-permission/src/main/java/cn/iocoder/yudao/framework/datapermission/core/dept/rule/DeptDataPermissionRule.java",target:"_blank",rel:"noopener noreferrer"}},[t._v("DeptDataPermissionRule"),s("OutboundLink")],1),t._v(" 数据权限规则。")])]),t._v(" "),s("h3",{attrs:{id:"_2-2-字段配置"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_2-2-字段配置"}},[t._v("#")]),t._v(" 2.2 字段配置")]),t._v(" "),s("p",[t._v("每个 Maven Module， 通过自定义 "),s("a",{attrs:{href:"https://github.com/YunaiV/ruoyi-vue-pro/blob/master/yudao-framework/yudao-spring-boot-starter-biz-data-permission/src/main/java/cn/iocoder/yudao/framework/datapermission/core/dept/rule/DeptDataPermissionRuleCustomizer.java",target:"_blank",rel:"noopener noreferrer"}},[t._v("DeptDataPermissionRuleCustomizer"),s("OutboundLink")],1),t._v(" Bean，配置哪些表的哪些字段，进行数据权限的过滤。以 "),s("code",[t._v("yudao-module-system")]),t._v(" 模块来举例子，代码如下：")]),t._v(" "),s("div",{staticClass:"language-Java extra-class"},[s("pre",{pre:!0,attrs:{class:"language-java"}},[s("code",[s("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[t._v("@Configuration")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("proxyBeanMethods "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("false")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("public")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("class")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("DataPermissionConfiguration")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n\n    "),s("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[t._v("@Bean")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("public")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("DeptDataPermissionRuleCustomizer")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("sysDeptDataPermissionRuleCustomizer")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" rule "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("->")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n            "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// dept 基于部门的数据权限")]),t._v("\n            rule"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("addDeptColumn")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("AdminUserDO")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("class")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// WHERE dept_id = ?")]),t._v("\n            rule"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("addDeptColumn")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("DeptDO")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("class")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"id"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// WHERE id = ?")]),t._v("\n            \n            "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// user 基于用户的数据权限")]),t._v("\n            rule"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("addUserColumn")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("AdminUserDO")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("class")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"id"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// WHERE id = ?")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//            rule.addUserColumn(OrderDO.class); // WHERE user_id = ?")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),s("p",[s("strong",[t._v("注意")]),t._v("，数据库的表字段必须添加：")]),t._v(" "),s("ul",[s("li",[t._v("基于【部门】过滤数据权限的表，需要添加部门编号字段，例如说 "),s("code",[t._v("dept_id")]),t._v(" 字段。")]),t._v(" "),s("li",[t._v("基于【用户】过滤数据权限的表，需要添加部门用户字段，例如说 "),s("code",[t._v("user_id")]),t._v(" 字段。")])]),t._v(" "),s("h2",{attrs:{id:"_3-datapermission-注解"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_3-datapermission-注解"}},[t._v("#")]),t._v(" 3. @DataPermission 注解")]),t._v(" "),s("p",[s("a",{attrs:{href:"https://github.com/YunaiV/ruoyi-vue-pro/blob/master/yudao-framework/yudao-spring-boot-starter-biz-data-permission/src/main/java/cn/iocoder/yudao/framework/datapermission/core/annotation/DataPermission.java",target:"_blank",rel:"noopener noreferrer"}},[s("code",[t._v("@DataPermission")]),s("OutboundLink")],1),t._v(" 数据权限注解，可声明在类或者方法上，配置使用的数据权限规则。")]),t._v(" "),s("p",[t._v("① "),s("code",[t._v("enable")]),t._v(" 属性：当前类或方法是否开启数据权限，默认是 "),s("code",[t._v("true")]),t._v(" 开启状态，可设置 "),s("code",[t._v("false")]),t._v(" 禁用状态。")]),t._v(" "),s("p",[s("strong",[t._v("也就是说，数据权限默认是开启的，无需添加 "),s("code",[t._v("@DataPermission")]),t._v(" 注解")]),s("br"),t._v(" "),s("strong",[t._v("也就是说，数据权限默认是开启的，无需添加 "),s("code",[t._v("@DataPermission")]),t._v(" 注解")]),s("br"),t._v(" "),s("strong",[t._v("也就是说，数据权限默认是开启的，无需添加 "),s("code",[t._v("@DataPermission")]),t._v(" 注解")])]),t._v(" "),s("p",[t._v("使用示例如下，可见 "),s("a",{attrs:{href:"https://github.com/YunaiV/ruoyi-vue-pro/blob/master/yudao-module-system/yudao-module-system-biz/src/main/java/cn/iocoder/yudao/module/system/controller/admin/user/UserProfileController.java#L59-L82",target:"_blank",rel:"noopener noreferrer"}},[t._v("UserProfileController"),s("OutboundLink")],1),t._v(" 类：")]),t._v(" "),s("div",{staticClass:"language-Java extra-class"},[s("pre",{pre:!0,attrs:{class:"language-java"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// UserProfileController.java")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[t._v("@GetMapping")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"/get"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[t._v("@Operation")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("summary "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"获得登录用户信息"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[t._v("@DataPermission")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("enable "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("false")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 关闭数据权限，避免只查看自己时，查询不到部门。")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("public")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("CommonResult")]),s("span",{pre:!0,attrs:{class:"token generics"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("UserProfileRespVO")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("profile")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// .. 省略代码")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("user"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("getDeptId")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("!=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("null")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("DeptDO")]),t._v(" dept "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" deptService"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("getDept")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("user"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("getDeptId")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        resp"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("setDept")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("UserConvert")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token constant"}},[t._v("INSTANCE")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("convert02")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("dept"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// .. 省略代码")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),s("p",[t._v("② "),s("code",[t._v("includeRules")]),t._v(" 属性，配置生效的 "),s("a",{attrs:{href:"https://github.com/YunaiV/ruoyi-vue-pro/blob/master/yudao-framework/yudao-spring-boot-starter-biz-data-permission/src/main/java/cn/iocoder/yudao/framework/datapermission/core/rule/DataPermissionRule.java",target:"_blank",rel:"noopener noreferrer"}},[t._v("DataPermissionRule"),s("OutboundLink")],1),t._v(" 数据权限规则。例如说，项目里有 10 种 DataPermissionRule 规则，某个方法"),s("strong",[t._v("只想")]),t._v("其中的 1 种生效，则可以使用该属性。")]),t._v(" "),s("p",[t._v("③ "),s("code",[t._v("excludeRules")]),t._v(" 属性，配置排除的 "),s("a",{attrs:{href:"https://github.com/YunaiV/ruoyi-vue-pro/blob/master/yudao-framework/yudao-spring-boot-starter-biz-data-permission/src/main/java/cn/iocoder/yudao/framework/datapermission/core/rule/DataPermissionRule.java",target:"_blank",rel:"noopener noreferrer"}},[t._v("DataPermissionRule"),s("OutboundLink")],1),t._v(" 数据权限规则。例如说，项目里有 10 种 DataPermissionRule 规则，某个方法"),s("strong",[t._v("不想")]),t._v("其中的 1 种生效，则可以使用该属性。")]),t._v(" "),s("h2",{attrs:{id:"_4-自定义的数据权限规则"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_4-自定义的数据权限规则"}},[t._v("#")]),t._v(" 4. 自定义的数据权限规则")]),t._v(" "),s("p",[t._v("如果想要自定义数据权限规则，只需要实现 "),s("a",{attrs:{href:"https://github.com/YunaiV/ruoyi-vue-pro/blob/master/yudao-framework/yudao-spring-boot-starter-biz-data-permission/src/main/java/cn/iocoder/yudao/framework/datapermission/core/rule/DataPermissionRule.java",target:"_blank",rel:"noopener noreferrer"}},[t._v("DataPermissionRule"),s("OutboundLink")],1),t._v(" 数据权限规则接口，并声明成 Spring Bean 即可。需要实现的只有两个方法：")]),t._v(" "),s("div",{staticClass:"language-Java extra-class"},[s("pre",{pre:!0,attrs:{class:"language-java"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("public")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("interface")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("DataPermissionRule")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n\n    "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("/**\n     * 返回需要生效的表名数组\n     * 为什么需要该方法？Data Permission 数组基于 SQL 重写，通过 Where 返回只有权限的数据\n     *\n     * 如果需要基于实体名获得表名，可调用 {@link TableInfoHelper#getTableInfo(Class)} 获得\n     *\n     * @return 表名数组\n     */")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Set")]),s("span",{pre:!0,attrs:{class:"token generics"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("String")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("getTableNames")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n    "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("/**\n     * 根据表名和别名，生成对应的 WHERE / OR 过滤条件\n     *\n     * @param tableName 表名\n     * @param tableAlias 别名，可能为空\n     * @return 过滤条件 Expression 表达式\n     */")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Expression")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("getExpression")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("String")]),t._v(" tableName"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Alias")]),t._v(" tableAlias"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),s("ul",[s("li",[s("code",[t._v("#getTableNames()")]),t._v(" 方法："),s("strong",[t._v("哪些数据库表")]),t._v("，需要使用该数据权限规则。")]),t._v(" "),s("li",[s("code",[t._v("#getExpression(...)")]),t._v(" 方法：当操作这些数据库表，需要额外拼接"),s("strong",[t._v("怎么样的 WHERE 条件")]),t._v("。")])]),t._v(" "),s("p",[t._v("下面，艿艿带你写个自定义数据权限规则的示例，它的数据权限规则是：")]),t._v(" "),s("ul",[s("li",[t._v("针对 "),s("code",[t._v("system_dict_type")]),t._v(" 表，它的创建人 "),s("code",[t._v("creator")]),t._v(" 要是当前用户。")]),t._v(" "),s("li",[t._v("针对 "),s("code",[t._v("system_post")]),t._v(" 表，它的更新人 "),s("code",[t._v("updater")]),t._v(" 要是当前用户。")])]),t._v(" "),s("p",[t._v("具体实现代码如下：")]),t._v(" "),s("div",{staticClass:"language-Java extra-class"},[s("pre",{pre:!0,attrs:{class:"language-java"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("package")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token namespace"}},[t._v("cn"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("iocoder"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("yudao"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("module"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("system"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("framework"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("datapermission")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token import"}},[s("span",{pre:!0,attrs:{class:"token namespace"}},[t._v("cn"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("iocoder"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("yudao"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("framework"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("datapermission"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("core"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("rule"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")])]),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("DataPermissionRule")])]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token import"}},[s("span",{pre:!0,attrs:{class:"token namespace"}},[t._v("cn"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("iocoder"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("yudao"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("framework"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("mybatis"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("core"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("util"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")])]),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("MyBatisUtils")])]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token import"}},[s("span",{pre:!0,attrs:{class:"token namespace"}},[t._v("cn"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("iocoder"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("yudao"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("framework"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("security"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("core"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("util"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")])]),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("SecurityFrameworkUtils")])]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token import"}},[s("span",{pre:!0,attrs:{class:"token namespace"}},[t._v("com"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("google"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("common"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("collect"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")])]),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Sets")])]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token import"}},[s("span",{pre:!0,attrs:{class:"token namespace"}},[t._v("net"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("sf"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("jsqlparser"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("expression"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")])]),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Alias")])]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token import"}},[s("span",{pre:!0,attrs:{class:"token namespace"}},[t._v("net"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("sf"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("jsqlparser"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("expression"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")])]),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Expression")])]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token import"}},[s("span",{pre:!0,attrs:{class:"token namespace"}},[t._v("net"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("sf"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("jsqlparser"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("expression"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")])]),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("LongValue")])]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token import"}},[s("span",{pre:!0,attrs:{class:"token namespace"}},[t._v("net"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("sf"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("jsqlparser"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("expression"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("operators"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("relational"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")])]),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("EqualsTo")])]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token import"}},[s("span",{pre:!0,attrs:{class:"token namespace"}},[t._v("org"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("springframework"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("stereotype"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")])]),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Component")])]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token import"}},[s("span",{pre:!0,attrs:{class:"token namespace"}},[t._v("java"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("util"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")])]),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Set")])]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[t._v("@Component")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 声明为 Spring Bean，保证被 yudao-spring-boot-starter-biz-data-permission 组件扫描到")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("public")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("class")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("DemoDataPermissionRule")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("implements")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("DataPermissionRule")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n\n    "),s("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[t._v("@Override")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("public")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Set")]),s("span",{pre:!0,attrs:{class:"token generics"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("String")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("getTableNames")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Sets")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("newHashSet")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"system_dict_type"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"system_post"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n    "),s("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[t._v("@Override")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("public")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Expression")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("getExpression")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("String")]),t._v(" tableName"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Alias")]),t._v(" tableAlias"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Long")]),t._v(" userId "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("SecurityFrameworkUtils")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("getLoginUserId")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("assert")]),t._v(" userId "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("!=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("null")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("switch")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("tableName"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n            "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("case")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"system_dict_type"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v("\n                "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("EqualsTo")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("MyBatisUtils")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("buildColumn")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("tableName"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" tableAlias"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"creator"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("LongValue")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("userId"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n            "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("case")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"system_post"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v("\n                "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("EqualsTo")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("MyBatisUtils")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("buildColumn")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("tableName"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" tableAlias"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"updater"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("LongValue")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("userId"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n            "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("default")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("null")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),s("p",[t._v("① 启动前端 + 后端项目。")]),t._v(" "),s("p",[t._v("② 访问 [系统管理 -> 字典管理] 菜单，查看 IDEA 控制台，可以看到 "),s("code",[t._v("system_dict_type")]),t._v(" 表的查询自动拼接了 "),s("code",[t._v("AND creator = 1")]),t._v(" 的查询条件。")]),t._v(" "),s("p",[s("img",{attrs:{src:"/img/%E6%95%B0%E6%8D%AE%E6%9D%83%E9%99%90/02.png",alt:"字典管理"}})]),t._v(" "),s("p",[t._v("② 访问 [系统管理 -> 岗位管理] 菜单，查看 IDEA 控制台，可以看到 "),s("code",[t._v("system_post")]),t._v(" 表的查询自动拼接了 "),s("code",[t._v("AND updater = 1")]),t._v(" 的查询条件。")]),t._v(" "),s("p",[s("img",{attrs:{src:"/img/%E6%95%B0%E6%8D%AE%E6%9D%83%E9%99%90/03.png",alt:"字典管理"}})]),t._v(" "),s("h2",{attrs:{id:"_5-如何忽略数据权限"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_5-如何忽略数据权限"}},[t._v("#")]),t._v(" 5. 如何忽略数据权限")]),t._v(" "),s("p",[t._v("可以使用 DataPermissionUtils 的 "),s("code",[t._v("#executeIgnore(...)")]),t._v(" 方法，设置忽略数据权限。")]),t._v(" "),s("p",[t._v("具体的案例，可以通过 IDEA 查找下项目里，哪些地方调用了这个方法噢！")]),t._v(" "),s("h2",{attrs:{id:"_6-社区贡献的数据权限规则"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_6-社区贡献的数据权限规则"}},[t._v("#")]),t._v(" 6. 社区贡献的数据权限规则")]),t._v(" "),s("ul",[s("li",[s("a",{attrs:{href:"https://github.com/YunaiV/ruoyi-vue-pro/issues/477",target:"_blank",rel:"noopener noreferrer"}},[t._v("数据权限组件改进建议：改成更通用的，取消内置的部门数据权限"),s("OutboundLink")],1)]),t._v(" "),s("li",[s("a",{attrs:{href:"https://gitee.com/zhijiantianya/ruoyi-vue-pro/pulls/1158",target:"_blank",rel:"noopener noreferrer"}},[t._v("推荐：通用的数据权限的具体实现及示例说明"),s("OutboundLink")],1)])])])}),[],!1,null,null,null);s.default=e.exports}}]);