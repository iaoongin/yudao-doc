(window.webpackJsonp=window.webpackJsonp||[]).push([[42],{371:function(e,o,r){"use strict";r.r(o);var a=r(7),t=Object(a.a)({},(function(){var e=this,o=e._self._c;return o("ContentSlotsDistributor",{attrs:{"slot-key":e.$parent.slotKey}},[o("p",[e._v("项目提供 2 类 4 种系统日志：")]),e._v(" "),o("ul",[o("li",[e._v("审计日志：用户的操作日志、登录日志")]),e._v(" "),o("li",[e._v("API 日志：RESTful API 的访问日志、错误日志")])]),e._v(" "),o("h2",{attrs:{id:"_1-操作日志"}},[o("a",{staticClass:"header-anchor",attrs:{href:"#_1-操作日志"}},[e._v("#")]),e._v(" 1. 操作日志")]),e._v(" "),o("p",[e._v("操作日志，记录「谁」在「什么时间」对「什么对象」做了「什么事情」。")]),e._v(" "),o("p",[e._v("打开 [系统管理 -> 审计日志 -> 操作日志] 菜单，可以看到对应的列表，如下图所示：")]),e._v(" "),o("p",[o("img",{attrs:{src:"/img/%E5%90%8E%E7%AB%AF%E6%89%8B%E5%86%8C/%E7%B3%BB%E7%BB%9F%E6%97%A5%E5%BF%97/%E6%93%8D%E4%BD%9C%E6%97%A5%E5%BF%97.png",alt:"操作日志"}})]),e._v(" "),o("h3",{attrs:{id:"_1-1-操作日志组件"}},[o("a",{staticClass:"header-anchor",attrs:{href:"#_1-1-操作日志组件"}},[e._v("#")]),e._v(" 1.1 操作日志组件")]),e._v(" "),o("p",[e._v("① 操作日志的记录，由 "),o("a",{attrs:{href:"https://github.com/YunaiV/ruoyi-vue-pro/blob/master/yudao-framework/yudao-spring-boot-starter-security/",target:"_blank",rel:"noopener noreferrer"}},[o("code",[e._v("yudao-spring-boot-starter-security")]),o("OutboundLink")],1),e._v(" 技术组件的 "),o("code",[e._v("operatelog")]),e._v(" 包提供，基于我老友开源的 "),o("a",{attrs:{href:"https://github.com/mouzt/mzt-biz-log",target:"_blank",rel:"noopener noreferrer"}},[e._v("https://github.com/mouzt/mzt-biz-log"),o("OutboundLink")],1),e._v(" 实现，只需要添加 "),o("code",[e._v("@LogRecord")]),e._v(" 注解，即可实现操作日志的记录。")]),e._v(" "),o("p",[o("img",{attrs:{src:"/img/%E5%90%8E%E7%AB%AF%E6%89%8B%E5%86%8C/%E7%B3%BB%E7%BB%9F%E6%97%A5%E5%BF%97/%E7%89%9B%E7%9A%AE%E7%9A%84%E6%93%8D%E4%BD%9C%E6%97%A5%E5%BF%97%E7%A4%BA%E4%BE%8B.png",alt:"牛皮的操作日志示例"}})]),e._v(" "),o("ul",[o("li",[e._v("【新增】2021-09-16 10:00 订单创建，订单号：NO.11089999，其中涉及变量订单号 “NO.11089999”")]),e._v(" "),o("li",[e._v("【修改】2021-09-16 10:00 用户小明修改了订单的配送地址：从 “金灿灿小区” 修改到 “银盏盏小区”")])]),e._v(" "),o("div",{staticClass:"custom-block tip"},[o("p",{staticClass:"custom-block-title"},[e._v("疑问：为什么不独立一个 `yudao-spring-boot-starter-operatelog` 组件呢？")]),e._v(" "),o("p",[e._v("早期，项目确实有 "),o("code",[e._v("operatelog")]),e._v(" 组件，和 "),o("code",[e._v("mzt-biz-log")]),e._v(" 组件一样，也是基于 Spring AOP + 注解实现。")]),e._v(" "),o("p",[e._v("随着我老友开源了 "),o("code",[e._v("mzt-biz-log")]),e._v(" 组件，再加上希望减少项目的 starter 数量，所以决定直接使用 "),o("code",[e._v("mzt-biz-log")]),e._v(" 组件，放到 "),o("code",[e._v("security")]),e._v(" 组件中，而不是自己再造一个轮子。")])]),e._v(" "),o("p",[e._v("② 操作日志的存储，由 "),o("code",[e._v("yudao-module-system")]),e._v(" 的 "),o("a",{attrs:{href:"https://github.com/YunaiV/ruoyi-vue-pro/blob/master/yudao-module-system/yudao-module-system-biz/src/main/java/cn/iocoder/yudao/module/system/service/logger/OperateLogServiceImpl.java",target:"_blank",rel:"noopener noreferrer"}},[e._v("OperateLog"),o("OutboundLink")],1),e._v(" 模块实现，记录到数据库的 "),o("a",{attrs:{href:"https://github.com/YunaiV/ruoyi-vue-pro/blob/master/yudao-module-system/yudao-module-system-biz/src/main/java/cn/iocoder/yudao/module/system/dal/dataobject/logger/OperateLogDO.java",target:"_blank",rel:"noopener noreferrer"}},[o("code",[e._v("system_operate_log")]),o("OutboundLink")],1),e._v(" 表。")]),e._v(" "),o("hr"),e._v(" "),o("p",[e._v("下面，我们来看项目中的几个使用案例。在开始之前，希望你先简单通读下 "),o("a",{attrs:{href:"https://github.com/mouzt/mzt-biz-log/blob/master/readme.md",target:"_blank",rel:"noopener noreferrer"}},[e._v("《mzt-biz-log 使用指南》"),o("OutboundLink")],1),e._v(" 文档。")]),e._v(" "),o("h3",{attrs:{id:"_1-2-场景一-创建用户"}},[o("a",{staticClass:"header-anchor",attrs:{href:"#_1-2-场景一-创建用户"}},[e._v("#")]),e._v(" 1.2 场景一：创建用户")]),e._v(" "),o("p",[e._v("① 在 "),o("a",{attrs:{href:"https://github.com/YunaiV/ruoyi-vue-pro/blob/master/yudao-module-system/yudao-module-system-api/src/main/java/cn/iocoder/yudao/module/system/enums/LogRecordConstants.java",target:"_blank",rel:"noopener noreferrer"}},[e._v("LogRecordConstants"),o("OutboundLink")],1),e._v(" 类中，定义 "),o("code",[e._v("SYSTEM_USER_CREATE_SUB_TYPE")]),e._v("、"),o("code",[e._v("SYSTEM_USER_CREATE_SUCCESS")]),e._v(" 变量。如下图所示：")]),e._v(" "),o("p",[o("img",{attrs:{src:"/img/%E5%90%8E%E7%AB%AF%E6%89%8B%E5%86%8C/%E7%B3%BB%E7%BB%9F%E6%97%A5%E5%BF%97/%E5%88%9B%E5%BB%BA%E7%94%A8%E6%88%B701.png",alt:"LogRecordConstants"}})]),e._v(" "),o("div",{staticClass:"custom-block tip"},[o("p",{staticClass:"custom-block-title"},[e._v("疑问：为什么要在 LogRecordConstants 定义？")]),e._v(" "),o("p",[e._v("这个并非强制，只是一个使用建议。每个 "),o("code",[e._v("yudao-module-xxx")]),e._v(" 模块下，建议都搞一个 LogRecordConstants 类，方便大家统一管理操作日志的常量，这样方便大家查找。")])]),e._v(" "),o("p",[e._v("② 在 Service 方法上，添加 "),o("code",[e._v("@LogRecord")]),e._v(" 注解，如下图所示：")]),e._v(" "),o("p",[o("img",{attrs:{src:"/img/%E5%90%8E%E7%AB%AF%E6%89%8B%E5%86%8C/%E7%B3%BB%E7%BB%9F%E6%97%A5%E5%BF%97/%E5%88%9B%E5%BB%BA%E7%94%A8%E6%88%B702.png",alt:"创建用户"}})]),e._v(" "),o("p",[e._v("最终，我们记录操作日志的内容，如下图所示：")]),e._v(" "),o("p",[o("img",{attrs:{src:"/img/%E5%90%8E%E7%AB%AF%E6%89%8B%E5%86%8C/%E7%B3%BB%E7%BB%9F%E6%97%A5%E5%BF%97/%E5%88%9B%E5%BB%BA%E7%94%A8%E6%88%B703.png",alt:"操作日志"}})]),e._v(" "),o("h3",{attrs:{id:"_1-3-场景二-修改用户信息"}},[o("a",{staticClass:"header-anchor",attrs:{href:"#_1-3-场景二-修改用户信息"}},[e._v("#")]),e._v(" 1.3 场景二：修改用户信息")]),e._v(" "),o("p",[e._v("① 在 "),o("a",{attrs:{href:"https://github.com/YunaiV/ruoyi-vue-pro/blob/master/yudao-module-system/yudao-module-system-api/src/main/java/cn/iocoder/yudao/module/system/enums/LogRecordConstants.java",target:"_blank",rel:"noopener noreferrer"}},[e._v("LogRecordConstants"),o("OutboundLink")],1),e._v(" 类中，定义 "),o("code",[e._v("SYSTEM_USER_UPDATE_SUB_TYPE")]),e._v("、"),o("code",[e._v("SYSTEM_USER_UPDATE_SUCCESS")]),e._v(" 变量。如下图所示：")]),e._v(" "),o("p",[o("img",{attrs:{src:"/img/%E5%90%8E%E7%AB%AF%E6%89%8B%E5%86%8C/%E7%B3%BB%E7%BB%9F%E6%97%A5%E5%BF%97/%E4%BF%AE%E6%94%B9%E7%94%A8%E6%88%B701.png",alt:"LogRecordConstants"}})]),e._v(" "),o("p",[e._v("这里我们使用了 "),o("code",[e._v("_DIFF")]),e._v(" 函数，实现对象 diff 功能，即“【备注】从【132】修改为【1324】”。因此，我们需要在 "),o("a",{attrs:{href:"https://github.com/YunaiV/ruoyi-vue-pro/blob/master/yudao-module-system/yudao-module-system-biz/src/main/java/cn/iocoder/yudao/module/system/controller/admin/user/vo/user/UserSaveReqVO.java",target:"_blank",rel:"noopener noreferrer"}},[e._v("UserSaveReqVO"),o("OutboundLink")],1),e._v(" 类上添加 "),o("code",[e._v("@DiffLogField")]),e._v(" 注解，如下图所示：")]),e._v(" "),o("p",[o("img",{attrs:{src:"/img/%E5%90%8E%E7%AB%AF%E6%89%8B%E5%86%8C/%E7%B3%BB%E7%BB%9F%E6%97%A5%E5%BF%97/UserSaveReqVO.png",alt:"UserSaveReqVO"}})]),e._v(" "),o("ul",[o("li",[e._v("注解的 "),o("code",[e._v("name")]),e._v(" 字段：字段的中文名，例如说：“【备注】”")]),e._v(" "),o("li",[e._v("注解的 "),o("code",[e._v("function")]),e._v(" 字段：自定义函数，用于字段的值翻译，例如说："),o("a",{attrs:{href:"https://github.com/YunaiV/ruoyi-vue-pro/blob/master/yudao-module-system/yudao-module-system-biz/src/main/java/cn/iocoder/yudao/module/system/framework/operatelog/core/PostParseFunction.java",target:"_blank",rel:"noopener noreferrer"}},[e._v("PostParseFunction"),o("OutboundLink")],1),e._v(" 岗位名、"),o("a",{attrs:{href:"https://github.com/YunaiV/ruoyi-vue-pro/blob/master/yudao-module-system/yudao-module-system-biz/src/main/java/cn/iocoder/yudao/module/system/framework/operatelog/core/DeptParseFunction.java",target:"_blank",rel:"noopener noreferrer"}},[e._v("DeptParseFunction"),o("OutboundLink")],1),e._v(" 部门名、"),o("a",{attrs:{href:"https://github.com/YunaiV/ruoyi-vue-pro/blob/master/yudao-module-system/yudao-module-system-biz/src/main/java/cn/iocoder/yudao/module/system/framework/operatelog/core/SexParseFunction.java",target:"_blank",rel:"noopener noreferrer"}},[e._v("SexParseFunction"),o("OutboundLink")],1),e._v(" 性别等等")])]),e._v(" "),o("p",[e._v("② 在 Service 方法上，添加 "),o("code",[e._v("@LogRecord")]),e._v(" 注解，如下图所示：")]),e._v(" "),o("p",[o("img",{attrs:{src:"/img/%E5%90%8E%E7%AB%AF%E6%89%8B%E5%86%8C/%E7%B3%BB%E7%BB%9F%E6%97%A5%E5%BF%97/%E4%BF%AE%E6%94%B9%E7%94%A8%E6%88%B702.png",alt:"修改用户信息"}})]),e._v(" "),o("p",[e._v("最终，我们记录操作日志的内容，如下图所示：")]),e._v(" "),o("p",[o("img",{attrs:{src:"/img/%E5%90%8E%E7%AB%AF%E6%89%8B%E5%86%8C/%E7%B3%BB%E7%BB%9F%E6%97%A5%E5%BF%97/%E4%BF%AE%E6%94%B9%E7%94%A8%E6%88%B703.png",alt:"操作日志"}})]),e._v(" "),o("h3",{attrs:{id:"_1-4-更多场景"}},[o("a",{staticClass:"header-anchor",attrs:{href:"#_1-4-更多场景"}},[e._v("#")]),e._v(" 1.4 更多场景")]),e._v(" "),o("p",[e._v("由于操作日志需要手动记录，再加上是新改造的，所以目前只有少数几个地方使用了。后续，我们会逐步完善，让操作日志更加完善。")]),e._v(" "),o("p",[e._v("目前，"),o("a",{attrs:{href:"https://github.com/YunaiV/ruoyi-vue-pro/blob/master/yudao-module-crm/yudao-module-crm-api/src/main/java/cn/iocoder/yudao/module/crm/enums/LogRecordConstants.java",target:"_blank",rel:"noopener noreferrer"}},[e._v("CRM 模块的操作日志"),o("OutboundLink")],1),e._v("是最全的，应该有大几十个使用案例，大家碰到不会使用的地方，可以参考下。")]),e._v(" "),o("h2",{attrs:{id:"_2-登录日志"}},[o("a",{staticClass:"header-anchor",attrs:{href:"#_2-登录日志"}},[e._v("#")]),e._v(" 2. 登录日志")]),e._v(" "),o("p",[e._v("登录日志，记录用户的登录、登出行为，包括成功的、失败的。")]),e._v(" "),o("p",[e._v("打开 [系统管理 -> 审计日志 -> 登录日志] 菜单，可以看对应的列表，如下图所示：")]),e._v(" "),o("p",[o("img",{attrs:{src:"/img/%E7%B3%BB%E7%BB%9F%E6%97%A5%E5%BF%97/11.png",alt:"系统管理 -> 登录日志"}})]),e._v(" "),o("p",[e._v("登录日志的存储，由 "),o("code",[e._v("yudao-module-system")]),e._v(" 的 "),o("a",{attrs:{href:"https://github.com/YunaiV/ruoyi-vue-pro/blob/master/yudao-module-system/yudao-module-system-biz/src/main/java/cn/iocoder/yudao/module/system/service/logger/LoginLogServiceImpl.java",target:"_blank",rel:"noopener noreferrer"}},[e._v("LoginLog"),o("OutboundLink")],1),e._v(" 模块实现，记录到数据库的 "),o("a",{attrs:{href:"https://github.com/YunaiV/ruoyi-vue-pro/blob/master/yudao-module-system/yudao-module-system-biz/src/main/java/cn/iocoder/yudao/module/system/dal/dataobject/logger/LoginLogDO.java",target:"_blank",rel:"noopener noreferrer"}},[o("code",[e._v("system_login_log")]),o("OutboundLink")],1),e._v(" 表。")]),e._v(" "),o("p",[e._v("登录类型通过 "),o("a",{attrs:{href:"https://github.com/YunaiV/ruoyi-vue-pro/blob/master/yudao-module-system/yudao-module-system-api/src/main/java/cn/iocoder/yudao/module/system/enums/logger/LoginLogTypeEnum.java",target:"_blank",rel:"noopener noreferrer"}},[e._v("LoginLogTypeEnum"),o("OutboundLink")],1),e._v(" 枚举，登录结果通过 "),o("a",{attrs:{href:"https://github.com/YunaiV/ruoyi-vue-pro/blob/master/yudao-module-system/yudao-module-system-api/src/main/java/cn/iocoder/yudao/module/system/enums/logger/LoginResultEnum.java",target:"_blank",rel:"noopener noreferrer"}},[e._v("LoginResultEnum"),o("OutboundLink")],1),e._v(" 枚举，都可以自定义。代码如下：")]),e._v(" "),o("p",[o("img",{attrs:{src:"/img/%E7%B3%BB%E7%BB%9F%E6%97%A5%E5%BF%97/12.png",alt:"系统管理 -> 登录日志"}})]),e._v(" "),o("h2",{attrs:{id:"_3-api-访问日志"}},[o("a",{staticClass:"header-anchor",attrs:{href:"#_3-api-访问日志"}},[e._v("#")]),e._v(" 3. API 访问日志")]),e._v(" "),o("h3",{attrs:{id:"_3-1-数据库记录"}},[o("a",{staticClass:"header-anchor",attrs:{href:"#_3-1-数据库记录"}},[e._v("#")]),e._v(" 3.1 数据库记录")]),e._v(" "),o("p",[e._v("API 访问日志，记录 API 的每次调用，包括 HTTP 请求、用户、开始时间、时长等等信息。")]),e._v(" "),o("p",[e._v("打开 [基础设施 -> API 日志 -> 访问日志] 菜单，可以看对应的列表，如下图所示：")]),e._v(" "),o("p",[o("img",{attrs:{src:"/img/%E5%90%8E%E7%AB%AF%E6%89%8B%E5%86%8C/%E7%B3%BB%E7%BB%9F%E6%97%A5%E5%BF%97/%E8%AE%BF%E9%97%AE%E6%97%A5%E5%BF%97.png",alt:"系统管理 -> 访问日志"}})]),e._v(" "),o("p",[e._v("① 访问日志的记录，由 "),o("a",{attrs:{href:"https://github.com/YunaiV/ruoyi-vue-pro/blob/master/yudao-framework/yudao-spring-boot-starter-web/",target:"_blank",rel:"noopener noreferrer"}},[o("code",[e._v("yudao-spring-boot-starter-web")]),o("OutboundLink")],1),e._v(" 技术组件实现，通过 "),o("a",{attrs:{href:"https://github.com/YunaiV/ruoyi-vue-pro/blob/master/yudao-framework/yudao-spring-boot-starter-web/src/main/java/cn/iocoder/yudao/framework/apilog/core/filter/ApiAccessLogFilter.java",target:"_blank",rel:"noopener noreferrer"}},[e._v("ApiAccessLogFilter"),o("OutboundLink")],1),e._v(" 过滤 RESTful API 请求，"),o("strong",[e._v("异步")]),e._v("记录日志。")]),e._v(" "),o("p",[e._v("② 访问日志的存储，由 "),o("code",[e._v("yudao-module-infra")]),e._v(" 的 "),o("a",{attrs:{href:"https://github.com/YunaiV/ruoyi-vue-pro/blob/master/yudao-module-infra/yudao-module-infra-biz/src/main/java/cn/iocoder/yudao/module/infra/service/logger/ApiAccessLogServiceImpl.java",target:"_blank",rel:"noopener noreferrer"}},[e._v("AccessLog"),o("OutboundLink")],1),e._v(" 模块实现，记录到数据库的 "),o("a",{attrs:{href:"https://github.com/YunaiV/ruoyi-vue-pro/blob/master/yudao-module-infra/yudao-module-infra-biz/src/main/java/cn/iocoder/yudao/module/infra/dal/dataobject/logger/ApiAccessLogDO.java",target:"_blank",rel:"noopener noreferrer"}},[o("code",[e._v("infra_api_access_log")]),o("OutboundLink")],1),e._v(" 表。")]),e._v(" "),o("p",[e._v("③ 可以通过 "),o("a",{attrs:{href:"https://github.com/YunaiV/ruoyi-vue-pro/blob/master/yudao-framework/yudao-spring-boot-starter-web/src/main/java/cn/iocoder/yudao/framework/apilog/core/annotations/ApiAccessLog.java",target:"_blank",rel:"noopener noreferrer"}},[o("code",[e._v("@ApiAccessLog")]),o("OutboundLink")],1),e._v(" 注解，自定义 API 访问日志的记录。如下图所示：")]),e._v(" "),o("p",[o("img",{attrs:{src:"/img/%E5%90%8E%E7%AB%AF%E6%89%8B%E5%86%8C/%E7%B3%BB%E7%BB%9F%E6%97%A5%E5%BF%97/ApiAccessLog.png",alt:" 注解"}})]),e._v(" "),o("ul",[o("li",[o("code",[e._v("enable")]),e._v(" 字段：是否记录日志，默认为 "),o("code",[e._v("true")]),e._v(" 记录日志。如果你想某个接口不记录日志，可以设置为 "),o("code",[e._v("false")]),e._v("，例如说 NotifyMessageController 的 "),o("code",[e._v("#getUnreadNotifyMessageCount()")]),e._v(" 接口")]),e._v(" "),o("li",[o("code",[e._v("requestEnable")]),e._v(" 字段：默认为 "),o("code",[e._v("true")]),e._v(" 记录请求参数，主要考虑请求参数一般不大。如果你想某个接口不记录请求参数，可以设置为 "),o("code",[e._v("false")])]),e._v(" "),o("li",[o("code",[e._v("sanitizeKeys")]),e._v(" 字段：脱敏字段，例如说：密码、访问令牌等等。如果你想某个接口脱敏某个字段，可以设置为 "),o("code",[e._v("password")]),e._v("、"),o("code",[e._v("mobile")]),e._v(" 等等。另外，ApiAccessLogFilter 默认有 "),o("a",{attrs:{href:"https://github.com/YunaiV/ruoyi-vue-pro/blob/master/yudao-framework/yudao-spring-boot-starter-web/src/main/java/cn/iocoder/yudao/framework/apilog/core/filter/ApiAccessLogFilter.java#L52",target:"_blank",rel:"noopener noreferrer"}},[o("code",[e._v("SANITIZE_KEYS")]),o("OutboundLink")],1),e._v(" 全局配置，包括 "),o("code",[e._v("password")]),e._v("、"),o("code",[e._v("accessToken")]),e._v("、"),o("code",[e._v("refreshToken")]),e._v(" 等，避免大家忘记~")]),e._v(" "),o("li",[o("code",[e._v("responseEnable")]),e._v(" 字段：默认为 "),o("code",[e._v("false")]),e._v(" 不记录响应参数，主要考虑响应参数一般比较大，特别是 "),o("code",[e._v("GET")]),e._v(" 列表请求。如果你想某个接口记录响应参数，可以设置为 "),o("code",[e._v("true")])]),e._v(" "),o("li",[o("code",[e._v("operateModule")]),e._v(" 字段：操作模块，例如说：用户、岗位、部门等等。为空时，默认会读取类上的 Swagger "),o("code",[e._v("@Tag")]),e._v(" 注解的 "),o("code",[e._v("name")]),e._v(" 属性")]),e._v(" "),o("li",[o("code",[e._v("operateName")]),e._v(" 字段：操作名，例如说：新增用户、修改用户等等。为空时，默认会读取方法的 Swagger "),o("code",[e._v("@Operation")]),e._v(" 注解的 "),o("code",[e._v("summary")]),e._v(" 属性")]),e._v(" "),o("li",[o("code",[e._v("operateType")]),e._v(" 字段：操作类型，操作类型，在 "),o("a",{attrs:{href:"https://github.com/YunaiV/ruoyi-vue-pro/blob/master/yudao-framework/yudao-spring-boot-starter-web/src/main/java/cn/iocoder/yudao/framework/apilog/core/interceptor/ApiAccessLogInterceptor.java",target:"_blank",rel:"noopener noreferrer"}},[e._v("OperateTypeEnum"),o("OutboundLink")],1),e._v(" 枚举。目前有 "),o("code",[e._v("GET")]),e._v(" 查询、"),o("code",[e._v("CREATE")]),e._v(" 新增、"),o("code",[e._v("UPDATE")]),e._v(" 修改、"),o("code",[e._v("DELETE")]),e._v(" 删除、"),o("code",[e._v("EXPORT")]),e._v(" 导出、"),o("code",[e._v("IMPORT")]),e._v(" 导入、"),o("code",[e._v("OTHER")]),e._v(" 其它，可进行自定义")])]),e._v(" "),o("div",{staticClass:"custom-block tip"},[o("p",{staticClass:"custom-block-title"},[e._v("疑问：为什么要增加 `operateModule`、`operateName`、`operateType` 字段呢？")]),e._v(" "),o("p",[e._v("从感受上来说，它们应该属于“操作日志”，不应该记录到“访问日志”中。但是考虑到“操作日志”需要手动记录，可能大家会“偷懒”不想记录，但是业务人员（例如说：产品、运行）等看不懂“访问日志”，所以增加了这些字段，方便大家查看。")])]),e._v(" "),o("p",[e._v("④ 我们在 "),o("code",[e._v("local")]),e._v(" 本地环境下，一般做一些日常开发，使用不到“访问日志”，所以默认在 "),o("code",[e._v("application-local.yaml")]),e._v(" 配置文件里，我们设置 "),o("code",[e._v("yudao.access-log.enable")]),e._v(" 为 "),o("code",[e._v("false")]),e._v(" 默认不记录，大家如果有需要，可以设置为 "),o("code",[e._v("true")]),e._v(" 打开进行记录。")]),e._v(" "),o("h3",{attrs:{id:"_3-2-文件记录"}},[o("a",{staticClass:"header-anchor",attrs:{href:"#_3-2-文件记录"}},[e._v("#")]),e._v(" 3.2 文件记录")]),e._v(" "),o("p",[e._v("项目还提供了 "),o("a",{attrs:{href:"https://github.com/YunaiV/ruoyi-vue-pro/blob/master/yudao-framework/yudao-spring-boot-starter-web/src/main/java/cn/iocoder/yudao/framework/apilog/core/interceptor/ApiAccessLogInterceptor.java",target:"_blank",rel:"noopener noreferrer"}},[e._v("ApiAccessLogInterceptor"),o("OutboundLink")],1),e._v(" 拦截器，打印 HTTP 请求、参数、耗时到文件（IDEA 控制台）中，方便大家进行调试。如下图所示：")]),e._v(" "),o("p",[o("img",{attrs:{src:"/img/%E5%90%8E%E7%AB%AF%E6%89%8B%E5%86%8C/%E7%B3%BB%E7%BB%9F%E6%97%A5%E5%BF%97/ApiAccessLogInterceptor.png",alt:"ApiAccessLogInterceptor"}})]),e._v(" "),o("p",[e._v("每次请求有两条：一条 "),o("code",[e._v("request")]),e._v(" 【开始请求】包括请求 URL、请求参数；一条 "),o("code",[e._v("response")]),e._v(" 【结束请求】只包括耗时。")]),e._v(" "),o("p",[e._v("另外，考虑到 ApiAccessLogInterceptor 的定位是开发调试，所以 "),o("code",[e._v("prod")]),e._v(" 生产环境默认不开启噢，当然你也可以按照自己需要修改。")]),e._v(" "),o("h2",{attrs:{id:"_4-api-错误日志"}},[o("a",{staticClass:"header-anchor",attrs:{href:"#_4-api-错误日志"}},[e._v("#")]),e._v(" 4. API 错误日志")]),e._v(" "),o("p",[e._v("API 错误日志，记录每次 API 的异常调用，包括 HTTP 请求、用户、异常的堆栈等等信息。")]),e._v(" "),o("p",[e._v("打开 [基础设施 -> API 日志 -> 错误日志] 菜单，可以看对应的列表，如下图所示：")]),e._v(" "),o("p",[o("img",{attrs:{src:"/img/%E7%B3%BB%E7%BB%9F%E6%97%A5%E5%BF%97/31.png",alt:"系统管理 -> 错误日志"}})]),e._v(" "),o("p",[e._v("错误日志的记录，由 "),o("a",{attrs:{href:"https://github.com/YunaiV/ruoyi-vue-pro/blob/master/yudao-framework/yudao-spring-boot-starter-web/",target:"_blank",rel:"noopener noreferrer"}},[o("code",[e._v("yudao-spring-boot-starter-web")]),o("OutboundLink")],1),e._v(" 技术组件实现，通过 "),o("a",{attrs:{href:"https://github.com/YunaiV/ruoyi-vue-pro/blob/master/yudao-framework/yudao-spring-boot-starter-web/src/main/java/cn/iocoder/yudao/framework/web/core/handler/GlobalExceptionHandler.java",target:"_blank",rel:"noopener noreferrer"}},[e._v("GlobalExceptionHandler"),o("OutboundLink")],1),e._v(" 拦截每次 RESTful API 的系统异常，"),o("strong",[e._v("异步")]),e._v("记录日志。")]),e._v(" "),o("p",[o("img",{attrs:{src:"/img/%E7%B3%BB%E7%BB%9F%E6%97%A5%E5%BF%97/32.png",alt:"GlobalExceptionHandler"}})]),e._v(" "),o("p",[e._v("错误日志的存储，由 "),o("code",[e._v("yudao-module-infra")]),e._v(" 的 "),o("a",{attrs:{href:"https://github.com/YunaiV/ruoyi-vue-pro/blob/master/yudao-module-infra/yudao-module-infra-biz/src/main/java/cn/iocoder/yudao/module/infra/service/logger/ApiErrorLogServiceImpl.java",target:"_blank",rel:"noopener noreferrer"}},[e._v("ErrorLog"),o("OutboundLink")],1),e._v(" 模块实现，记录到数据库的 "),o("a",{attrs:{href:"https://github.com/YunaiV/ruoyi-vue-pro/blob/master/yudao-module-infra/yudao-module-infra-biz/src/main/java/cn/iocoder/yudao/module/infra/dal/dataobject/logger/ApiErrorLogDO.java",target:"_blank",rel:"noopener noreferrer"}},[o("code",[e._v("infra_api_error_log")]),o("OutboundLink")],1),e._v(" 表。")])])}),[],!1,null,null,null);o.default=t.exports}}]);