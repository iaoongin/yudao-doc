(window.webpackJsonp=window.webpackJsonp||[]).push([[74],{403:function(_,v,t){"use strict";t.r(v);var d=t(7),E=Object(d.a)({},(function(){var _=this,v=_._self._c;return v("ContentSlotsDistributor",{attrs:{"slot-key":_.$parent.slotKey}},[v("div",{staticClass:"custom-block tip"},[v("p",{staticClass:"custom-block-title"},[_._v("相关视频：")]),_._v(" "),v("ul",[v("li",[v("a",{attrs:{href:"https://t.zsxq.com/04jyvNfqj",target:"_blank",rel:"noopener noreferrer"}},[_._v("11、如何实现流程的发起？"),v("OutboundLink")],1)]),_._v(" "),v("li",[v("a",{attrs:{href:"https://t.zsxq.com/046UFqRzz",target:"_blank",rel:"noopener noreferrer"}},[_._v("12、如何实现我的流程列表？"),v("OutboundLink")],1)]),_._v(" "),v("li",[v("a",{attrs:{href:"https://t.zsxq.com/04aM72rzv",target:"_blank",rel:"noopener noreferrer"}},[_._v("13、如何实现流程的取消？"),v("OutboundLink")],1)])])]),_._v(" "),v("p",[_._v("本文的内容比较简单，主要围绕 [审批中心] 菜单下的 [我的流程]、[发起流程] 子菜单，讲解流程的发起、取消、重新发起的操作流程。")]),_._v(" "),v("h2",{attrs:{id:"_1-发起流程"}},[v("a",{staticClass:"header-anchor",attrs:{href:"#_1-发起流程"}},[_._v("#")]),_._v(" 1. 发起流程")]),_._v(" "),v("p",[_._v("发起流程，对应 [审批中心 -> 发起流程] 菜单，如下图所示：")]),_._v(" "),v("p",[v("img",{attrs:{src:"/img/%E5%B7%A5%E4%BD%9C%E6%B5%81%E6%89%8B%E5%86%8C/%E6%B5%81%E7%A8%8B%E5%88%97%E8%A1%A8/%E5%8F%91%E8%B5%B7%E6%B5%81%E7%A8%8B.png",alt:"发起流程"}})]),_._v(" "),v("h3",{attrs:{id:"_1-1-表结构"}},[v("a",{staticClass:"header-anchor",attrs:{href:"#_1-1-表结构"}},[_._v("#")]),_._v(" 1.1 表结构")]),_._v(" "),v("p",[_._v("① 流程实例表，由 Flowable 提供的 "),v("code",[_._v("ACT_RU_EXECUTION")]),_._v(" 表实现，如下所示：")]),_._v(" "),v("table",[v("thead",[v("tr",[v("th",[_._v("字段")]),_._v(" "),v("th",[_._v("类型")]),_._v(" "),v("th",[_._v("主键")]),_._v(" "),v("th",[_._v("说明")]),_._v(" "),v("th",[_._v("备注")])])]),_._v(" "),v("tbody",[v("tr",[v("td",[_._v("ID_")]),_._v(" "),v("td",[_._v("NVARCHAR2(64)")]),_._v(" "),v("td",[_._v("Y")]),_._v(" "),v("td",[_._v("主键")]),_._v(" "),v("td")]),_._v(" "),v("tr",[v("td",[_._v("REV_")]),_._v(" "),v("td",[_._v("INTEGER")]),_._v(" "),v("td",[_._v("N")]),_._v(" "),v("td",[_._v("数据版本")]),_._v(" "),v("td")]),_._v(" "),v("tr",[v("td",[_._v("PROC_INST_ID_")]),_._v(" "),v("td",[_._v("NVARCHAR2(64)")]),_._v(" "),v("td",[_._v("N")]),_._v(" "),v("td",[_._v("流程实例 ID")]),_._v(" "),v("td")]),_._v(" "),v("tr",[v("td",[_._v("BUSINESS_KEY_")]),_._v(" "),v("td",[_._v("NVARCHAR2(255)")]),_._v(" "),v("td",[_._v("N")]),_._v(" "),v("td",[_._v("业务主键 ID")]),_._v(" "),v("td")]),_._v(" "),v("tr",[v("td",[_._v("PARENT_ID_")]),_._v(" "),v("td",[_._v("NVARCHAR2(64)")]),_._v(" "),v("td",[_._v("N")]),_._v(" "),v("td",[_._v("父执行流的 ID")]),_._v(" "),v("td")]),_._v(" "),v("tr",[v("td",[_._v("PROC_DEF_ID_")]),_._v(" "),v("td",[_._v("NVARCHAR2(64)")]),_._v(" "),v("td",[_._v("N")]),_._v(" "),v("td",[_._v("流程定义的数据 ID")]),_._v(" "),v("td")]),_._v(" "),v("tr",[v("td",[_._v("SUPER_EXEC_")]),_._v(" "),v("td",[_._v("NVARCHAR2(64)")]),_._v(" "),v("td",[_._v("N")]),_._v(" "),v("td"),_._v(" "),v("td")]),_._v(" "),v("tr",[v("td",[_._v("ROOT_PROC_INST_ID_")]),_._v(" "),v("td",[_._v("NVARCHAR2(64)")]),_._v(" "),v("td",[_._v("N")]),_._v(" "),v("td"),_._v(" "),v("td")]),_._v(" "),v("tr",[v("td",[_._v("ACT_ID_")]),_._v(" "),v("td",[_._v("NVARCHAR2(255)")]),_._v(" "),v("td",[_._v("N")]),_._v(" "),v("td",[_._v("节点实例 ID")]),_._v(" "),v("td")]),_._v(" "),v("tr",[v("td",[_._v("IS_ACTIVE_")]),_._v(" "),v("td",[_._v("NUMBER(1)")]),_._v(" "),v("td",[_._v("N")]),_._v(" "),v("td",[_._v("是否存活")]),_._v(" "),v("td")]),_._v(" "),v("tr",[v("td",[_._v("IS_CONCURRENT_")]),_._v(" "),v("td",[_._v("NUMBER(1)")]),_._v(" "),v("td",[_._v("N")]),_._v(" "),v("td",[_._v("执行流是否正在并行")]),_._v(" "),v("td")]),_._v(" "),v("tr",[v("td",[_._v("IS_SCOPE_")]),_._v(" "),v("td",[_._v("NUMBER(1)")]),_._v(" "),v("td",[_._v("N")]),_._v(" "),v("td"),_._v(" "),v("td")]),_._v(" "),v("tr",[v("td",[_._v("IS_EVENT_SCOPE_")]),_._v(" "),v("td",[_._v("NUMBER(1)")]),_._v(" "),v("td",[_._v("N")]),_._v(" "),v("td"),_._v(" "),v("td")]),_._v(" "),v("tr",[v("td",[_._v("IS_MI_ROOT_")]),_._v(" "),v("td",[_._v("NUMBER(1)")]),_._v(" "),v("td",[_._v("N")]),_._v(" "),v("td"),_._v(" "),v("td")]),_._v(" "),v("tr",[v("td",[_._v("SUSPENSION_STATE_")]),_._v(" "),v("td",[_._v("INTEGER")]),_._v(" "),v("td",[_._v("N")]),_._v(" "),v("td",[_._v("流程终端状态")]),_._v(" "),v("td")]),_._v(" "),v("tr",[v("td",[_._v("CACHED_ENT_STATE_")]),_._v(" "),v("td",[_._v("INTEGER")]),_._v(" "),v("td",[_._v("N")]),_._v(" "),v("td"),_._v(" "),v("td")]),_._v(" "),v("tr",[v("td",[_._v("TENANT_ID_")]),_._v(" "),v("td",[_._v("NVARCHAR2(255)")]),_._v(" "),v("td",[_._v("N")]),_._v(" "),v("td"),_._v(" "),v("td")]),_._v(" "),v("tr",[v("td",[_._v("NAME_")]),_._v(" "),v("td",[_._v("NVARCHAR2(255)")]),_._v(" "),v("td",[_._v("N")]),_._v(" "),v("td"),_._v(" "),v("td")]),_._v(" "),v("tr",[v("td",[_._v("START_TIME_")]),_._v(" "),v("td",[_._v("TIMESTAMP(6)")]),_._v(" "),v("td",[_._v("N")]),_._v(" "),v("td",[_._v("开始时间")]),_._v(" "),v("td")]),_._v(" "),v("tr",[v("td",[_._v("START_USER_ID_")]),_._v(" "),v("td",[_._v("NVARCHAR2(255)")]),_._v(" "),v("td",[_._v("N")]),_._v(" "),v("td"),_._v(" "),v("td")]),_._v(" "),v("tr",[v("td",[_._v("LOCK_TIME_")]),_._v(" "),v("td",[_._v("TIMESTAMP(6)")]),_._v(" "),v("td",[_._v("N")]),_._v(" "),v("td"),_._v(" "),v("td")]),_._v(" "),v("tr",[v("td",[_._v("IS_COUNT_ENABLED_")]),_._v(" "),v("td",[_._v("NUMBER(1)")]),_._v(" "),v("td",[_._v("N")]),_._v(" "),v("td"),_._v(" "),v("td")]),_._v(" "),v("tr",[v("td",[_._v("EVT_SUBSCR_COUNT_")]),_._v(" "),v("td",[_._v("INTEGER")]),_._v(" "),v("td",[_._v("N")]),_._v(" "),v("td"),_._v(" "),v("td")]),_._v(" "),v("tr",[v("td",[_._v("TASK_COUNT_")]),_._v(" "),v("td",[_._v("INTEGER")]),_._v(" "),v("td",[_._v("N")]),_._v(" "),v("td"),_._v(" "),v("td")]),_._v(" "),v("tr",[v("td",[_._v("JOB_COUNT_")]),_._v(" "),v("td",[_._v("INTEGER")]),_._v(" "),v("td",[_._v("N")]),_._v(" "),v("td"),_._v(" "),v("td")]),_._v(" "),v("tr",[v("td",[_._v("TIMER_JOB_COUNT_")]),_._v(" "),v("td",[_._v("INTEGER")]),_._v(" "),v("td",[_._v("N")]),_._v(" "),v("td"),_._v(" "),v("td")]),_._v(" "),v("tr",[v("td",[_._v("SUSP_JOB_COUNT_")]),_._v(" "),v("td",[_._v("INTEGER")]),_._v(" "),v("td",[_._v("N")]),_._v(" "),v("td"),_._v(" "),v("td")]),_._v(" "),v("tr",[v("td",[_._v("DEADLETTER_JOB_COUNT_")]),_._v(" "),v("td",[_._v("INTEGER")]),_._v(" "),v("td",[_._v("N")]),_._v(" "),v("td"),_._v(" "),v("td")]),_._v(" "),v("tr",[v("td",[_._v("VAR_COUNT_")]),_._v(" "),v("td",[_._v("INTEGER")]),_._v(" "),v("td",[_._v("N")]),_._v(" "),v("td"),_._v(" "),v("td")]),_._v(" "),v("tr",[v("td",[_._v("ID_LINK_COUNT_")]),_._v(" "),v("td",[_._v("INTEGER")]),_._v(" "),v("td",[_._v("N")]),_._v(" "),v("td"),_._v(" "),v("td")])])]),_._v(" "),v("p",[_._v("② 流程参数表，由 Flowable 提供的 "),v("code",[_._v("ACT_RU_VARIABLE")]),_._v(" 表实现，如下所示：")]),_._v(" "),v("table",[v("thead",[v("tr",[v("th",[_._v("字段")]),_._v(" "),v("th",[_._v("类型")]),_._v(" "),v("th",[_._v("主键")]),_._v(" "),v("th",[_._v("说明")]),_._v(" "),v("th",[_._v("备注")])])]),_._v(" "),v("tbody",[v("tr",[v("td",[_._v("ID_")]),_._v(" "),v("td",[_._v("NVARCHAR2(64)")]),_._v(" "),v("td",[_._v("Y")]),_._v(" "),v("td",[_._v("主键")]),_._v(" "),v("td")]),_._v(" "),v("tr",[v("td",[_._v("REV_")]),_._v(" "),v("td",[_._v("INTEGER")]),_._v(" "),v("td",[_._v("N")]),_._v(" "),v("td",[_._v("数据版本")]),_._v(" "),v("td")]),_._v(" "),v("tr",[v("td",[_._v("TYPE_")]),_._v(" "),v("td",[_._v("NVARCHAR2(255)")]),_._v(" "),v("td",[_._v("N")]),_._v(" "),v("td",[_._v("参数类型")]),_._v(" "),v("td",[_._v("可以是基本的类型，也可以用户自行扩展")])]),_._v(" "),v("tr",[v("td",[_._v("NAME_")]),_._v(" "),v("td",[_._v("NVARCHAR2(255)")]),_._v(" "),v("td",[_._v("N")]),_._v(" "),v("td",[_._v("参数名称")]),_._v(" "),v("td")]),_._v(" "),v("tr",[v("td",[_._v("EXECUTION_ID_")]),_._v(" "),v("td",[_._v("NVARCHAR2(64)")]),_._v(" "),v("td",[_._v("N")]),_._v(" "),v("td",[_._v("参数执行 ID")]),_._v(" "),v("td")]),_._v(" "),v("tr",[v("td",[_._v("PROC_INST_ID_")]),_._v(" "),v("td",[_._v("NVARCHAR2(64)")]),_._v(" "),v("td",[_._v("N")]),_._v(" "),v("td",[_._v("流程实例 ID")]),_._v(" "),v("td")]),_._v(" "),v("tr",[v("td",[_._v("TASK_ID_")]),_._v(" "),v("td",[_._v("NVARCHAR2(64)")]),_._v(" "),v("td",[_._v("N")]),_._v(" "),v("td",[_._v("任务 ID")]),_._v(" "),v("td")]),_._v(" "),v("tr",[v("td",[_._v("BYTEARRAY_ID_")]),_._v(" "),v("td",[_._v("NVARCHAR2(64)")]),_._v(" "),v("td",[_._v("N")]),_._v(" "),v("td",[_._v("资源 ID")]),_._v(" "),v("td")]),_._v(" "),v("tr",[v("td",[_._v("DOUBLE_")]),_._v(" "),v("td",[_._v("NUMBER(*,10)")]),_._v(" "),v("td",[_._v("N")]),_._v(" "),v("td",[_._v("参数为 double，则保存在该字段中")]),_._v(" "),v("td")]),_._v(" "),v("tr",[v("td",[_._v("LONG_")]),_._v(" "),v("td",[_._v("NUMBER(19)")]),_._v(" "),v("td",[_._v("N")]),_._v(" "),v("td",[_._v("参数为 long，则保存在该字段中")]),_._v(" "),v("td")]),_._v(" "),v("tr",[v("td",[_._v("TEXT_")]),_._v(" "),v("td",[_._v("NVARCHAR2(2000)")]),_._v(" "),v("td",[_._v("N")]),_._v(" "),v("td",[_._v("用户保存文本类型的参数值")]),_._v(" "),v("td")]),_._v(" "),v("tr",[v("td",[_._v("TEXT2_")]),_._v(" "),v("td",[_._v("NVARCHAR2(2000)")]),_._v(" "),v("td",[_._v("N")]),_._v(" "),v("td",[_._v("用户保存文本类型的参数值")]),_._v(" "),v("td")])])]),_._v(" "),v("p",[_._v("在 Flowable 中，如果想给 Task 增加拓展字段，无法通过 "),v("code",[_._v("ACT_RU_EXECUTION")]),_._v(" 实现，而是通过 "),v("code",[_._v("ACT_RU_VARIABLE")]),_._v(" 表实现。")]),_._v(" "),v("p",[_._v("该表是一种 Key-Value 的形式，可以存储任意类型的数据。例如说，项目中给 ProcessInstance 增加了一个 "),v("code",[_._v("PROCESS_STATUS")]),_._v(" 字段，表示流程状态，如下图所示：")]),_._v(" "),v("p",[v("img",{attrs:{src:"/img/%E5%B7%A5%E4%BD%9C%E6%B5%81%E6%89%8B%E5%86%8C/%E6%B5%81%E7%A8%8B%E5%88%97%E8%A1%A8/PROCESS_STATUS.png",alt:"PROCESS_STATUS"}})]),_._v(" "),v("h3",{attrs:{id:"_1-2-流程状态"}},[v("a",{staticClass:"header-anchor",attrs:{href:"#_1-2-流程状态"}},[_._v("#")]),_._v(" 1.2 流程状态")]),_._v(" "),v("p",[_._v("流程状态，由 "),v("a",{attrs:{href:"https://github.com/YunaiV/ruoyi-vue-pro/blob/master/yudao-module-bpm/yudao-module-bpm-api/src/main/java/cn/iocoder/yudao/module/bpm/enums/task/BpmProcessInstanceStatusEnum.java",target:"_blank",rel:"noopener noreferrer"}},[_._v("BpmProcessInstanceStatusEnum"),v("OutboundLink")],1),_._v(" 目前有 4 种，如下图所示：")]),_._v(" "),v("p",[v("img",{attrs:{src:"/img/%E5%B7%A5%E4%BD%9C%E6%B5%81%E6%89%8B%E5%86%8C/%E6%B5%81%E7%A8%8B%E5%88%97%E8%A1%A8/%E6%B5%81%E7%A8%8B%E7%8A%B6%E6%80%81.png",alt:"流程状态"}})]),_._v(" "),v("h3",{attrs:{id:"_1-3-具体实现"}},[v("a",{staticClass:"header-anchor",attrs:{href:"#_1-3-具体实现"}},[_._v("#")]),_._v(" 1.3 具体实现")]),_._v(" "),v("ul",[v("li",[_._v("前端，对应 "),v("code",[_._v("/views/bpm/processInstance/create/index.vue")]),_._v(" 实现界面")]),_._v(" "),v("li",[_._v("后端，对应 BpmProcessInstanceController 的 "),v("code",[_._v("#createProcessInstance(...)")]),_._v(" 提供接口")])]),_._v(" "),v("p",[v("img",{attrs:{src:"/img/%E5%B7%A5%E4%BD%9C%E6%B5%81%E6%89%8B%E5%86%8C/%E6%B5%81%E7%A8%8B%E5%88%97%E8%A1%A8/%E5%8F%91%E8%B5%B7%E6%B5%81%E7%A8%8B%E7%9A%84%E5%AE%9E%E7%8E%B0.png",alt:"发起流程的实现"}})]),_._v(" "),v("p",[_._v("最核心的，就是调用 Flowable 的 "),v("code",[_._v("RuntimeService#createProcessInstanceBuilder().start()")]),_._v(" 方法，创建流程实例。同时因为 Flowable 自身没有流程状态，所以需要我们自己维护任务状态。")]),_._v(" "),v("h2",{attrs:{id:"_2-我的流程"}},[v("a",{staticClass:"header-anchor",attrs:{href:"#_2-我的流程"}},[_._v("#")]),_._v(" 2. 我的流程")]),_._v(" "),v("p",[_._v("我的流程，对应 [审批中心 -> 我的流程] 菜单，如下图所示：")]),_._v(" "),v("p",[v("img",{attrs:{src:"/img/%E5%B7%A5%E4%BD%9C%E6%B5%81%E6%89%8B%E5%86%8C/%E6%B5%81%E7%A8%8B%E5%88%97%E8%A1%A8/%E6%88%91%E7%9A%84%E6%B5%81%E7%A8%8B.png",alt:"我的流程"}})]),_._v(" "),v("h3",{attrs:{id:"_2-1-表结构"}},[v("a",{staticClass:"header-anchor",attrs:{href:"#_2-1-表结构"}},[_._v("#")]),_._v(" 2.1 表结构")]),_._v(" "),v("p",[_._v("① 历史流程实例表，由 Flowable 提供的 "),v("code",[_._v("ACT_HI_PROCINST")]),_._v(" 表实现，如下所示：")]),_._v(" "),v("table",[v("thead",[v("tr",[v("th",[_._v("字段")]),_._v(" "),v("th",[_._v("类型")]),_._v(" "),v("th",[_._v("主键")]),_._v(" "),v("th",[_._v("说明")]),_._v(" "),v("th",[_._v("备注")])])]),_._v(" "),v("tbody",[v("tr",[v("td",[_._v("ID_")]),_._v(" "),v("td",[_._v("NVARCHAR2(64)")]),_._v(" "),v("td",[_._v("Y")]),_._v(" "),v("td",[_._v("主键")]),_._v(" "),v("td")]),_._v(" "),v("tr",[v("td",[_._v("PROC_INST_ID_")]),_._v(" "),v("td",[_._v("NVARCHAR2(64)")]),_._v(" "),v("td",[_._v("N")]),_._v(" "),v("td",[_._v("流程实例 ID")]),_._v(" "),v("td")]),_._v(" "),v("tr",[v("td",[_._v("BUSINESS_KEY_")]),_._v(" "),v("td",[_._v("NVARCHAR2(255)")]),_._v(" "),v("td",[_._v("N")]),_._v(" "),v("td",[_._v("业务主键")]),_._v(" "),v("td")]),_._v(" "),v("tr",[v("td",[_._v("PROC_DEF_ID_")]),_._v(" "),v("td",[_._v("NVARCHAR2(64)")]),_._v(" "),v("td",[_._v("N")]),_._v(" "),v("td",[_._v("属性 ID")]),_._v(" "),v("td")]),_._v(" "),v("tr",[v("td",[_._v("START_TIME_")]),_._v(" "),v("td",[_._v("TIMESTAMP(6)")]),_._v(" "),v("td",[_._v("N")]),_._v(" "),v("td",[_._v("开始时间")]),_._v(" "),v("td")]),_._v(" "),v("tr",[v("td",[_._v("END_TIME_")]),_._v(" "),v("td",[_._v("TIMESTAMP(6)")]),_._v(" "),v("td",[_._v("N")]),_._v(" "),v("td",[_._v("结束时间")]),_._v(" "),v("td")]),_._v(" "),v("tr",[v("td",[_._v("DURATION_")]),_._v(" "),v("td",[_._v("NUMBER(19)")]),_._v(" "),v("td",[_._v("N")]),_._v(" "),v("td",[_._v("耗时")]),_._v(" "),v("td")]),_._v(" "),v("tr",[v("td",[_._v("START_USER_ID_")]),_._v(" "),v("td",[_._v("NVARCHAR2(255)")]),_._v(" "),v("td",[_._v("N")]),_._v(" "),v("td",[_._v("起始人")]),_._v(" "),v("td")]),_._v(" "),v("tr",[v("td",[_._v("START_ACT_ID_")]),_._v(" "),v("td",[_._v("NVARCHAR2(255)")]),_._v(" "),v("td",[_._v("N")]),_._v(" "),v("td",[_._v("起始节点")]),_._v(" "),v("td")]),_._v(" "),v("tr",[v("td",[_._v("END_ACT_ID_")]),_._v(" "),v("td",[_._v("NVARCHAR2(255)")]),_._v(" "),v("td",[_._v("N")]),_._v(" "),v("td",[_._v("结束节点")]),_._v(" "),v("td")]),_._v(" "),v("tr",[v("td",[_._v("SUPER_PROCESS_INSTANCE_ID_")]),_._v(" "),v("td",[_._v("NVARCHAR2(64)")]),_._v(" "),v("td",[_._v("N")]),_._v(" "),v("td",[_._v("父流程实例 ID")]),_._v(" "),v("td")]),_._v(" "),v("tr",[v("td",[_._v("DELETE_REASON_")]),_._v(" "),v("td",[_._v("NVARCHAR2(2000)")]),_._v(" "),v("td",[_._v("N")]),_._v(" "),v("td",[_._v("删除原因")]),_._v(" "),v("td")]),_._v(" "),v("tr",[v("td",[_._v("TENANT_ID_")]),_._v(" "),v("td",[_._v("NVARCHAR2(255)")]),_._v(" "),v("td",[_._v("N")]),_._v(" "),v("td"),_._v(" "),v("td")]),_._v(" "),v("tr",[v("td",[_._v("NAME_")]),_._v(" "),v("td",[_._v("NVARCHAR2(255)")]),_._v(" "),v("td",[_._v("N")]),_._v(" "),v("td",[_._v("名称")]),_._v(" "),v("td")])])]),_._v(" "),v("p",[_._v("在 Flowable 中，如果 ProcessInstance 被完成（全部审批通过、不通过、取消等）时候，会从 "),v("code",[_._v("ACT_RU_EXECUTION")]),_._v(" 表中删除，只能在 "),v("code",[_._v("ACT_HI_PROCINST")]),_._v(" 表查询到。这是一种“冷热分离”的设计思想，因为进行的任务访问比较频繁，数据量越小，性能会越好。")]),_._v(" "),v("p",[_._v("而 [我的流程] 需要查询进行中、已完成的流程，所以需要查询 "),v("code",[_._v("ACT_HI_PROCINST")]),_._v(" 表，而不能使用 "),v("code",[_._v("ACT_RU_EXECUTION")]),_._v(" 表。")]),_._v(" "),v("p",[_._v("② 流程历史参数表，由 Flowable 提供的 "),v("code",[_._v("ACT_HI_VARINST")]),_._v(" 表实现，如下所示：")]),_._v(" "),v("table",[v("thead",[v("tr",[v("th",[_._v("字段")]),_._v(" "),v("th",[_._v("类型")]),_._v(" "),v("th",[_._v("主键")]),_._v(" "),v("th",[_._v("说明")]),_._v(" "),v("th",[_._v("备注")])])]),_._v(" "),v("tbody",[v("tr",[v("td",[_._v("ID_")]),_._v(" "),v("td",[_._v("NVARCHAR2(64)")]),_._v(" "),v("td",[_._v("Y")]),_._v(" "),v("td",[_._v("主键")]),_._v(" "),v("td")]),_._v(" "),v("tr",[v("td",[_._v("PROC_INST_ID_")]),_._v(" "),v("td",[_._v("NVARCHAR2(64)")]),_._v(" "),v("td",[_._v("N")]),_._v(" "),v("td",[_._v("流程实例 ID")]),_._v(" "),v("td")]),_._v(" "),v("tr",[v("td",[_._v("EXECUTION_ID_")]),_._v(" "),v("td",[_._v("NVARCHAR2(64)")]),_._v(" "),v("td",[_._v("N")]),_._v(" "),v("td",[_._v("指定 ID")]),_._v(" "),v("td")]),_._v(" "),v("tr",[v("td",[_._v("TASK_ID_")]),_._v(" "),v("td",[_._v("NVARCHAR2(64)")]),_._v(" "),v("td",[_._v("N")]),_._v(" "),v("td",[_._v("任务 ID")]),_._v(" "),v("td")]),_._v(" "),v("tr",[v("td",[_._v("NAME_")]),_._v(" "),v("td",[_._v("NVARCHAR2(255)")]),_._v(" "),v("td",[_._v("N")]),_._v(" "),v("td",[_._v("名称")]),_._v(" "),v("td")]),_._v(" "),v("tr",[v("td",[_._v("VAR_TYPE_")]),_._v(" "),v("td",[_._v("NVARCHAR2(100)")]),_._v(" "),v("td",[_._v("N")]),_._v(" "),v("td",[_._v("参数类型")]),_._v(" "),v("td")]),_._v(" "),v("tr",[v("td",[_._v("REV_")]),_._v(" "),v("td",[_._v("INTEGER")]),_._v(" "),v("td",[_._v("N")]),_._v(" "),v("td",[_._v("数据版本")]),_._v(" "),v("td")]),_._v(" "),v("tr",[v("td",[_._v("BYTEARRAY_ID_")]),_._v(" "),v("td",[_._v("NVARCHAR2(64)")]),_._v(" "),v("td",[_._v("N")]),_._v(" "),v("td",[_._v("字节表 ID")]),_._v(" "),v("td")]),_._v(" "),v("tr",[v("td",[_._v("DOUBLE_")]),_._v(" "),v("td",[_._v("NUMBER(*,10)")]),_._v(" "),v("td",[_._v("N")]),_._v(" "),v("td",[_._v("存储 double 类型数据")]),_._v(" "),v("td")]),_._v(" "),v("tr",[v("td",[_._v("LONG_")]),_._v(" "),v("td",[_._v("NUMBER(*,10)")]),_._v(" "),v("td",[_._v("N")]),_._v(" "),v("td",[_._v("存储 long 类型数据")]),_._v(" "),v("td")]),_._v(" "),v("tr",[v("td",[_._v("TEXT_")]),_._v(" "),v("td",[_._v("NVARCHAR2(2000)")]),_._v(" "),v("td",[_._v("N")]),_._v(" "),v("td"),_._v(" "),v("td")]),_._v(" "),v("tr",[v("td",[_._v("TEXT2_")]),_._v(" "),v("td",[_._v("NVARCHAR2(2000)")]),_._v(" "),v("td",[_._v("N")]),_._v(" "),v("td"),_._v(" "),v("td")]),_._v(" "),v("tr",[v("td",[_._v("CREATE_TIME_")]),_._v(" "),v("td",[_._v("TIMESTAMP(6)(2000)")]),_._v(" "),v("td",[_._v("N")]),_._v(" "),v("td"),_._v(" "),v("td")]),_._v(" "),v("tr",[v("td",[_._v("LAST_UPDATED_TIME_")]),_._v(" "),v("td",[_._v("TIMESTAMP(6)(2000)")]),_._v(" "),v("td",[_._v("N")]),_._v(" "),v("td"),_._v(" "),v("td")])])]),_._v(" "),v("p",[_._v("在 Flowable 中，如果 ProcessInstance 被完成（全部审批通过、不通过、取消等）时候，会从 "),v("code",[_._v("ACT_RU_VARIABLE")]),_._v(" 表中删除，只能在 "),v("code",[_._v("ACT_HI_VARINST")]),_._v(" 表查询到。这当然也是是一种“冷热分离”的设计思想~")]),_._v(" "),v("h3",{attrs:{id:"_2-2-具体实现"}},[v("a",{staticClass:"header-anchor",attrs:{href:"#_2-2-具体实现"}},[_._v("#")]),_._v(" 2.2 具体实现")]),_._v(" "),v("ul",[v("li",[_._v("前端，对应 "),v("code",[_._v("/views/bpm/processInstance/index.vue")]),_._v(" 实现界面")]),_._v(" "),v("li",[_._v("后端，对应 BpmProcessInstanceController 的 "),v("code",[_._v("#getProcessInstanceMyPage(...)")]),_._v(" 提供接口")])]),_._v(" "),v("p",[v("img",{attrs:{src:"/img/%E5%B7%A5%E4%BD%9C%E6%B5%81%E6%89%8B%E5%86%8C/%E6%B5%81%E7%A8%8B%E5%88%97%E8%A1%A8/%E6%88%91%E7%9A%84%E6%B5%81%E7%A8%8B%E7%9A%84%E5%AE%9E%E7%8E%B0.png",alt:"我的流程的实现"}})]),_._v(" "),v("h3",{attrs:{id:"_2-1-取消流程"}},[v("a",{staticClass:"header-anchor",attrs:{href:"#_2-1-取消流程"}},[_._v("#")]),_._v(" 2.1 取消流程")]),_._v(" "),v("p",[_._v("可点击某个流程的「取消」按钮，进行流程的取消，如下图所示：")]),_._v(" "),v("p",[v("img",{attrs:{src:"/img/%E5%B7%A5%E4%BD%9C%E6%B5%81%E6%89%8B%E5%86%8C/%E6%B5%81%E7%A8%8B%E5%88%97%E8%A1%A8/%E5%8F%96%E6%B6%88%E6%B5%81%E7%A8%8B.png",alt:"取消流程"}})]),_._v(" "),v("p",[_._v("后端由 BpmProcessInstanceController 的 "),v("code",[_._v("#cancelProcessInstance(...)")]),_._v(" 提供接口，如下图所示：")]),_._v(" "),v("p",[v("img",{attrs:{src:"/img/%E5%B7%A5%E4%BD%9C%E6%B5%81%E6%89%8B%E5%86%8C/%E6%B5%81%E7%A8%8B%E5%88%97%E8%A1%A8/%E5%8F%96%E6%B6%88%E6%B5%81%E7%A8%8B%E7%9A%84%E5%AE%9E%E7%8E%B0.png",alt:"取消流程的实现"}})]),_._v(" "),v("ul",[v("li",[_._v("最核心的，就是调用 Flowable 的 "),v("code",[_._v("RuntimeService#deleteProcessInstance(...)")]),_._v(" 方法，取消流程实例。")])]),_._v(" "),v("p",[_._v("可能你会有疑问，哪里将流程状态更新为 "),v("code",[_._v("CANCEL")]),_._v(" 已取消呢？答案在 "),v("a",{attrs:{href:"https://github.com/YunaiV/ruoyi-vue-pro/blob/master/yudao-module-bpm/yudao-module-bpm-biz/src/main/java/cn/iocoder/yudao/module/bpm/framework/flowable/core/listener/BpmProcessInstanceEventListener.java",target:"_blank",rel:"noopener noreferrer"}},[_._v("BpmProcessInstanceEventListener"),v("OutboundLink")],1),_._v(" 监听器，它会监听到流程实例变更为取消，然后调用 BpmProcessInstanceController 的 "),v("code",[_._v("#updateProcessInstanceWhenCancel(...)")]),_._v(" 方法，进行更新。如下图所示：")]),_._v(" "),v("p",[v("img",{attrs:{src:"/img/%E5%B7%A5%E4%BD%9C%E6%B5%81%E6%89%8B%E5%86%8C/%E6%B5%81%E7%A8%8B%E5%88%97%E8%A1%A8/%E6%9B%B4%E6%96%B0%E6%B5%81%E7%A8%8B%E4%B8%BA%E5%B7%B2%E5%8F%96%E6%B6%88.png",alt:"更新流程为已取消"}})]),_._v(" "),v("h3",{attrs:{id:"_2-2-重新发起流程"}},[v("a",{staticClass:"header-anchor",attrs:{href:"#_2-2-重新发起流程"}},[_._v("#")]),_._v(" 2.2 重新发起流程")]),_._v(" "),v("p",[_._v("流程结束后，可点击它的「重新发起」按钮，进行流程的重新发起，如下图所示：")]),_._v(" "),v("p",[v("img",{attrs:{src:"/img/%E5%B7%A5%E4%BD%9C%E6%B5%81%E6%89%8B%E5%86%8C/%E6%B5%81%E7%A8%8B%E5%88%97%E8%A1%A8/%E9%87%8D%E6%96%B0%E5%8F%91%E8%B5%B7.png",alt:"重新发起"}})]),_._v(" "),v("p",[_._v("它的效果是，跳转到 [发起流程] 页面，然后将之前的流程参数，填充到表单中，如下图所示：")]),_._v(" "),v("p",[v("img",{attrs:{src:"/img/%E5%B7%A5%E4%BD%9C%E6%B5%81%E6%89%8B%E5%86%8C/%E6%B5%81%E7%A8%8B%E5%88%97%E8%A1%A8/%E9%87%8D%E6%96%B0%E5%8F%91%E8%B5%B7%E9%A1%B5.png",alt:"重新发起"}})]),_._v(" "),v("p",[_._v("因此，它最终调用的还是「1. 发起流程」小节的发起流程接口，再次（重新）发起一个流程。")]),_._v(" "),v("h2",{attrs:{id:"_3-流程实例"}},[v("a",{staticClass:"header-anchor",attrs:{href:"#_3-流程实例"}},[_._v("#")]),_._v(" 3. 流程实例")]),_._v(" "),v("p",[_._v("流程实例，展示系统中所有的流程，一般用于管理员查询，对应 [流程管理 -> 流程实例] 菜单，如下图所示：")]),_._v(" "),v("p",[v("img",{attrs:{src:"/img/%E5%B7%A5%E4%BD%9C%E6%B5%81%E6%89%8B%E5%86%8C/%E6%B5%81%E7%A8%8B%E5%88%97%E8%A1%A8/%E6%B5%81%E7%A8%8B%E5%AE%9E%E4%BE%8B.png",alt:"流程实例"}})]),_._v(" "),v("ul",[v("li",[_._v("后端，对应 BpmProcessInstanceController 的 "),v("code",[_._v("#getProcessInstanceManagerPage(...)")]),_._v(" 提供接口")]),_._v(" "),v("li",[_._v("前端，对应 "),v("code",[_._v("/views/bpm/processInstance/manager/index.vue")]),_._v(" 实现界面")])]),_._v(" "),v("p",[_._v("由于它查询的是所有流程，所以读取的是 "),v("code",[_._v("ACT_HI_PROCINST")]),_._v(" 表，而不是 "),v("code",[_._v("ACT_RU_EXECUTION")]),_._v(" 表。")])])}),[],!1,null,null,null);v.default=E.exports}}]);