(window.webpackJsonp=window.webpackJsonp||[]).push([[28],{357:function(t,s,a){"use strict";a.r(s);var n=a(7),e=Object(n.a)({},(function(){var t=this,s=t._self._c;return s("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[s("h2",{attrs:{id:"👍-相关视频教程"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#👍-相关视频教程"}},[t._v("#")]),t._v(" 👍 相关视频教程")]),t._v(" "),s("ul",[s("li",[s("a",{attrs:{href:"https://t.zsxq.com/07nYzrfyz",target:"_blank",rel:"noopener noreferrer"}},[t._v("功能权限 01：如何设计一套权限系统？"),s("OutboundLink")],1)]),t._v(" "),s("li",[s("a",{attrs:{href:"https://t.zsxq.com/07IuNBmAq",target:"_blank",rel:"noopener noreferrer"}},[t._v("功能权限 02：如何实现菜单的创建？"),s("OutboundLink")],1)]),t._v(" "),s("li",[s("a",{attrs:{href:"https://t.zsxq.com/07f6AuJuZ",target:"_blank",rel:"noopener noreferrer"}},[t._v("功能权限 03：如何实现角色的创建？"),s("OutboundLink")],1)]),t._v(" "),s("li",[s("a",{attrs:{href:"https://t.zsxq.com/07uJqV7Y3",target:"_blank",rel:"noopener noreferrer"}},[t._v("功能权限 04：如何给用户分配权限 —— 将菜单赋予角色？"),s("OutboundLink")],1)]),t._v(" "),s("li",[s("a",{attrs:{href:"https://t.zsxq.com/07YBe6QjA",target:"_blank",rel:"noopener noreferrer"}},[t._v("功能权限 05：如何给用户分配权限 —— 将角色赋予用户？"),s("OutboundLink")],1)]),t._v(" "),s("li",[s("a",{attrs:{href:"https://t.zsxq.com/072ZVJurz",target:"_blank",rel:"noopener noreferrer"}},[t._v("功能权限 06：后端如何实现 URL 权限的校验？"),s("OutboundLink")],1)]),t._v(" "),s("li",[s("a",{attrs:{href:"https://t.zsxq.com/07rnMRRn2",target:"_blank",rel:"noopener noreferrer"}},[t._v("功能权限 07：前端如何实现菜单的动态加载？"),s("OutboundLink")],1)]),t._v(" "),s("li",[s("a",{attrs:{href:"https://t.zsxq.com/072JeIUfY",target:"_blank",rel:"noopener noreferrer"}},[t._v("功能权限 08：前端如何实现按钮的权限校验？"),s("OutboundLink")],1)])]),t._v(" "),s("h2",{attrs:{id:"_1-rbac-权限模型"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_1-rbac-权限模型"}},[t._v("#")]),t._v(" 1. RBAC 权限模型")]),t._v(" "),s("p",[t._v("系统采用 RBAC 权限模型，全称是 Role-Based Access Control 基于角色的访问控制。")]),t._v(" "),s("p",[s("img",{attrs:{src:"/img/%E5%8A%9F%E8%83%BD%E6%9D%83%E9%99%90/01.png",alt:"权限模型"}})]),t._v(" "),s("p",[t._v("简单来说，每个用户拥有若干角色，每个角色拥有若干个菜单，菜单中存在菜单权限、按钮权限。这样，就形成了 "),s("strong",[t._v("“用户<->角色<->菜单”")]),t._v(" 的授权模型。 在这种模型中，用户与角色、角色与菜单之间构成了多对多的关系，如下图：")]),t._v(" "),s("p",[s("img",{attrs:{src:"/img/%E5%8A%9F%E8%83%BD%E6%9D%83%E9%99%90/02.png",alt:"权限模型"}})]),t._v(" "),s("h2",{attrs:{id:"_2-token-认证机制"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_2-token-认证机制"}},[t._v("#")]),t._v(" 2. Token 认证机制")]),t._v(" "),s("p",[t._v("安全框架使用的是 "),s("a",{attrs:{href:"https://www.iocoder.cn/Spring-Boot/Spring-Security/?yudao",target:"_blank",rel:"noopener noreferrer"}},[t._v("Spring Security"),s("OutboundLink")],1),t._v(" + Token 方案，整体流程如下图所示：")]),t._v(" "),s("p",[s("img",{attrs:{src:"/img/%E5%8A%9F%E8%83%BD%E6%9D%83%E9%99%90/03.png",alt:"Token 认证机制"}})]),t._v(" "),s("p",[t._v("① 前端调用登录接口，使用账号密码获得到认证 Token。响应示例如下：")]),t._v(" "),s("div",{staticClass:"language-JSON extra-class"},[s("pre",{pre:!0,attrs:{class:"language-json"}},[s("code",[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token property"}},[t._v('"code"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token property"}},[t._v('"msg"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('""')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token property"}},[t._v('"data"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token property"}},[t._v('"token"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"d2a3cdbc6c53470db67a582bd115103f"')]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),s("ul",[s("li",[t._v("管理后台的登录实现，可见 "),s("a",{attrs:{href:"https://github.com/YunaiV/ruoyi-vue-pro/blob/master/yudao-module-system/yudao-module-system-biz/src/main/java/cn/iocoder/yudao/module/system/controller/admin/auth/AuthController.java#L56-L63",target:"_blank",rel:"noopener noreferrer"}},[t._v("代码"),s("OutboundLink")],1)]),t._v(" "),s("li",[t._v("用户 App 的登录实现，可见 "),s("a",{attrs:{href:"https://github.com/YunaiV/ruoyi-vue-pro/blob/master/yudao-module-member/yudao-module-member-biz/src/main/java/cn/iocoder/yudao/module/member/controller/app/auth/AppAuthController.java#L34-L41",target:"_blank",rel:"noopener noreferrer"}},[t._v("代码"),s("OutboundLink")],1)])]),t._v(" "),s("div",{staticClass:"custom-block tip"},[s("p",{staticClass:"custom-block-title"},[t._v("疑问：为什么不使用 Spring Security 内置的表单登录？")]),t._v(" "),s("p",[t._v("Spring Security 的登录拓展起来不方便，例如说验证码、三方登录等等。")])]),t._v(" "),s("p",[t._v("Token 存储在数据库中，对应 "),s("code",[t._v("system_oauth2_access_token")]),t._v(" 访问令牌表的 "),s("code",[t._v("id")]),t._v(" 字段。考虑到访问的性能，缓存在 Redis 的 "),s("a",{attrs:{href:"https://github.com/YunaiV/ruoyi-vue-pro/blob/master/yudao-module-system/yudao-module-system-biz/src/main/java/cn/iocoder/yudao/module/system/dal/redis/RedisKeyConstants.java#L21",target:"_blank",rel:"noopener noreferrer"}},[s("code",[t._v("oauth2_access_token:%s")]),s("OutboundLink")],1),t._v(" 键中。")]),t._v(" "),s("div",{staticClass:"custom-block tip"},[s("p",{staticClass:"custom-block-title"},[t._v("疑问：为什么不使用 JWT(JSON Web Token)？")]),t._v(" "),s("p",[t._v("JWT 是无状态的，无法实现 Token 的作废，例如说用户登出系统、修改密码等等场景。")]),t._v(" "),s("p",[t._v("推荐阅读 "),s("a",{attrs:{href:"https://www.iocoder.cn/Fight/Confused-about-cookies-sessions,-Tokens-JWT/?yudao",target:"_blank",rel:"noopener noreferrer"}},[t._v("《还分不清 Cookie、Session、Token、JWT？》"),s("OutboundLink")],1),t._v(" 文章。")])]),t._v(" "),s("p",[t._v("默认配置下，Token 有效期为 30 天，可通过 "),s("code",[t._v("system_oauth2_client")]),t._v(" 表中 "),s("code",[t._v("client_id = default")]),t._v(" 的记录进行自定义：")]),t._v(" "),s("p",[s("img",{attrs:{src:"/img/%E5%8A%9F%E8%83%BD%E6%9D%83%E9%99%90/04.png",alt:" 表"}})]),t._v(" "),s("ul",[s("li",[t._v("修改 "),s("code",[t._v("access_token_validity_seconds")]),t._v(" 字段，设置访问令牌的过期时间，默认 1800 秒 = 30 分钟")]),t._v(" "),s("li",[t._v("修改 "),s("code",[t._v("refresh_token_validity_seconds")]),t._v(" 字段，设置刷新令牌的过期时间，默认 2592000 秒 = 30 天")])]),t._v(" "),s("p",[t._v("② 前端调用其它接口，需要在请求头带上 Token 进行访问。请求头格式如下：")]),t._v(" "),s("div",{staticClass:"language-Bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("### Authorization: Bearer 登录时返回的 Token")]),t._v("\nAuthorization: Bearer d2a3cdbc6c53470db67a582bd115103f\n")])])]),s("ul",[s("li",[t._v("具体的代码实现，可见 "),s("a",{attrs:{href:"https://github.com/YunaiV/ruoyi-vue-pro/blob/master/yudao-framework/yudao-spring-boot-starter-security/src/main/java/cn/iocoder/yudao/framework/security/core/filter/TokenAuthenticationFilter.java",target:"_blank",rel:"noopener noreferrer"}},[t._v("TokenAuthenticationFilter"),s("OutboundLink")],1),t._v(" 过滤器")])]),t._v(" "),s("p",[t._v("考虑到使用 Postman、Swagger 调试接口方便，提供了 "),s("strong",[t._v("Token 的模拟机制")]),t._v("。请求头格式如下：")]),t._v(" "),s("div",{staticClass:"language-Bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("### Authorization: Bearer test用户编号")]),t._v("\nAuthorization: Bearer test1\n")])])]),s("p",[t._v("其中 "),s("code",[t._v('"test"')]),t._v(" 可自定义，配置项如下：")]),t._v(" "),s("div",{staticClass:"language-YAML extra-class"},[s("pre",{pre:!0,attrs:{class:"language-yaml"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("### application-local.yaml")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("yudao")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("security")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("mock-enable")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token boolean important"}},[t._v("true")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 是否开启 Token 的模拟机制")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("mock-secret")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" test "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# Token 模拟机制的 Token 前缀")]),t._v("\n")])])]),s("h2",{attrs:{id:"_3-权限注解"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_3-权限注解"}},[t._v("#")]),t._v(" 3. 权限注解")]),t._v(" "),s("h3",{attrs:{id:"_3-1-preauthorize-注解"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_3-1-preauthorize-注解"}},[t._v("#")]),t._v(" 3.1 @PreAuthorize 注解")]),t._v(" "),s("p",[s("a",{attrs:{href:"https://github.com/spring-projects/spring-security/blob/main/core/src/main/java/org/springframework/security/access/prepost/PreAuthorize.java",target:"_blank",rel:"noopener noreferrer"}},[s("code",[t._v("@PreAuthorize")]),s("OutboundLink")],1),t._v(" 是 Spring Security 内置的"),s("strong",[t._v("前置")]),t._v("权限注解，添加在"),s("strong",[t._v("接口方法")]),t._v("上，声明需要的权限，实现访问权限的控制。")]),t._v(" "),s("p",[t._v("① 基于【权限标识】的权限控制")]),t._v(" "),s("p",[t._v("权限标识，对应 "),s("code",[t._v("system_menu")]),t._v(" 表的 "),s("code",[t._v("permission")]),t._v(" 字段，推荐格式为 "),s("code",[t._v("${系统}:${模块}:${操作}")]),t._v("，例如说 "),s("code",[t._v("system:admin:add")]),t._v(" 标识 system 服务的添加管理员。")]),t._v(" "),s("p",[t._v("使用示例如下：")]),t._v(" "),s("div",{staticClass:"language-Java extra-class"},[s("pre",{pre:!0,attrs:{class:"language-java"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 符合 system:user:list 权限要求")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[t._v("@PreAuthorize")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("\"@ss.hasPermission('system:user:list')\"")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 符合 system:user:add 或 system:user:edit 权限要求即可")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[t._v("@PreAuthorize")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("\"@ss.hasAnyPermissions('system:user:add', 'system:user:edit')\"")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])])]),s("p",[t._v("② 基于【角色标识】的权限控制")]),t._v(" "),s("p",[t._v("权限标识，对应 "),s("code",[t._v("system_role")]),t._v(" 表的 "),s("code",[t._v("code")]),t._v(" 字段， 例如说 "),s("code",[t._v("super_admin")]),t._v(" 超级管理员、"),s("code",[t._v("tenant_admin")]),t._v(" 租户管理员。")]),t._v(" "),s("p",[t._v("使用示例如下：")]),t._v(" "),s("div",{staticClass:"language-Java extra-class"},[s("pre",{pre:!0,attrs:{class:"language-java"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 属于 user 角色")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[t._v("@PreAuthorize")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("\"@ss.hasRole('user')\"")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 属于 user 或者 admin 之一")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[t._v("@PreAuthorize")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("\"@ss.hasAnyRoles('user', 'admin')\"")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])])]),s("div",{staticClass:"custom-block tip"},[s("p",{staticClass:"custom-block-title"},[t._v("实现原理是什么？")]),t._v(" "),s("p",[t._v("当 "),s("code",[t._v("@PreAuthorize")]),t._v(" 注解里的 Spring EL 表达式返回 "),s("code",[t._v("false")]),t._v(" 时，表示没有权限。")]),t._v(" "),s("p",[t._v("而 "),s("code",[t._v("@PreAuthorize(\"@ss.hasPermission('system:user:list')\")")]),t._v(" 表示调用 Bean 名字为 "),s("code",[t._v("ss")]),t._v(" 的 "),s("code",[t._v("#hasPermission(...)")]),t._v(" 方法，方法参数为 "),s("code",[t._v('"system:user:list"')]),t._v(" 字符串。"),s("code",[t._v("ss")]),t._v(" 对应的 Bean 是 "),s("a",{attrs:{href:"https://github.com/YunaiV/ruoyi-vue-pro/blob/master/yudao-module-system/yudao-module-system-biz/src/main/java/cn/iocoder/yudao/module/system/service/permission/PermissionServiceImpl.java#L43",target:"_blank",rel:"noopener noreferrer"}},[t._v("PermissionServiceImpl"),s("OutboundLink")],1),t._v(" 类，所以你只需要去看该方法的"),s("a",{attrs:{href:"https://github.com/YunaiV/ruoyi-vue-pro/blob/master/yudao-module-system/yudao-module-system-biz/src/main/java/cn/iocoder/yudao/module/system/service/permission/PermissionServiceImpl.java#L293-L326",target:"_blank",rel:"noopener noreferrer"}},[t._v("实现代码"),s("OutboundLink")],1),t._v("。")])]),t._v(" "),s("p",[t._v("注意，一般情况下，只有管理后台的接口才会使用 "),s("code",[t._v("@PreAuthorize")]),t._v(" 注解，用户 App 的接口不会使用。")]),t._v(" "),s("h2",{attrs:{id:"_4-自定义权限配置"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_4-自定义权限配置"}},[t._v("#")]),t._v(" 4. 自定义权限配置")]),t._v(" "),s("p",[t._v("默认配置下，所有接口都需要登录后才能访问，不限于管理后台的 "),s("code",[t._v("/admin-api/**")]),t._v(" 所有 API 接口、用户 App 的 "),s("code",[t._v("/app-api/**")]),t._v(" 所有 API 接口。")]),t._v(" "),s("p",[t._v("如下想要自定义权限配置，设置定义 API 接口可以匿名（不登录）进行访问，可以通过下面三种方式：")]),t._v(" "),s("h3",{attrs:{id:"_4-1-方式一-自定义-authorizerequestscustomizer-实现"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_4-1-方式一-自定义-authorizerequestscustomizer-实现"}},[t._v("#")]),t._v(" 4.1 方式一：自定义 AuthorizeRequestsCustomizer 实现")]),t._v(" "),s("p",[t._v("每个 Maven Module 可以实现自定义的 "),s("a",{attrs:{href:"https://github.com/YunaiV/ruoyi-vue-pro/blob/master/yudao-framework/yudao-spring-boot-starter-security/src/main/java/cn/iocoder/yudao/framework/security/config/YudaoWebSecurityConfigurerAdapter.java",target:"_blank",rel:"noopener noreferrer"}},[t._v("AuthorizeRequestsCustomizer"),s("OutboundLink")],1),t._v(" Bean，额外定义每个 Module 的 API 接口的访问规则。例如说 "),s("code",[t._v("yudao-module-infra")]),t._v(" 模块的 "),s("a",{attrs:{href:"https://github.com/YunaiV/ruoyi-vue-pro/blob/master/yudao-module-infra/yudao-module-infra-biz/src/main/java/cn/iocoder/yudao/module/infra/framework/security/config/SecurityConfiguration.java",target:"_blank",rel:"noopener noreferrer"}},[t._v("SecurityConfiguration"),s("OutboundLink")],1),t._v(" 类，代码如下：")]),t._v(" "),s("div",{staticClass:"language-Java extra-class"},[s("pre",{pre:!0,attrs:{class:"language-java"}},[s("code",[s("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[t._v("@Configuration")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("proxyBeanMethods "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("false")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" value "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"infraSecurityConfiguration"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("public")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("class")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("SecurityConfiguration")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n\n    "),s("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[t._v("@Value")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("\"${spring.boot.admin.context-path:''}\"")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("private")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("String")]),t._v(" adminSeverContextPath"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n    "),s("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[t._v("@Bean")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"infraAuthorizeRequestsCustomizer"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("public")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("AuthorizeRequestsCustomizer")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("authorizeRequestsCustomizer")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("AuthorizeRequestsCustomizer")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n\n            "),s("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[t._v("@Override")]),t._v("\n            "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("public")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("void")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("customize")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("AuthorizeHttpRequestsConfigurer")]),s("span",{pre:!0,attrs:{class:"token generics"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("HttpSecurity")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("AuthorizationManagerRequestMatcherRegistry registry"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n                "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// Swagger 接口文档")]),t._v("\n                registry"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("requestMatchers")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"/v3/api-docs/**"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("permitAll")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n                        "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("requestMatchers")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"/swagger-ui.html"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("permitAll")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n                        "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("requestMatchers")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"/swagger-ui/**"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("permitAll")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n                        "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("requestMatchers")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"/swagger-resources/**"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("permitAll")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n                        "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("requestMatchers")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"/webjars/**"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("permitAll")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n                        "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("requestMatchers")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"/*/api-docs"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("permitAll")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n                "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// Spring Boot Actuator 的安全配置")]),t._v("\n                registry"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("requestMatchers")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"/actuator"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("permitAll")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n                        "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("requestMatchers")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"/actuator/**"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("permitAll")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n                "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// Druid 监控")]),t._v("\n                registry"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("requestMatchers")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"/druid/**"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("permitAll")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n                "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// Spring Boot Admin Server 的安全配置")]),t._v("\n                registry"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("requestMatchers")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("adminSeverContextPath"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("permitAll")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n                        "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("requestMatchers")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("adminSeverContextPath "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"/**"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("permitAll")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n                "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 文件读取")]),t._v("\n                registry"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("requestMatchers")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("buildAdminApi")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"/infra/file/*/get/**"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("permitAll")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n            "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n        "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),s("div",{staticClass:"custom-block tip"},[s("p",{staticClass:"custom-block-title"},[t._v("友情提示")]),t._v(" "),s("ul",[s("li",[s("code",[t._v("permitAll()")]),t._v(" 方法：所有用户可以任意访问，包括带上 Token 访问")]),t._v(" "),s("li",[s("code",[t._v("anonymous()")]),t._v(" 方法：匿名用户可以任意访问，带上 Token 访问会报错")])]),t._v(" "),s("p",[t._v("如果你对 Spring Security 了解不多，可以阅读艿艿写的 "),s("a",{attrs:{href:"https://www.iocoder.cn/Spring-Boot/Spring-Security/?yudao",target:"_blank",rel:"noopener noreferrer"}},[t._v("《芋道 Spring Boot 安全框架 Spring Security 入门 》"),s("OutboundLink")],1),t._v(" 文章。")])]),t._v(" "),s("h3",{attrs:{id:"_4-2-方式二-permitall-注解"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_4-2-方式二-permitall-注解"}},[t._v("#")]),t._v(" 4.2 方式二："),s("code",[t._v("@PermitAll")]),t._v(" 注解")]),t._v(" "),s("p",[t._v("在 API 接口上添加 "),s("a",{attrs:{href:"https://javaee.github.io/javaee-spec/javadocs/javax/annotation/security/PermitAll.html",target:"_blank",rel:"noopener noreferrer"}},[s("code",[t._v("@PermitAll")]),s("OutboundLink")],1),t._v(" 注解，示例如下：")]),t._v(" "),s("div",{staticClass:"language-Java extra-class"},[s("pre",{pre:!0,attrs:{class:"language-java"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// FileController.java")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[t._v("@GetMapping")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"/{configId}/get/{path}"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[t._v("@PermitAll")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("public")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("void")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("getFileContent")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("HttpServletResponse")]),t._v(" response"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n                           "),s("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[t._v("@PathVariable")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"configId"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Long")]),t._v(" configId"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n                           "),s("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[t._v("@PathVariable")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"path"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("String")]),t._v(" path"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("throws")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Exception")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// ...")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),s("h3",{attrs:{id:"_4-3-方式三-yudao-security-permit-all-urls-配置项"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_4-3-方式三-yudao-security-permit-all-urls-配置项"}},[t._v("#")]),t._v(" 4.3 方式三："),s("code",[t._v("yudao.security.permit-all-urls")]),t._v(" 配置项")]),t._v(" "),s("p",[t._v("在 "),s("code",[t._v("application.yaml")]),t._v(" 配置文件，通过 "),s("code",[t._v("yudao.security.permit-all-urls")]),t._v(" 配置项设置，示例如下：")]),t._v(" "),s("div",{staticClass:"language-YAML extra-class"},[s("pre",{pre:!0,attrs:{class:"language-yaml"}},[s("code",[s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("yudao")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("security")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("permit-all-urls")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" /admin"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("ui/"),s("span",{pre:!0,attrs:{class:"token important"}},[t._v("**")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# /resources/admin-ui 目录下的静态资源")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" /admin"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("api/xxx/yyy\n")])])])])}),[],!1,null,null,null);s.default=e.exports}}]);