(window.webpackJsonp=window.webpackJsonp||[]).push([[77],{405:function(s,t,a){"use strict";a.r(t);var e=a(7),n=Object(e.a)({},(function(){var s=this,t=s._self._c;return t("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[t("h2",{attrs:{id:"_1-转办、委派"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_1-转办、委派"}},[s._v("#")]),s._v(" 1. 转办、委派")]),s._v(" "),t("p",[s._v("转办和委托，两者的区别在于是不是真的转给对方，对比如下：")]),s._v(" "),t("ul",[t("li",[s._v("转办：A 转给其 B 审批，B 审批后，进入下一节点")]),s._v(" "),t("li",[s._v("委派：A 转给其 B 审批，B 审批后，转给 A，A 继续审批后进入下一节点")])]),s._v(" "),t("h3",{attrs:{id:"_1-1-转办"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_1-1-转办"}},[s._v("#")]),s._v(" 1.1 转办")]),s._v(" "),t("p",[s._v("转办，简单来说，就是 "),t("strong",[s._v("真的")]),s._v(" 换一个 "),t("code",[s._v("assignee")]),s._v(" 审批人，对应界面如下：")]),s._v(" "),t("p",[t("img",{attrs:{src:"/img/%E5%B7%A5%E4%BD%9C%E6%B5%81%E6%89%8B%E5%86%8C/%E8%BD%AC%E5%8A%9E%E5%A7%94%E6%89%98%E6%8A%84%E9%80%81/%E8%BD%AC%E5%8A%9E.png",alt:"转办"}})]),s._v(" "),t("p",[s._v("对应后端的 BpmTaskController 提供的 "),t("code",[s._v("#transferTask(...)")]),s._v(" 接口。如下图所示：")]),s._v(" "),t("p",[t("img",{attrs:{src:"/img/%E5%B7%A5%E4%BD%9C%E6%B5%81%E6%89%8B%E5%86%8C/%E8%BD%AC%E5%8A%9E%E5%A7%94%E6%89%98%E6%8A%84%E9%80%81/%E8%BD%AC%E5%8A%9E%E7%9A%84%E5%AE%9E%E7%8E%B0.png",alt:"转办的实现"}})]),s._v(" "),t("ul",[t("li",[s._v("关键是红圈的 "),t("code",[s._v("3.2")]),s._v(" 部分：通过调用 "),t("code",[s._v("TaskService#setAssignee(...)")]),s._v(" 方法，修改审批人")]),s._v(" "),t("li",[s._v("至于 "),t("code",[s._v("3.1")]),s._v(" 部分：将原审批人设置为 "),t("code",[s._v("owner")]),s._v("，这其实是可选的")])]),s._v(" "),t("h3",{attrs:{id:"_1-2-委派"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_1-2-委派"}},[s._v("#")]),s._v(" 1.2 委派")]),s._v(" "),t("p",[s._v("委派，简单来说，只是 "),t("strong",[s._v("临时")]),s._v(" 换一个 "),t("code",[s._v("assignee")]),s._v(" 审批人，干完活还要交回来，对应界面如下：")]),s._v(" "),t("p",[t("img",{attrs:{src:"/img/%E5%B7%A5%E4%BD%9C%E6%B5%81%E6%89%8B%E5%86%8C/%E8%BD%AC%E5%8A%9E%E5%A7%94%E6%89%98%E6%8A%84%E9%80%81/%E5%A7%94%E6%B4%BE.png",alt:"委派"}})]),s._v(" "),t("p",[s._v("它对应两个流程：")]),s._v(" "),t("ul",[t("li",[s._v("A 转给其 B 审批")]),s._v(" "),t("li",[s._v("B 审批后，转给 A")])]),s._v(" "),t("p",[s._v("① A 转给其 B 审批，对应后端的 BpmTaskController 提供的 "),t("code",[s._v("#delegateTask(...)")]),s._v(" 接口。如下图所示：")]),s._v(" "),t("p",[t("img",{attrs:{src:"/img/%E5%B7%A5%E4%BD%9C%E6%B5%81%E6%89%8B%E5%86%8C/%E8%BD%AC%E5%8A%9E%E5%A7%94%E6%89%98%E6%8A%84%E9%80%81/%E5%A7%94%E6%B4%BE%E7%9A%84%E5%AE%9E%E7%8E%B0.png",alt:"委派的实现"}})]),s._v(" "),t("ul",[t("li",[s._v("红圈的 "),t("code",[s._v("3.1")]),s._v(" 部分：将原审批人设置为 "),t("code",[s._v("owner")]),s._v("，这个是必须的，因为委派是临时的，干完活还要交回来")]),s._v(" "),t("li",[s._v("红圈的 "),t("code",[s._v("3.2")]),s._v(" 部分：通过调用 "),t("code",[s._v("TaskService#delegateTask(...)")]),s._v(" 方法，委派给新审批人")])]),s._v(" "),t("p",[s._v("② B 审批后，转给 A，对应后端的 BpmTaskController 提供的 "),t("code",[s._v("#approveTask(...)")]),s._v(" 接口。如下图所示：")]),s._v(" "),t("p",[t("img",{attrs:{src:"/img/%E5%B7%A5%E4%BD%9C%E6%B5%81%E6%89%8B%E5%86%8C/%E8%BD%AC%E5%8A%9E%E5%A7%94%E6%89%98%E6%8A%84%E9%80%81/%E5%AE%A1%E6%89%B9%E5%A7%94%E6%B4%BE%E7%9A%84%E5%AE%9E%E7%8E%B0.png",alt:"审批委派的实现"}})]),s._v(" "),t("ul",[t("li",[s._v("红圈的 "),t("code",[s._v("2.1")]),s._v(" 部分：通过调用 "),t("code",[s._v("TaskService#resolveTask(...)")]),s._v(" 方法，将委派的任务交回给原审批人，表示任务已审批（已完成）。这样，后续原审批人就可以继续审批了")])]),s._v(" "),t("h2",{attrs:{id:"_2-抄送"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_2-抄送"}},[s._v("#")]),s._v(" 2. 抄送")]),s._v(" "),t("p",[s._v("抄送，将审批结果，通知给抄送列表对应的人。")]),s._v(" "),t("h3",{attrs:{id:"_2-1-表结构"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_2-1-表结构"}},[s._v("#")]),s._v(" 2.1 表结构")]),s._v(" "),t("p",[s._v("抄送表，是我们自己定义的 "),t("code",[s._v("bpm_process_instance_copy")]),s._v(" 表，结构如下：")]),s._v(" "),t("blockquote",[t("p",[s._v("省略 creator/create_time/updater/update_time/deleted/tenant_id 等通用字段")])]),s._v(" "),t("div",{staticClass:"language-SQL extra-class"},[t("pre",{pre:!0,attrs:{class:"language-sql"}},[t("code",[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("CREATE")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("TABLE")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token identifier"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("`")]),s._v("bpm_process_instance_copy"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("`")])]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token identifier"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("`")]),s._v("id"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("`")])]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("bigint")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("NOT")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("NULL")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("AUTO_INCREMENT")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("COMMENT")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'编号'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token identifier"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("`")]),s._v("user_id"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("`")])]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("bigint")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("NOT")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("NULL")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("DEFAULT")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'0'")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("COMMENT")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'用户编号，被抄送人'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n  \n  "),t("span",{pre:!0,attrs:{class:"token identifier"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("`")]),s._v("start_user_id"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("`")])]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("bigint")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("NOT")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("NULL")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("DEFAULT")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'0'")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("COMMENT")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'发起流程的用户编号'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token identifier"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("`")]),s._v("process_instance_id"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("`")])]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("varchar")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("64")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("COLLATE")]),s._v(" utf8mb4_unicode_ci "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("NOT")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("NULL")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("DEFAULT")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("''")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("COMMENT")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'流程实例的id'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token identifier"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("`")]),s._v("process_instance_name"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("`")])]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("varchar")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("64")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("COLLATE")]),s._v(" utf8mb4_unicode_ci "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("NOT")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("NULL")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("DEFAULT")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("''")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("COMMENT")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'流程实例的名字'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n  \n  "),t("span",{pre:!0,attrs:{class:"token identifier"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("`")]),s._v("category"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("`")])]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("varchar")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("64")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("CHARACTER")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("SET")]),s._v(" utf8mb4 "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("COLLATE")]),s._v(" utf8mb4_unicode_ci "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("NOT")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("NULL")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("COMMENT")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'流程定义的分类'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n  \n  "),t("span",{pre:!0,attrs:{class:"token identifier"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("`")]),s._v("task_id"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("`")])]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("varchar")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("64")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("COLLATE")]),s._v(" utf8mb4_unicode_ci "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("NOT")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("NULL")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("DEFAULT")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("''")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("COMMENT")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'发起抄送的任务编号'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token identifier"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("`")]),s._v("task_name"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("`")])]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("varchar")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("64")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("COLLATE")]),s._v(" utf8mb4_unicode_ci "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("DEFAULT")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("NULL")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("COMMENT")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'任务的名字'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("PRIMARY")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("KEY")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token identifier"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("`")]),s._v("id"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("`")])]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("USING")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("BTREE")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("ENGINE")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("InnoDB")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("AUTO_INCREMENT")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("12")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("DEFAULT")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("CHARSET")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("utf8mb4 "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("COLLATE")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("utf8mb4_unicode_ci "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("COMMENT")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'BPM 流程实例抄送表'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])])]),t("p",[s._v("比较简单，就是存储下关联的 "),t("code",[s._v("user_id")]),s._v("、"),t("code",[s._v("process_instance_id")]),s._v("、"),t("code",[s._v("task_id")]),s._v(" 等信息。")]),s._v(" "),t("h3",{attrs:{id:"_2-2-发起抄送"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_2-2-发起抄送"}},[s._v("#")]),s._v(" 2.2 发起抄送")]),s._v(" "),t("p",[s._v("审批通过、不通过时，可以选择抄送的人，对应界面如下：")]),s._v(" "),t("p",[t("img",{attrs:{src:"/img/%E5%B7%A5%E4%BD%9C%E6%B5%81%E6%89%8B%E5%86%8C/%E8%BD%AC%E5%8A%9E%E5%A7%94%E6%89%98%E6%8A%84%E9%80%81/%E5%8F%91%E8%B5%B7%E6%8A%84%E9%80%81.png",alt:"发起抄送"}})]),s._v(" "),t("p",[s._v("对应的后端代码，如下图所示：")]),s._v(" "),t("p",[t("img",{attrs:{src:"/img/%E5%B7%A5%E4%BD%9C%E6%B5%81%E6%89%8B%E5%86%8C/%E8%BD%AC%E5%8A%9E%E5%A7%94%E6%89%98%E6%8A%84%E9%80%81/%E5%8F%91%E8%B5%B7%E6%8A%84%E9%80%81%E7%9A%84%E5%AE%9E%E7%8E%B0.png",alt:"发起抄送的实现"}})]),s._v(" "),t("h3",{attrs:{id:"_2-3-查看抄送"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_2-3-查看抄送"}},[s._v("#")]),s._v(" 2.3 查看抄送")]),s._v(" "),t("p",[s._v("被抄送人，可以在 [工作流程 -> 审批中心 -> 抄送我的] 菜单，查看到抄送列表，对应界面如下：")]),s._v(" "),t("p",[t("img",{attrs:{src:"/img/%E5%B7%A5%E4%BD%9C%E6%B5%81%E6%89%8B%E5%86%8C/%E8%BD%AC%E5%8A%9E%E5%A7%94%E6%89%98%E6%8A%84%E9%80%81/%E6%8A%84%E9%80%81%E6%88%91%E7%9A%84.png",alt:"抄送我的"}})])])}),[],!1,null,null,null);t.default=n.exports}}]);